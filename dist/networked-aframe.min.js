<<<<<<< HEAD
!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=28)}([function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(43),a="mediasoup-client",o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this._debug=i.default("".concat(a,":").concat(t)),this._warn=i.default("".concat(a,":WARN:").concat(t)),this._error=i.default("".concat(a,":ERROR:").concat(t))):(this._debug=i.default(a),this._warn=i.default("".concat(a,":WARN")),this._error=i.default("".concat(a,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var t,r,o;return t=e,(r=[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])&&n(t.prototype,r),o&&n(t,o),e}();t.Logger=o},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.clone=function(e){return"object"!==n(e)?{}:JSON.parse(JSON.stringify(e))},t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},function(e,t,r){"use strict";function n(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0});var o=r(46),s=r(1);function c(e){var t=new RegExp("^(audio|video)/(.+)","i");if("object"!==a(e))throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");var r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"===a(e.parameters)||(e.parameters={});for(var i=0,o=Object.keys(e.parameters);i<o.length;i++){var s=o[i],c=e.parameters[s];if(void 0===c&&(e.parameters[s]="",c=""),"string"!=typeof c&&"number"!=typeof c)throw new TypeError("invalid codec parameter [key:".concat(s,"s, value:").concat(c,"]"));if("apt"===s&&"number"!=typeof c)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);var d,p=n(e.rtcpFeedback);try{for(p.s();!(d=p.n()).done;){u(d.value)}}catch(e){p.e(e)}finally{p.f()}}function u(e){if("object"!==a(e))throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function d(e){if("object"!==a(e))throw new TypeError("ext is not an object");if(e.kind&&"string"==typeof e.kind||(e.kind=""),""!==e.kind&&"audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function p(e){if("object"!==a(e))throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");var t,r=n(e.codecs);try{for(r.s();!(t=r.n()).done;){l(t.value)}}catch(e){r.e(e)}finally{r.f()}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);var i,o=n(e.headerExtensions);try{for(o.s();!(i=o.n()).done;){f(i.value)}}catch(e){o.e(e)}finally{o.f()}if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);var s,c=n(e.encodings);try{for(c.s();!(s=c.n()).done;){h(s.value)}}catch(e){c.e(e)}finally{c.f()}if(e.rtcp&&"object"!==a(e.rtcp))throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),m(e.rtcp)}function l(e){var t=new RegExp("^(audio|video)/(.+)","i");if("object"!==a(e))throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");var r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"===a(e.parameters)||(e.parameters={});for(var i=0,o=Object.keys(e.parameters);i<o.length;i++){var s=o[i],c=e.parameters[s];if(void 0===c&&(e.parameters[s]="",c=""),"string"!=typeof c&&"number"!=typeof c)throw new TypeError("invalid codec parameter [key:".concat(s,"s, value:").concat(c,"]"));if("apt"===s&&"number"!=typeof c)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);var d,p=n(e.rtcpFeedback);try{for(p.s();!(d=p.n()).done;){u(d.value)}}catch(e){p.e(e)}finally{p.f()}}function f(e){if("object"!==a(e))throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"===a(e.parameters)||(e.parameters={});for(var t=0,r=Object.keys(e.parameters);t<r.length;t++){var n=r[t],i=e.parameters[n];if(void 0===i&&(e.parameters[n]="",i=""),"string"!=typeof i&&"number"!=typeof i)throw new TypeError("invalid header extension parameter")}}function h(e){if("object"!==a(e))throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!==a(e.rtx))throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function m(e){if("object"!==a(e))throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function y(e){if("object"!==a(e))throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function v(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function g(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.strict,i=void 0!==n&&n,a=r.modify,s=void 0!==a&&a,c=e.mimeType.toLowerCase(),u=t.mimeType.toLowerCase();if(c!==u)return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;switch(c){case"video/h264":var d=e.parameters["packetization-mode"]||0,p=t.parameters["packetization-mode"]||0;if(d!==p)return!1;if(i){if(!o.isSameProfile(e.parameters,t.parameters))return!1;var l;try{l=o.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}s&&(l?e.parameters["profile-level-id"]=l:delete e.parameters["profile-level-id"])}break;case"video/vp9":if(i){var f=e.parameters["profile-id"]||0,h=t.parameters["profile-id"]||0;if(f!==h)return!1}}return!0}function b(e,t){var r,i=[],a=n(e.rtcpFeedback||[]);try{var o=function(){var e=r.value,n=(t.rtcpFeedback||[]).find((function(t){return t.type===e.type&&(t.parameter===e.parameter||!t.parameter&&!e.parameter)}));n&&i.push(n)};for(a.s();!(r=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}return i}t.validateRtpCapabilities=function(e){if("object"!==a(e))throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);var t,r=n(e.codecs);try{for(r.s();!(t=r.n()).done;){c(t.value)}}catch(e){r.e(e)}finally{r.f()}if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);var i,o=n(e.headerExtensions);try{for(o.s();!(i=o.n()).done;){d(i.value)}}catch(e){o.e(e)}finally{o.f()}},t.validateRtpCodecCapability=c,t.validateRtcpFeedback=u,t.validateRtpHeaderExtension=d,t.validateRtpParameters=p,t.validateRtpCodecParameters=l,t.validateRtpHeaderExtensionParameters=f,t.validateRtpEncodingParameters=h,t.validateRtcpParameters=m,t.validateSctpCapabilities=function(e){if("object"!==a(e))throw new TypeError("caps is not an object");if(!e.numStreams||"object"!==a(e.numStreams))throw new TypeError("missing caps.numStreams");y(e.numStreams)},t.validateNumSctpStreams=y,t.validateSctpParameters=function(e){if("object"!==a(e))throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")},t.validateSctpStreamParameters=function(e){if("object"!==a(e))throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");var t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.priority&&"string"!=typeof e.priority)throw new TypeError("invalid params.priority");if(e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")},t.getExtendedRtpCapabilities=function(e,t){var r,i={codecs:[],headerExtensions:[]},a=n(t.codecs||[]);try{var o=function(){var t=r.value;if(v(t))return"continue";var n=(e.codecs||[]).find((function(e){return g(e,t,{strict:!0,modify:!0})}));if(!n)return"continue";var a={mimeType:n.mimeType,kind:n.kind,clockRate:n.clockRate,channels:n.channels,localPayloadType:n.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:t.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:n.parameters,remoteParameters:t.parameters,rtcpFeedback:b(n,t)};i.codecs.push(a)};for(a.s();!(r=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}var s,c=n(i.codecs);try{var u=function(){var r=s.value,n=e.codecs.find((function(e){return v(e)&&e.parameters.apt===r.localPayloadType})),i=t.codecs.find((function(e){return v(e)&&e.parameters.apt===r.remotePayloadType}));n&&i&&(r.localRtxPayloadType=n.preferredPayloadType,r.remoteRtxPayloadType=i.preferredPayloadType)};for(c.s();!(s=c.n()).done;)u()}catch(e){c.e(e)}finally{c.f()}var d,p=n(t.headerExtensions);try{var l=function(){var t=d.value,r=e.headerExtensions.find((function(e){return n=t,!((r=e).kind&&n.kind&&r.kind!==n.kind||r.uri!==n.uri);var r,n}));if(!r)return"continue";var n={kind:t.kind,uri:t.uri,sendId:r.preferredId,recvId:t.preferredId,encrypt:r.preferredEncrypt,direction:"sendrecv"};switch(t.direction){case"sendrecv":n.direction="sendrecv";break;case"recvonly":n.direction="sendonly";break;case"sendonly":n.direction="recvonly";break;case"inactive":n.direction="inactive"}i.headerExtensions.push(n)};for(p.s();!(d=p.n()).done;)l()}catch(e){p.e(e)}finally{p.f()}return i},t.getRecvRtpCapabilities=function(e){var t,r={codecs:[],headerExtensions:[]},i=n(e.codecs);try{for(i.s();!(t=i.n()).done;){var a=t.value,o={mimeType:a.mimeType,kind:a.kind,preferredPayloadType:a.remotePayloadType,clockRate:a.clockRate,channels:a.channels,parameters:a.localParameters,rtcpFeedback:a.rtcpFeedback};if(r.codecs.push(o),a.remoteRtxPayloadType){var s={mimeType:"".concat(a.kind,"/rtx"),kind:a.kind,preferredPayloadType:a.remoteRtxPayloadType,clockRate:a.clockRate,parameters:{apt:a.remotePayloadType},rtcpFeedback:[]};r.codecs.push(s)}}}catch(e){i.e(e)}finally{i.f()}var c,u=n(e.headerExtensions);try{for(u.s();!(c=u.n()).done;){var d=c.value;if("sendrecv"===d.direction||"recvonly"===d.direction){var p={kind:d.kind,uri:d.uri,preferredId:d.recvId,preferredEncrypt:d.encrypt,direction:d.direction};r.headerExtensions.push(p)}}}catch(e){u.e(e)}finally{u.f()}return r},t.getSendingRtpParameters=function(e,t){var r,i={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},a=n(t.codecs);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.kind===e){var s={mimeType:o.mimeType,payloadType:o.localPayloadType,clockRate:o.clockRate,channels:o.channels,parameters:o.localParameters,rtcpFeedback:o.rtcpFeedback};if(i.codecs.push(s),o.localRtxPayloadType){var c={mimeType:"".concat(o.kind,"/rtx"),payloadType:o.localRtxPayloadType,clockRate:o.clockRate,parameters:{apt:o.localPayloadType},rtcpFeedback:[]};i.codecs.push(c)}}}}catch(e){a.e(e)}finally{a.f()}var u,d=n(t.headerExtensions);try{for(d.s();!(u=d.n()).done;){var p=u.value;if(!(p.kind&&p.kind!==e||"sendrecv"!==p.direction&&"sendonly"!==p.direction)){var l={uri:p.uri,id:p.sendId,encrypt:p.encrypt,parameters:{}};i.headerExtensions.push(l)}}}catch(e){d.e(e)}finally{d.f()}return i},t.getSendingRemoteRtpParameters=function(e,t){var r,i={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},a=n(t.codecs);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.kind===e){var s={mimeType:o.mimeType,payloadType:o.localPayloadType,clockRate:o.clockRate,channels:o.channels,parameters:o.remoteParameters,rtcpFeedback:o.rtcpFeedback};if(i.codecs.push(s),o.localRtxPayloadType){var c={mimeType:"".concat(o.kind,"/rtx"),payloadType:o.localRtxPayloadType,clockRate:o.clockRate,parameters:{apt:o.localPayloadType},rtcpFeedback:[]};i.codecs.push(c)}}}}catch(e){a.e(e)}finally{a.f()}var u,d=n(t.headerExtensions);try{for(d.s();!(u=d.n()).done;){var p=u.value;if(!(p.kind&&p.kind!==e||"sendrecv"!==p.direction&&"sendonly"!==p.direction)){var l={uri:p.uri,id:p.sendId,encrypt:p.encrypt,parameters:{}};i.headerExtensions.push(l)}}}catch(e){d.e(e)}finally{d.f()}if(i.headerExtensions.some((function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri}))){var f,h=n(i.codecs);try{for(h.s();!(f=h.n()).done;){var m=f.value;m.rtcpFeedback=(m.rtcpFeedback||[]).filter((function(e){return"goog-remb"!==e.type}))}}catch(e){h.e(e)}finally{h.f()}}else if(i.headerExtensions.some((function(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri}))){var y,v=n(i.codecs);try{for(v.s();!(y=v.n()).done;){var g=y.value;g.rtcpFeedback=(g.rtcpFeedback||[]).filter((function(e){return"transport-cc"!==e.type}))}}catch(e){v.e(e)}finally{v.f()}}else{var b,w=n(i.codecs);try{for(w.s();!(b=w.n()).done;){var _=b.value;_.rtcpFeedback=(_.rtcpFeedback||[]).filter((function(e){return"transport-cc"!==e.type&&"goog-remb"!==e.type}))}}catch(e){w.e(e)}finally{w.f()}}return i},t.reduceCodecs=function(e,t){var r=[];if(t){for(var n=0;n<e.length;++n)if(g(e[n],t)){r.push(e[n]),v(e[n+1])&&r.push(e[n+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),v(e[1])&&r.push(e[1]);return r},t.generateProbatorRtpParameters=function(e){p(e=s.clone(e));var t={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=127,t.headerExtensions=e.headerExtensions,t},t.canSend=function(e,t){return t.codecs.some((function(t){return t.kind===e}))},t.canReceive=function(e,t){if(p(e),0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some((function(e){return e.remotePayloadType===r.payloadType}))}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function o(e){var t=p();return function(){var r,n=f(e);if(t){var i=f(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return s(this,r)}}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?c(e):t}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){var t="function"==typeof Map?new Map:void 0;return(u=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return d(e,arguments,f(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),l(n,e)})(e)}function d(e,t,r){return(d=p()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&l(i,r.prototype),i}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){a(r,e);var t=o(r);function r(e){var n;return i(this,r),(n=t.call(this,e)).name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(c(n),r):n.stack=new Error(e).stack,n}return r}(u(Error));t.UnsupportedError=h;var m=function(e){a(r,e);var t=o(r);function r(e){var n;return i(this,r),(n=t.call(this,e)).name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(c(n),r):n.stack=new Error(e).stack,n}return r}(u(Error));t.InvalidStateError=m},function(e,t,r){"use strict";var n=r(52),i=r(53);t.write=i,t.parse=n.parse,t.parseParams=n.parseParams,t.parseFmtpConfig=n.parseFmtpConfig,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=s(e);if(t){var i=s(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return o(this,r)}}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(r,e);var t=a(r);function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),t.call(this)}return r}(r(8).EnhancedEventEmitter);t.HandlerInterface=c},function(e,t,r){"use strict";function n(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(t,"__esModule",{value:!0});var a=r(4);t.extractRtpCapabilities=function(e){var t,r=e.sdpObject,i=new Map,o=[],s=!1,c=!1,u=n(r.media);try{for(u.s();!(t=u.n()).done;){var d=t.value,p=d.type;switch(p){case"audio":if(s)continue;s=!0;break;case"video":if(c)continue;c=!0;break;default:continue}var l,f=n(d.rtp);try{for(f.s();!(l=f.n()).done;){var h=l.value,m={kind:p,mimeType:"".concat(p,"/").concat(h.codec),preferredPayloadType:h.payload,clockRate:h.rate,channels:h.encoding,parameters:{},rtcpFeedback:[]};i.set(m.preferredPayloadType,m)}}catch(e){f.e(e)}finally{f.f()}var y,v=n(d.fmtp||[]);try{for(v.s();!(y=v.n()).done;){var g=y.value,b=a.parseParams(g.config),w=i.get(g.payload);w&&(b&&b["profile-level-id"]&&(b["profile-level-id"]=String(b["profile-level-id"])),w.parameters=b)}}catch(e){v.e(e)}finally{v.f()}var _,S=n(d.rtcpFb||[]);try{for(S.s();!(_=S.n()).done;){var k=_.value,R=i.get(k.payload);if(R){var x={type:k.type,parameter:k.subtype};x.parameter||delete x.parameter,R.rtcpFeedback.push(x)}}}catch(e){S.e(e)}finally{S.f()}var C,P=n(d.ext||[]);try{for(P.s();!(C=P.n()).done;){var T=C.value;if(!T["encrypt-uri"]){var O={kind:p,uri:T.uri,preferredId:T.value};o.push(O)}}}catch(e){P.e(e)}finally{P.f()}}}catch(e){u.e(e)}finally{u.f()}return{codecs:Array.from(i.values()),headerExtensions:o}},t.extractDtlsParameters=function(e){var t=e.sdpObject,r=(t.media||[]).find((function(e){return e.iceUfrag&&0!==e.port}));if(!r)throw new Error("no active media section found");var n,i=r.fingerprint||t.fingerprint;switch(r.setup){case"active":n="client";break;case"passive":n="server";break;case"actpass":n="auto"}return{role:n,fingerprints:[{algorithm:i.type,value:i.hash}]}},t.getCname=function(e){var t=(e.offerMediaObject.ssrcs||[]).find((function(e){return"cname"===e.attribute}));return t?t.value:""},t.applyCodecParameters=function(e){var t,r=e.offerRtpParameters,i=e.answerMediaObject,o=n(r.codecs);try{var s=function(){var e=t.value,r=e.mimeType.toLowerCase();if("audio/opus"!==r)return"continue";if(!(i.rtp||[]).find((function(t){return t.payload===e.payloadType})))return"continue";i.fmtp=i.fmtp||[];var n=i.fmtp.find((function(t){return t.payload===e.payloadType}));n||(n={payload:e.payloadType,config:""},i.fmtp.push(n));var o=a.parseParams(n.config);switch(r){case"audio/opus":var s=e.parameters["sprop-stereo"];void 0!==s&&(o.stereo=s?1:0)}n.config="";for(var c=0,u=Object.keys(o);c<u.length;c++){var d=u[c];n.config&&(n.config+=";"),n.config+="".concat(d,"=").concat(o[d])}};for(o.s();!(t=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}}},function(e,t,r){"use strict";function n(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),s=r(0),c=r(54),u=new s.Logger("RemoteSdp"),d=function(){function e(t){var r=t.iceParameters,n=t.iceCandidates,i=t.dtlsParameters,a=t.sctpParameters,o=t.plainRtpParameters,s=t.planB,c=void 0!==s&&s;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=r,this._iceCandidates=n,this._dtlsParameters=i,this._sctpParameters=a,this._plainRtpParameters=o,this._planB=c,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},r&&r.iceLite&&(this._sdpObject.icelite="ice-lite"),i){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};var u=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:i.fingerprints[u-1].algorithm,hash:i.fingerprints[u-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}o&&(this._sdpObject.origin.address=o.ip,this._sdpObject.origin.ipVer=o.ipVersion)}var t,r,i;return t=e,(r=[{key:"updateIceParameters",value:function(e){u.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;var t,r=n(this._mediaSections);try{for(r.s();!(t=r.n()).done;)t.value.setIceParameters(e)}catch(e){r.e(e)}finally{r.f()}}},{key:"updateDtlsRole",value:function(e){u.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;var t,r=n(this._mediaSections);try{for(r.s();!(t=r.n()).done;)t.value.setDtlsRole(e)}catch(e){r.e(e)}finally{r.f()}}},{key:"getNextMediaSectionIdx",value:function(){for(var e=0;e<this._mediaSections.length;++e){var t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}},{key:"send",value:function(e){var t=e.offerMediaObject,r=e.reuseMid,n=e.offerRtpParameters,i=e.answerRtpParameters,a=e.codecOptions,o=e.extmapAllowMixed,s=void 0!==o&&o,u=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:t,offerRtpParameters:n,answerRtpParameters:i,codecOptions:a,extmapAllowMixed:s});r?this._replaceMediaSection(u,r):this._midToIndex.has(u.mid)?this._replaceMediaSection(u):this._addMediaSection(u)}},{key:"receive",value:function(e){var t,r=e.mid,n=e.kind,i=e.offerRtpParameters,a=e.streamId,o=e.trackId,s=this._midToIndex.get(r);void 0!==s&&(t=this._mediaSections[s]),t?(t.planBReceive({offerRtpParameters:i,streamId:a,trackId:o}),this._replaceMediaSection(t)):(t=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:r,kind:n,offerRtpParameters:i,streamId:a,trackId:o}),this._addMediaSection(t))}},{key:"disableMediaSection",value:function(e){var t=this._midToIndex.get(e);if(void 0===t)throw new Error("no media section found with mid '".concat(e,"'"));this._mediaSections[t].disable()}},{key:"closeMediaSection",value:function(e){var t=this._midToIndex.get(e);if(void 0===t)throw new Error("no media section found with mid '".concat(e,"'"));var r=this._mediaSections[t];if(e===this._firstMid)return u.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),void this.disableMediaSection(e);r.close(),this._regenerateBundleMids()}},{key:"planBStopReceiving",value:function(e){var t=e.mid,r=e.offerRtpParameters,n=this._midToIndex.get(t);if(void 0===n)throw new Error("no media section found with mid '".concat(t,"'"));var i=this._mediaSections[n];i.planBStopReceiving({offerRtpParameters:r}),this._replaceMediaSection(i)}},{key:"sendSctpAssociation",value:function(e){var t=e.offerMediaObject,r=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:t});this._addMediaSection(r)}},{key:"receiveSctpAssociation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.oldDataChannelSpec,r=void 0!==t&&t,n=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:r});this._addMediaSection(n)}},{key:"getSdp",value:function(){return this._sdpObject.origin.sessionVersion++,o.write(this._sdpObject)}},{key:"_addMediaSection",value:function(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}},{key:"_replaceMediaSection",value:function(e,t){if("string"==typeof t){var r=this._midToIndex.get(t);if(void 0===r)throw new Error("no media section found for reuseMid '".concat(t,"'"));var n=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(n.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{var i=this._midToIndex.get(e.mid);if(void 0===i)throw new Error("no media section found with mid '".concat(e.mid,"'"));this._mediaSections[i]=e,this._sdpObject.media[i]=e.getObject()}}},{key:"_regenerateBundleMids",value:function(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((function(e){return!e.closed})).map((function(e){return e.mid})).join(" "))}}])&&a(t.prototype,r),i&&a(t,i),e}();t.RemoteSdp=d},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c(this,r)}}function c(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var d=r(18),p=new(r(0).Logger)("EnhancedEventEmitter"),l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(l,e);var t,r,n,c,u,d=s(l);function l(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(e=d.call(this)).setMaxListeners(1/0),e}return t=l,(r=[{key:"safeEmit",value:function(e){var t=this.listenerCount(e);try{for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return this.emit.apply(this,[e].concat(n))}catch(r){return p.error("safeEmit() | event listener threw an error [event:%s]:%o",e,r),Boolean(t)}}},{key:"safeEmitAsPromise",value:(c=regeneratorRuntime.mark((function e(t){var r,n,i,a=this,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=o.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=o[i];return e.abrupt("return",new Promise((function(e,r){return a.safeEmit.apply(a,[t].concat(n,[e,r]))})));case 2:case"end":return e.stop()}}),e)})),u=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=c.apply(e,t);function o(e){i(a,r,n,o,s,"next",e)}function s(e){i(a,r,n,o,s,"throw",e)}o(void 0)}))},function(e){return u.apply(this,arguments)})}])&&a(t.prototype,r),n&&a(t,n),l}(d.EventEmitter);t.EnhancedEventEmitter=l},function(e,t,r){"use strict";var n,i,a=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var u,d=[],p=!1,l=-1;function f(){p&&u&&(p=!1,u.length?d=u.concat(d):l=-1,d.length&&h())}function h(){if(!p){var e=c(f);p=!0;for(var t=d.length;t;){for(u=d,d=[];++l<t;)u&&u[l].run();l=-1,t=d.length}u=null,p=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function y(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new m(e,t)),1!==d.length||p||c(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=y,a.addListener=y,a.once=y,a.off=y,a.removeListener=y,a.removeAllListeners=y,a.emit=y,a.prependListener=y,a.prependOnceListener=y,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=a(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function a(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(t,"__esModule",{value:!0}),t.getRtpEncodings=function(e){var t,r=e.offerMediaObject,a=new Set,o=i(r.ssrcs||[]);try{for(o.s();!(t=o.n()).done;){var s=t.value.id;a.add(s)}}catch(e){o.e(e)}finally{o.f()}if(0===a.size)throw new Error("no a=ssrc lines found");var c,u=new Map,d=i(r.ssrcGroups||[]);try{for(d.s();!(c=d.n()).done;){var p=c.value;if("FID"===p.semantics){var l=n(p.ssrcs.split(/\s+/),2),f=l[0],h=l[1];f=Number(f),h=Number(h),a.has(f)&&(a.delete(f),a.delete(h),u.set(f,h))}}}catch(e){d.e(e)}finally{d.f()}var m,y=i(a);try{for(y.s();!(m=y.n()).done;){var v=m.value;u.set(v,null)}}catch(e){y.e(e)}finally{y.f()}var g,b=[],w=i(u);try{for(w.s();!(g=w.n()).done;){var _=n(g.value,2),S=_[0],k=_[1],R={ssrc:S};k&&(R.rtx={ssrc:k}),b.push(R)}}catch(e){w.e(e)}finally{w.f()}return b},t.addLegacySimulcast=function(e){var t=e.offerMediaObject,r=e.numStreams;if(r<=1)throw new TypeError("numStreams must be greater than 1");var i=(t.ssrcs||[]).find((function(e){return"msid"===e.attribute}));if(!i)throw new Error("a=ssrc line with msid information not found");var a,o=n(i.value.split(" ")[0],2),s=o[0],c=o[1],u=i.id;(t.ssrcGroups||[]).some((function(e){if("FID"!==e.semantics)return!1;var t=e.ssrcs.split(/\s+/);return Number(t[0])===u&&(a=Number(t[1]),!0)}));var d=t.ssrcs.find((function(e){return"cname"===e.attribute}));if(!d)throw new Error("a=ssrc line with cname information not found");for(var p=d.value,l=[],f=[],h=0;h<r;++h)l.push(u+h),a&&f.push(a+h);t.ssrcGroups=[],t.ssrcs=[],t.ssrcGroups.push({semantics:"SIM",ssrcs:l.join(" ")});for(var m=0;m<l.length;++m){var y=l[m];t.ssrcs.push({id:y,attribute:"cname",value:p}),t.ssrcs.push({id:y,attribute:"msid",value:"".concat(s," ").concat(c)})}for(var v=0;v<f.length;++v){var g=l[v],b=f[v];t.ssrcs.push({id:b,attribute:"cname",value:p}),t.ssrcs.push({id:b,attribute:"msid",value:"".concat(s," ").concat(c)}),t.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(g," ").concat(b)})}}},function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=a(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function a(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(t,"__esModule",{value:!0}),t.getRtpEncodings=function(e){var t,r,a=e.offerMediaObject,o=e.track,s=new Set,c=i(a.ssrcs||[]);try{for(c.s();!(r=c.n()).done;){var u=r.value;if("msid"===u.attribute)if(u.value.split(" ")[1]===o.id){var d=u.id;s.add(d),t||(t=d)}}}catch(e){c.e(e)}finally{c.f()}if(0===s.size)throw new Error("a=ssrc line with msid information not found [track.id:".concat(o.id,"]"));var p,l=new Map,f=i(a.ssrcGroups||[]);try{for(f.s();!(p=f.n()).done;){var h=p.value;if("FID"===h.semantics){var m=n(h.ssrcs.split(/\s+/),2),y=m[0],v=m[1];y=Number(y),v=Number(v),s.has(y)&&(s.delete(y),s.delete(v),l.set(y,v))}}}catch(e){f.e(e)}finally{f.f()}var g,b=i(s);try{for(b.s();!(g=b.n()).done;){var w=g.value;l.set(w,null)}}catch(e){b.e(e)}finally{b.f()}var _,S=[],k=i(l);try{for(k.s();!(_=k.n()).done;){var R=n(_.value,2),x=R[0],C=R[1],P={ssrc:x};C&&(P.rtx={ssrc:C}),S.push(P)}}catch(e){k.e(e)}finally{k.f()}return S},t.addLegacySimulcast=function(e){var t,r,n,i=e.offerMediaObject,a=e.track,o=e.numStreams;if(o<=1)throw new TypeError("numStreams must be greater than 1");if(!(i.ssrcs||[]).find((function(e){return"msid"===e.attribute&&(e.value.split(" ")[1]===a.id&&(t=e.id,n=e.value.split(" ")[0],!0))})))throw new Error("a=ssrc line with msid information not found [track.id:".concat(a.id,"]"));(i.ssrcGroups||[]).some((function(e){if("FID"!==e.semantics)return!1;var n=e.ssrcs.split(/\s+/);return Number(n[0])===t&&(r=Number(n[1]),!0)}));var s=i.ssrcs.find((function(e){return"cname"===e.attribute&&e.id===t}));if(!s)throw new Error("a=ssrc line with cname information not found [track.id:".concat(a.id,"]"));for(var c=s.value,u=[],d=[],p=0;p<o;++p)u.push(t+p),r&&d.push(r+p);i.ssrcGroups=i.ssrcGroups||[],i.ssrcs=i.ssrcs||[],i.ssrcGroups.push({semantics:"SIM",ssrcs:u.join(" ")});for(var l=0;l<u.length;++l){var f=u[l];i.ssrcs.push({id:f,attribute:"cname",value:c}),i.ssrcs.push({id:f,attribute:"msid",value:"".concat(n," ").concat(a.id)})}for(var h=0;h<d.length;++h){var m=u[h],y=d[h];i.ssrcs.push({id:y,attribute:"cname",value:c}),i.ssrcs.push({id:y,attribute:"msid",value:"".concat(n," ").concat(a.id)}),i.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(m," ").concat(y)})}}},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=r(68),a="protoo-client",o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this._debug=i("".concat(a,":").concat(t)),this._warn=i("".concat(a,":WARN:").concat(t)),this._error=i("".concat(a,":ERROR:").concat(t))):(this._debug=i(a),this._warn=i("".concat(a,":WARN")),this._error=i("".concat(a,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var t,r,o;return t=e,(r=[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])&&n(t.prototype,r),o&&n(t,o),e}();e.exports=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");t.parse=function(e){var t=n.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;for(var n=[],i=0;i<256;++i)n.push((i+256).toString(16).substr(1));var a=function(e,t){var r=t||0,i=n;return(i[e[r+0]]+i[e[r+1]]+i[e[r+2]]+i[e[r+3]]+"-"+i[e[r+4]]+i[e[r+5]]+"-"+i[e[r+6]]+i[e[r+7]]+"-"+i[e[r+8]]+i[e[r+9]]+"-"+i[e[r+10]]+i[e[r+11]]+i[e[r+12]]+i[e[r+13]]+i[e[r+14]]+i[e[r+15]]).toLowerCase()};t.default=a},function(e,t,r){"use strict";var n=r(29),i=r(30),a=r(31),o=r(32),s=r(33),c=r(35),u=r(36),d={app:"",room:"",clientId:""};d.options=n,d.utils=i,d.log=new a,d.schemas=new o,d.version="0.7.1",d.adapters=new u;var p=new s,l=new c(p);d.connection=l,d.entities=p,e.exports=window.NAF=d},function(e,t,r){"use strict";function n(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0});var s=r(41),c=r(0),u=r(3),d=r(2),p=r(17),l=r(51),f=r(55),h=r(56),m=r(57),y=r(58),v=r(59),g=r(60),b=r(61),w=r(63),_=new c.Logger("Device");function S(){if("object"===("undefined"==typeof navigator?"undefined":o(navigator))&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void _.warn("this._detectDevice() | unsupported ReactNative without RTCPeerConnection"):(_.debug("this._detectDevice() | ReactNative handler chosen"),"ReactNative");if("object"!==("undefined"==typeof navigator?"undefined":o(navigator))||"string"!=typeof navigator.userAgent)_.warn("this._detectDevice() | unknown device");else{var e=navigator.userAgent,t=s.getParser(e),r=t.getEngine();if(t.satisfies({chrome:">=74",chromium:">=74"}))return"Chrome74";if(t.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(t.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(t.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(t.satisfies({firefox:">=60"}))return"Firefox60";if(t.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(t.satisfies({safari:">=11"}))return"Safari11";if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(r.name&&"blink"===r.name.toLowerCase()){var n=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(n){var i=Number(n[1]);return i>=74?"Chrome74":i>=70?"Chrome70":i>=67?"Chrome67":"Chrome55"}return"Chrome74"}_.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",t.getBrowserName(),t.getBrowserVersion())}}t.detectDevice=S;var k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.handlerName,n=t.handlerFactory,a=t.Handler;if(i(this,e),this._loaded=!1,_.debug("constructor()"),a){if(_.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof a)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");r=a}if(r&&n)throw new TypeError("just one of handlerName or handlerInterface can be given");if(n)this._handlerFactory=n;else{if(r)_.debug("constructor() | handler given: %s",r);else{if(!(r=S()))throw new u.UnsupportedError("device not supported");_.debug("constructor() | detected handler: %s",r)}switch(r){case"Chrome74":this._handlerFactory=l.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=f.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=h.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=m.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=y.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=v.Safari12.createFactory();break;case"Safari11":this._handlerFactory=g.Safari11.createFactory();break;case"Edge11":this._handlerFactory=b.Edge11.createFactory();break;case"ReactNative":this._handlerFactory=w.ReactNative.createFactory();break;default:throw new TypeError('unknown handlerName "'.concat(r,'"'))}}var o=this._handlerFactory();this._handlerName=o.name,o.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}var t,r,s,c,k;return t=e,(r=[{key:"load",value:(c=regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.routerRtpCapabilities,_.debug("load() [routerRtpCapabilities:%o]",r),e.prev=2,!this._loaded){e.next=5;break}throw new u.InvalidStateError("already loaded");case 5:return d.validateRtpCapabilities(r),n=this._handlerFactory(),e.next=9,n.getNativeRtpCapabilities();case 9:return i=e.sent,_.debug("load() | got native RTP capabilities:%o",i),d.validateRtpCapabilities(i),this._extendedRtpCapabilities=d.getExtendedRtpCapabilities(i,r),_.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=d.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=d.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=d.getRecvRtpCapabilities(this._extendedRtpCapabilities),d.validateRtpCapabilities(this._recvRtpCapabilities),_.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),e.next=21,n.getNativeSctpCapabilities();case 21:this._sctpCapabilities=e.sent,_.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),d.validateSctpCapabilities(this._sctpCapabilities),_.debug("load() succeeded"),this._loaded=!0,n.close(),e.next=33;break;case 29:throw e.prev=29,e.t0=e.catch(2),n&&n.close(),e.t0;case 33:case"end":return e.stop()}}),e,this,[[2,29]])})),k=function(){var e=this,t=arguments;return new Promise((function(r,i){var a=c.apply(e,t);function o(e){n(a,r,i,o,s,"next",e)}function s(e){n(a,r,i,o,s,"throw",e)}o(void 0)}))},function(e){return k.apply(this,arguments)})},{key:"canProduce",value:function(e){if(!this._loaded)throw new u.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'.concat(e,'"'));return this._canProduceByKind[e]}},{key:"createSendTransport",value:function(e){var t=e.id,r=e.iceParameters,n=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,o=e.iceServers,s=e.iceTransportPolicy,c=e.additionalSettings,u=e.proprietaryConstraints,d=e.appData,p=void 0===d?{}:d;return _.debug("createSendTransport()"),this._createTransport({direction:"send",id:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:u,appData:p})}},{key:"createRecvTransport",value:function(e){var t=e.id,r=e.iceParameters,n=e.iceCandidates,i=e.dtlsParameters,a=e.sctpParameters,o=e.iceServers,s=e.iceTransportPolicy,c=e.additionalSettings,u=e.proprietaryConstraints,d=e.appData,p=void 0===d?{}:d;return _.debug("createRecvTransport()"),this._createTransport({direction:"recv",id:t,iceParameters:r,iceCandidates:n,dtlsParameters:i,sctpParameters:a,iceServers:o,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:u,appData:p})}},{key:"_createTransport",value:function(e){var t=e.direction,r=e.id,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,s=e.sctpParameters,c=e.iceServers,d=e.iceTransportPolicy,l=e.additionalSettings,f=e.proprietaryConstraints,h=e.appData,m=void 0===h?{}:h;if(!this._loaded)throw new u.InvalidStateError("not loaded");if("string"!=typeof r)throw new TypeError("missing id");if("object"!==o(n))throw new TypeError("missing iceParameters");if(!Array.isArray(i))throw new TypeError("missing iceCandidates");if("object"!==o(a))throw new TypeError("missing dtlsParameters");if(s&&"object"!==o(s))throw new TypeError("wrong sctpParameters");if(m&&"object"!==o(m))throw new TypeError("if given, appData must be an object");return new p.Transport({direction:t,id:r,iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:s,iceServers:c,iceTransportPolicy:d,additionalSettings:l,proprietaryConstraints:f,appData:m,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind})}},{key:"handlerName",get:function(){return this._handlerName}},{key:"loaded",get:function(){return this._loaded}},{key:"rtpCapabilities",get:function(){if(!this._loaded)throw new u.InvalidStateError("not loaded");return this._recvRtpCapabilities}},{key:"sctpCapabilities",get:function(){if(!this._loaded)throw new u.InvalidStateError("not loaded");return this._sctpCapabilities}}])&&a(t.prototype,r),s&&a(t,s),e}();t.Device=k},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function s(e){i(o,n,a,s,c,"next",e)}function c(e){i(o,n,a,s,c,"throw",e)}s(void 0)}))}}function o(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=l(e);if(t){var i=l(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return p(this,r)}}function p(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var f=r(50),h=r(0),m=r(8),y=r(3),v=r(1),g=r(2),b=r(19),w=r(20),_=r(21),S=r(22),k=new h.Logger("Transport"),R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(P,e);var t,r,i,s,p,l,h,m,R,x,C=d(P);function P(e){var t,r=e.direction,n=e.id,i=e.iceParameters,a=e.iceCandidates,o=e.dtlsParameters,s=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,d=e.additionalSettings,p=e.proprietaryConstraints,l=e.appData,h=e.handlerFactory,m=e.extendedRtpCapabilities,g=e.canProduceByKind;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,P),(t=C.call(this))._closed=!1,t._connectionState="new",t._producers=new Map,t._consumers=new Map,t._dataProducers=new Map,t._dataConsumers=new Map,t._probatorConsumerCreated=!1,t._awaitQueue=new f.AwaitQueue({ClosedErrorClass:y.InvalidStateError}),k.debug("constructor() [id:%s, direction:%s]",n,r),t._id=n,t._direction=r,t._extendedRtpCapabilities=m,t._canProduceByKind=g,t._maxSctpMessageSize=s?s.maxMessageSize:null,delete(d=v.clone(d)).iceServers,delete d.iceTransportPolicy,delete d.bundlePolicy,delete d.rtcpMuxPolicy,delete d.sdpSemantics,t._handler=h(),t._handler.run({direction:r,iceParameters:i,iceCandidates:a,dtlsParameters:o,sctpParameters:s,iceServers:c,iceTransportPolicy:u,additionalSettings:d,proprietaryConstraints:p,extendedRtpCapabilities:m}),t._appData=l,t._handleHandler(),t}return t=P,(r=[{key:"close",value:function(){if(!this._closed){k.debug("close()"),this._closed=!0,this._awaitQueue.close(),this._handler.close();var e,t=o(this._producers.values());try{for(t.s();!(e=t.n()).done;)e.value.transportClosed()}catch(e){t.e(e)}finally{t.f()}this._producers.clear();var r,n=o(this._consumers.values());try{for(n.s();!(r=n.n()).done;)r.value.transportClosed()}catch(e){n.e(e)}finally{n.f()}this._consumers.clear();var i,a=o(this._dataProducers.values());try{for(a.s();!(i=a.n()).done;)i.value.transportClosed()}catch(e){a.e(e)}finally{a.f()}this._dataProducers.clear();var s,c=o(this._dataConsumers.values());try{for(c.s();!(s=c.n()).done;)s.value.transportClosed()}catch(e){c.e(e)}finally{c.f()}this._dataConsumers.clear()}}},{key:"getStats",value:(x=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new y.InvalidStateError("closed");case 2:return e.abrupt("return",this._handler.getTransportStats());case 3:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"restartIce",value:(R=a(regeneratorRuntime.mark((function e(t){var r,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.iceParameters,k.debug("restartIce()"),!this._closed){e.next=6;break}throw new y.InvalidStateError("closed");case 6:if(r){e.next=8;break}throw new TypeError("missing iceParameters");case 8:return e.abrupt("return",this._awaitQueue.push(a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._handler.restartIce(r));case 1:case"end":return e.stop()}}),e)})))));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"updateIceServers",value:(m=a(regeneratorRuntime.mark((function e(){var t,r,n=this,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},r=t.iceServers,k.debug("updateIceServers()"),!this._closed){e.next=6;break}throw new y.InvalidStateError("closed");case 6:if(Array.isArray(r)){e.next=8;break}throw new TypeError("missing iceServers");case 8:return e.abrupt("return",this._awaitQueue.push(a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._handler.updateIceServers(r));case 1:case"end":return e.stop()}}),e)})))));case 9:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"produce",value:(h=a(regeneratorRuntime.mark((function e(){var t,r,i,o,s,c,u,d,p,l,f,h,m,v=this,w=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=w.length>0&&void 0!==w[0]?w[0]:{},r=t.track,i=t.encodings,o=t.codecOptions,s=t.codec,c=t.stopTracks,u=void 0===c||c,d=t.disableTrackOnPause,p=void 0===d||d,l=t.zeroRtpOnPause,f=void 0!==l&&l,h=t.appData,m=void 0===h?{}:h,k.debug("produce() [track:%o]",r),r){e.next=6;break}throw new TypeError("missing track");case 6:if("send"===this._direction){e.next=10;break}throw new y.UnsupportedError("not a sending Transport");case 10:if(this._canProduceByKind[r.kind]){e.next=14;break}throw new y.UnsupportedError("cannot produce ".concat(r.kind));case 14:if("ended"!==r.readyState){e.next=18;break}throw new y.InvalidStateError("track ended");case 18:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=22;break}throw new TypeError('no "connect" listener set into this transport');case 22:if(0!==this.listenerCount("produce")){e.next=26;break}throw new TypeError('no "produce" listener set into this transport');case 26:if(!m||"object"===n(m)){e.next=28;break}throw new TypeError("if given, appData must be an object");case 28:return e.abrupt("return",this._awaitQueue.push(a(regeneratorRuntime.mark((function e(){var t,n,a,c,d,l,h,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i||Array.isArray(i)){e.next=4;break}throw TypeError("encodings must be an array");case 4:i&&0===i.length?t=void 0:i&&(t=i.map((function(e){var t={active:!0};return!1===e.active&&(t.active=!1),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t})));case 5:return e.next=7,v._handler.send({track:r,encodings:t,codecOptions:o,codec:s});case 7:return n=e.sent,a=n.localId,c=n.rtpParameters,d=n.rtpSender,e.prev=11,g.validateRtpParameters(c),e.next=15,v.safeEmitAsPromise("produce",{kind:r.kind,rtpParameters:c,appData:m});case 15:return l=e.sent,h=l.id,y=new b.Producer({id:h,localId:a,rtpSender:d,track:r,rtpParameters:c,stopTracks:u,disableTrackOnPause:p,zeroRtpOnPause:f,appData:m}),v._producers.set(y.id,y),v._handleProducer(y),e.abrupt("return",y);case 23:throw e.prev=23,e.t0=e.catch(11),v._handler.stopSending(a).catch((function(){})),e.t0;case 27:case"end":return e.stop()}}),e,null,[[11,23]])})))).catch((function(e){if(u)try{r.stop()}catch(e){}throw e})));case 29:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"consume",value:(l=a(regeneratorRuntime.mark((function e(t){var r,i,o,s,c,u,d=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.id,i=t.producerId,o=t.kind,s=t.rtpParameters,c=t.appData,u=void 0===c?{}:c,k.debug("consume()"),!this._closed){e.next=6;break}throw new y.InvalidStateError("closed");case 6:if("recv"===this._direction){e.next=10;break}throw new y.UnsupportedError("not a receiving Transport");case 10:if("string"==typeof r){e.next=14;break}throw new TypeError("missing id");case 14:if("string"==typeof i){e.next=18;break}throw new TypeError("missing producerId");case 18:if("audio"===o||"video"===o){e.next=22;break}throw new TypeError("invalid kind '".concat(o,"'"));case 22:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=26;break}throw new TypeError('no "connect" listener set into this transport');case 26:if(!u||"object"===n(u)){e.next=28;break}throw new TypeError("if given, appData must be an object");case 28:return e.abrupt("return",this._awaitQueue.push(a(regeneratorRuntime.mark((function e(){var t,n,a,c,p,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.canReceive(s,d._extendedRtpCapabilities)){e.next=3;break}throw new y.UnsupportedError("cannot consume this Producer");case 3:return e.next=5,d._handler.receive({trackId:r,kind:o,rtpParameters:s});case 5:if(t=e.sent,n=t.localId,a=t.rtpReceiver,c=t.track,p=new w.Consumer({id:r,localId:n,producerId:i,rtpReceiver:a,track:c,rtpParameters:s,appData:u}),d._consumers.set(p.id,p),d._handleConsumer(p),d._probatorConsumerCreated||"video"!==o){e.next=24;break}return e.prev=13,l=g.generateProbatorRtpParameters(p.rtpParameters),e.next=17,d._handler.receive({trackId:"probator",kind:"video",rtpParameters:l});case 17:k.debug("consume() | Consumer for RTP probation created"),d._probatorConsumerCreated=!0,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(13),k.error("consume() | failed to create Consumer for RTP probation:%o",e.t0);case 24:return e.abrupt("return",p);case 25:case"end":return e.stop()}}),e,null,[[13,21]])})))));case 29:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"produceData",value:(p=a(regeneratorRuntime.mark((function e(){var t,r,i,o,s,c,u,d,p,l,f,h,m,v=this,b=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=b.length>0&&void 0!==b[0]?b[0]:{},r=t.ordered,i=void 0===r||r,o=t.maxPacketLifeTime,s=t.maxRetransmits,c=t.priority,u=void 0===c?"low":c,d=t.label,p=void 0===d?"":d,l=t.protocol,f=void 0===l?"":l,h=t.appData,m=void 0===h?{}:h,k.debug("produceData()"),"send"===this._direction){e.next=6;break}throw new y.UnsupportedError("not a sending Transport");case 6:if(this._maxSctpMessageSize){e.next=10;break}throw new y.UnsupportedError("SCTP not enabled by remote Transport");case 10:if(["very-low","low","medium","high"].includes(u)){e.next=14;break}throw new TypeError("wrong priority");case 14:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=18;break}throw new TypeError('no "connect" listener set into this transport');case 18:if(0!==this.listenerCount("producedata")){e.next=22;break}throw new TypeError('no "producedata" listener set into this transport');case 22:if(!m||"object"===n(m)){e.next=24;break}throw new TypeError("if given, appData must be an object");case 24:return(o||s)&&(i=!1),e.abrupt("return",this._awaitQueue.push(a(regeneratorRuntime.mark((function e(){var t,r,n,a,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v._handler.sendDataChannel({ordered:i,maxPacketLifeTime:o,maxRetransmits:s,priority:u,label:p,protocol:f});case 2:return t=e.sent,r=t.dataChannel,n=t.sctpStreamParameters,g.validateSctpStreamParameters(n),e.next=8,v.safeEmitAsPromise("producedata",{sctpStreamParameters:n,label:p,protocol:f,appData:m});case 8:return a=e.sent,c=a.id,d=new _.DataProducer({id:c,dataChannel:r,sctpStreamParameters:n,appData:m}),v._dataProducers.set(d.id,d),v._handleDataProducer(d),e.abrupt("return",d);case 14:case"end":return e.stop()}}),e)})))));case 26:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"consumeData",value:(s=a(regeneratorRuntime.mark((function e(t){var r,i,o,s,c,u,d,p,l,f=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.id,i=t.dataProducerId,o=t.sctpStreamParameters,s=t.label,c=void 0===s?"":s,u=t.protocol,d=void 0===u?"":u,p=t.appData,l=void 0===p?{}:p,k.debug("consumeData()"),!this._closed){e.next=6;break}throw new y.InvalidStateError("closed");case 6:if("recv"===this._direction){e.next=10;break}throw new y.UnsupportedError("not a receiving Transport");case 10:if(this._maxSctpMessageSize){e.next=14;break}throw new y.UnsupportedError("SCTP not enabled by remote Transport");case 14:if("string"==typeof r){e.next=18;break}throw new TypeError("missing id");case 18:if("string"==typeof i){e.next=22;break}throw new TypeError("missing dataProducerId");case 22:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.next=26;break}throw new TypeError('no "connect" listener set into this transport');case 26:if(!l||"object"===n(l)){e.next=28;break}throw new TypeError("if given, appData must be an object");case 28:return g.validateSctpStreamParameters(o),e.abrupt("return",this._awaitQueue.push(a(regeneratorRuntime.mark((function e(){var t,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f._handler.receiveDataChannel({sctpStreamParameters:o,label:c,protocol:d});case 2:return t=e.sent,n=t.dataChannel,a=new S.DataConsumer({id:r,dataProducerId:i,dataChannel:n,sctpStreamParameters:o,appData:l}),f._dataConsumers.set(a.id,a),f._handleDataConsumer(a),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})))));case 30:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"_handleHandler",value:function(){var e=this,t=this._handler;t.on("@connect",(function(t,r,n){var i=t.dtlsParameters;e._closed?n(new y.InvalidStateError("closed")):e.safeEmit("connect",{dtlsParameters:i},r,n)})),t.on("@connectionstatechange",(function(t){t!==e._connectionState&&(k.debug("connection state changed to %s",t),e._connectionState=t,e._closed||e.safeEmit("connectionstatechange",t))}))}},{key:"_handleProducer",value:function(e){var t=this;e.on("@close",(function(){t._producers.delete(e.id),t._closed||t._awaitQueue.push(a(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t._handler.stopSending(e.localId));case 1:case"end":return r.stop()}}),r)})))).catch((function(e){return k.warn("producer.close() failed:%o",e)}))})),e.on("@replacetrack",(function(r,n,i){t._awaitQueue.push(a(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t._handler.replaceTrack(e.localId,r));case 1:case"end":return n.stop()}}),n)})))).then(n).catch(i)})),e.on("@setmaxspatiallayer",(function(r,n,i){t._awaitQueue.push(a(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t._handler.setMaxSpatialLayer(e.localId,r));case 1:case"end":return n.stop()}}),n)})))).then(n).catch(i)})),e.on("@setrtpencodingparameters",(function(r,n,i){t._awaitQueue.push(a(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t._handler.setRtpEncodingParameters(e.localId,r));case 1:case"end":return n.stop()}}),n)})))).then(n).catch(i)})),e.on("@getstats",(function(r,n){if(t._closed)return n(new y.InvalidStateError("closed"));t._handler.getSenderStats(e.localId).then(r).catch(n)}))}},{key:"_handleConsumer",value:function(e){var t=this;e.on("@close",(function(){t._consumers.delete(e.id),t._closed||t._awaitQueue.push(a(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t._handler.stopReceiving(e.localId));case 1:case"end":return r.stop()}}),r)})))).catch((function(){}))})),e.on("@getstats",(function(r,n){if(t._closed)return n(new y.InvalidStateError("closed"));t._handler.getReceiverStats(e.localId).then(r).catch(n)}))}},{key:"_handleDataProducer",value:function(e){var t=this;e.on("@close",(function(){t._dataProducers.delete(e.id)}))}},{key:"_handleDataConsumer",value:function(e){var t=this;e.on("@close",(function(){t._dataConsumers.delete(e.id)}))}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"handler",get:function(){return this._handler}},{key:"connectionState",get:function(){return this._connectionState}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}}])&&c(t.prototype,r),i&&c(t,i),P}(m.EnhancedEventEmitter);t.Transport=R},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i,a="object"===("undefined"==typeof Reflect?"undefined":n(Reflect))?Reflect:null,o=a&&"function"==typeof a.apply?a.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};i=a&&"function"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function c(){c.init.call(this)}e.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var u=10;function d(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+n(e))}function p(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function l(e,t,r,n){var i,a,o,s;if(d(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),o=a[t]),void 0===o)o=a[t]=r,++e._eventsCount;else if("function"==typeof o?o=a[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=p(e))>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,s=c,console&&console.warn&&console.warn(s)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=f.bind(n);return i.listener=r,n.wrapFn=i,i}function m(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):v(i,i.length)}function y(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function v(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return p(this)},c.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,d=v(c,u);for(r=0;r<u;++r)o(d[r],this,t)}return!0},c.prototype.addListener=function(e,t){return l(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return l(this,e,t,!0)},c.prototype.once=function(e,t){return d(t),this.on(e,h(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return d(t),this.prependListener(e,h(this,e,t)),this},c.prototype.removeListener=function(e,t){var r,n,i,a,o;if(d(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},c.prototype.listeners=function(e){return m(this,e,!0)},c.prototype.rawListeners=function(e){return m(this,e,!1)},c.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):y.call(e,t)},c.prototype.listenerCount=y,c.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function s(e){i(o,n,a,s,c,"next",e)}function c(e){i(o,n,a,s,c,"throw",e)}s(void 0)}))}}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=p(e);if(t){var i=p(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return u(this,r)}}function u(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?d(e):t}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var l=r(0),f=r(8),h=r(3),m=new l.Logger("Producer"),y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(v,e);var t,r,i,u,p,l,f,y=c(v);function v(e){var t,r=e.id,n=e.localId,i=e.rtpSender,a=e.track,o=e.rtpParameters,s=e.stopTracks,c=e.disableTrackOnPause,u=e.zeroRtpOnPause,p=e.appData;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),(t=y.call(this))._closed=!1,m.debug("constructor()"),t._id=r,t._localId=n,t._rtpSender=i,t._track=a,t._kind=a.kind,t._rtpParameters=o,t._paused=!!c&&!a.enabled,t._maxSpatialLayer=void 0,t._stopTracks=s,t._disableTrackOnPause=c,t._zeroRtpOnPause=u,t._appData=p,t._onTrackEnded=t._onTrackEnded.bind(d(t)),t._handleTrack(),t}return t=v,(r=[{key:"close",value:function(){this._closed||(m.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"))}},{key:"transportClosed",value:function(){this._closed||(m.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"))}},{key:"getStats",value:(f=a(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new h.InvalidStateError("closed");case 2:return e.abrupt("return",this.safeEmitAsPromise("@getstats"));case 3:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"pause",value:function(){m.debug("pause()"),this._closed?m.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",null).catch((function(){})))}},{key:"resume",value:function(){m.debug("resume()"),this._closed?m.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",this._track).catch((function(){})))}},{key:"replaceTrack",value:(l=a(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.track,m.debug("replaceTrack() [track:%o]",r),!this._closed){e.next=7;break}if(r&&this._stopTracks)try{r.stop()}catch(e){}throw new h.InvalidStateError("closed");case 7:if(!r||"ended"!==r.readyState){e.next=9;break}throw new h.InvalidStateError("track ended");case 9:if(r!==this._track){e.next=12;break}return m.debug("replaceTrack() | same track, ignored"),e.abrupt("return");case 12:if(this._zeroRtpOnPause&&this._paused){e.next=15;break}return e.next=15,this.safeEmitAsPromise("@replacetrack",r);case 15:this._destroyTrack(),this._track=r,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this._handleTrack();case 19:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(p=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=4;break}throw new h.InvalidStateError("closed");case 4:if("video"===this._kind){e.next=8;break}throw new h.UnsupportedError("not a video Producer");case 8:if("number"==typeof t){e.next=10;break}throw new TypeError("invalid spatialLayer");case 10:if(t!==this._maxSpatialLayer){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,this.safeEmitAsPromise("@setmaxspatiallayer",t);case 14:this._maxSpatialLayer=t;case 15:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(u=a(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=4;break}throw new h.InvalidStateError("closed");case 4:if("object"===n(t)){e.next=6;break}throw new TypeError("invalid params");case 6:return e.next=8,this.safeEmitAsPromise("@setrtpencodingparameters",t);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"_onTrackEnded",value:function(){m.debug('track "ended" event'),this.safeEmit("trackended")}},{key:"_handleTrack",value:function(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}},{key:"_destroyTrack",value:function(){if(this._track)try{this._track.removeEventListener("ended",this._onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}},{key:"id",get:function(){return this._id}},{key:"localId",get:function(){return this._localId}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpSender",get:function(){return this._rtpSender}},{key:"track",get:function(){return this._track}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"paused",get:function(){return this._paused}},{key:"maxSpatialLayer",get:function(){return this._maxSpatialLayer}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}}])&&o(t.prototype,r),i&&o(t,i),v}(f.EnhancedEventEmitter);t.Producer=y},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=d(e);if(t){var i=d(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c(this,r)}}function c(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var p=r(0),l=r(8),f=r(3),h=new p.Logger("Consumer"),m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(l,e);var t,r,n,c,d,p=s(l);function l(e){var t,r=e.id,n=e.localId,i=e.producerId,a=e.rtpReceiver,o=e.track,s=e.rtpParameters,c=e.appData;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=p.call(this))._closed=!1,h.debug("constructor()"),t._id=r,t._localId=n,t._producerId=i,t._rtpReceiver=a,t._track=o,t._rtpParameters=s,t._paused=!o.enabled,t._appData=c,t._onTrackEnded=t._onTrackEnded.bind(u(t)),t._handleTrack(),t}return t=l,(r=[{key:"close",value:function(){this._closed||(h.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"))}},{key:"transportClosed",value:function(){this._closed||(h.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"))}},{key:"getStats",value:(c=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new f.InvalidStateError("closed");case 2:return e.abrupt("return",this.safeEmitAsPromise("@getstats"));case 3:case"end":return e.stop()}}),e,this)})),d=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=c.apply(e,t);function o(e){i(a,r,n,o,s,"next",e)}function s(e){i(a,r,n,o,s,"throw",e)}o(void 0)}))},function(){return d.apply(this,arguments)})},{key:"pause",value:function(){h.debug("pause()"),this._closed?h.error("pause() | Consumer closed"):(this._paused=!0,this._track.enabled=!1)}},{key:"resume",value:function(){h.debug("resume()"),this._closed?h.error("resume() | Consumer closed"):(this._paused=!1,this._track.enabled=!0)}},{key:"_onTrackEnded",value:function(){h.debug('track "ended" event'),this.safeEmit("trackended")}},{key:"_handleTrack",value:function(){this._track.addEventListener("ended",this._onTrackEnded)}},{key:"_destroyTrack",value:function(){try{this._track.removeEventListener("ended",this._onTrackEnded),this._track.stop()}catch(e){}}},{key:"id",get:function(){return this._id}},{key:"localId",get:function(){return this._localId}},{key:"producerId",get:function(){return this._producerId}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"rtpReceiver",get:function(){return this._rtpReceiver}},{key:"track",get:function(){return this._track}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"paused",get:function(){return this._paused}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}}])&&a(t.prototype,r),n&&a(t,n),l}(l.EnhancedEventEmitter);t.Consumer=m},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=c(e);if(t){var i=c(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return s(this,r)}}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var u=r(0),d=r(8),p=r(3),l=new u.Logger("DataProducer"),f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(c,e);var t,r,n,s=o(c);function c(e){var t,r=e.id,n=e.dataChannel,i=e.sctpStreamParameters,a=e.appData;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=s.call(this))._closed=!1,l.debug("constructor()"),t._id=r,t._dataChannel=n,t._sctpStreamParameters=i,t._appData=a,t._handleDataChannel(),t}return t=c,(r=[{key:"close",value:function(){this._closed||(l.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"))}},{key:"transportClosed",value:function(){this._closed||(l.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"))}},{key:"send",value:function(e){if(l.debug("send()"),this._closed)throw new p.InvalidStateError("closed");this._dataChannel.send(e)}},{key:"_handleDataChannel",value:function(){var e=this;this._dataChannel.addEventListener("open",(function(){e._closed||(l.debug('DataChannel "open" event'),e.safeEmit("open"))})),this._dataChannel.addEventListener("error",(function(t){if(!e._closed){var r=t.error;r||(r=new Error("unknown DataChannel error")),"sctp-failure"===r.errorDetail?l.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",r.sctpCauseCode,r.message):l.error('DataChannel "error" event: %o',r),e.safeEmit("error",r)}})),this._dataChannel.addEventListener("close",(function(){e._closed||(l.warn('DataChannel "close" event'),e._closed=!0,e.emit("@close"),e.safeEmit("close"))})),this._dataChannel.addEventListener("message",(function(){e._closed||l.warn('DataChannel "message" event in a DataProducer, message discarded')})),this._dataChannel.addEventListener("bufferedamountlow",(function(){e._closed||e.safeEmit("bufferedamountlow")}))}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"sctpStreamParameters",get:function(){return this._sctpStreamParameters}},{key:"readyState",get:function(){return this._dataChannel.readyState}},{key:"label",get:function(){return this._dataChannel.label}},{key:"protocol",get:function(){return this._dataChannel.protocol}},{key:"bufferedAmount",get:function(){return this._dataChannel.bufferedAmount}},{key:"bufferedAmountLowThreshold",get:function(){return this._dataChannel.bufferedAmountLowThreshold},set:function(e){this._dataChannel.bufferedAmountLowThreshold=e}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}}])&&i(t.prototype,r),n&&i(t,n),c}(d.EnhancedEventEmitter);t.DataProducer=f},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=c(e);if(t){var i=c(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return s(this,r)}}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var u=r(0),d=r(8),p=new u.Logger("DataConsumer"),l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(c,e);var t,r,n,s=o(c);function c(e){var t,r=e.id,n=e.dataProducerId,i=e.dataChannel,a=e.sctpStreamParameters,o=e.appData;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=s.call(this))._closed=!1,p.debug("constructor()"),t._id=r,t._dataProducerId=n,t._dataChannel=i,t._sctpStreamParameters=a,t._appData=o,t._handleDataChannel(),t}return t=c,(r=[{key:"close",value:function(){this._closed||(p.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"))}},{key:"transportClosed",value:function(){this._closed||(p.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"))}},{key:"_handleDataChannel",value:function(){var e=this;this._dataChannel.addEventListener("open",(function(){e._closed||(p.debug('DataChannel "open" event'),e.safeEmit("open"))})),this._dataChannel.addEventListener("error",(function(t){if(!e._closed){var r=t.error;r||(r=new Error("unknown DataChannel error")),"sctp-failure"===r.errorDetail?p.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",r.sctpCauseCode,r.message):p.error('DataChannel "error" event: %o',r),e.safeEmit("error",r)}})),this._dataChannel.addEventListener("close",(function(){e._closed||(p.warn('DataChannel "close" event'),e._closed=!0,e.emit("@close"),e.safeEmit("close"))})),this._dataChannel.addEventListener("message",(function(t){e._closed||e.safeEmit("message",t.data)}))}},{key:"id",get:function(){return this._id}},{key:"dataProducerId",get:function(){return this._dataProducerId}},{key:"closed",get:function(){return this._closed}},{key:"sctpStreamParameters",get:function(){return this._sctpStreamParameters}},{key:"readyState",get:function(){return this._dataChannel.readyState}},{key:"label",get:function(){return this._dataChannel.label}},{key:"protocol",get:function(){return this._dataChannel.protocol}},{key:"binaryType",get:function(){return this._dataChannel.binaryType},set:function(e){this._dataChannel.binaryType=e}},{key:"appData",get:function(){return this._appData},set:function(e){throw new Error("cannot override appData object")}}])&&i(t.prototype,r),n&&i(t,n),c}(d.EnhancedEventEmitter);t.DataConsumer=l},function(e,t,r){"use strict";var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach((function(e){n[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c(this,r)}}function c(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=r(18).EventEmitter,p=r(12),l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(l,e);var t,r,n,c,u,d=s(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=d.call(this)).setMaxListeners(1/0),t._logger=e||new p("EnhancedEventEmitter"),t}return t=l,(r=[{key:"safeEmit",value:function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}},{key:"safeEmitAsPromise",value:(c=regeneratorRuntime.mark((function e(t){var r,n,i,a=this,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=o.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=o[i];return e.abrupt("return",new Promise((function(e,r){a.safeEmit.apply(a,[t].concat(n,[e,r]))})));case 2:case"end":return e.stop()}}),e)})),u=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=c.apply(e,t);function o(e){i(a,r,n,o,s,"next",e)}function s(e){i(a,r,n,o,s,"throw",e)}o(void 0)}))},function(e){return u.apply(this,arguments)})}])&&a(t.prototype,r),n&&a(t,n),l}(d);e.exports=l},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=r(12),o=r(71).generateRandomNumber,s=new a("Message"),c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,a;return t=e,a=[{key:"parse",value:function(e){var t,r={};try{t=JSON.parse(e)}catch(e){return void s.error("parse() | invalid JSON: %s",e)}if("object"===n(t)&&!Array.isArray(t)){if(t.request){if(r.request=!0,"string"!=typeof t.method)return void s.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void s.error("parse() | missing/invalid id field");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return void s.error("parse() | missing/invalid id field");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.ok=!1,r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void s.error("parse() | missing request/response field");if(r.notification=!0,"string"!=typeof t.method)return void s.error("parse() | missing/invalid method field");r.method=t.method,r.data=t.data||{}}return r}s.error("parse() | not an object")}},{key:"createRequest",value:function(e,t){return{request:!0,id:o(),method:e,data:t||{}}}},{key:"createSuccessResponse",value:function(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}},{key:"createErrorResponse",value:function(e,t,r){return{response:!0,id:e.id,ok:!1,errorCode:t,errorReason:r}}},{key:"createNotification",value:function(e,t){return{notification:!0,method:e,data:t||{}}}}],(r=null)&&i(t.prototype,r),a&&i(t,a),e}();e.exports=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!n)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)};var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),i=new Uint8Array(16)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){function n(e,n,a,o){var s=a&&o||0;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof n&&(n=function(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,(function(e){t.push(parseInt(e,16))})),t}(n)),!Array.isArray(e))throw TypeError("value must be an array of bytes");if(!Array.isArray(n)||16!==n.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var c=r(n.concat(e));if(c[6]=15&c[6]|t,c[8]=63&c[8]|128,a)for(var u=0;u<16;++u)a[s+u]=c[u];return a||(0,i.default)(c)}try{n.name=e}catch(e){}return n.DNS=a,n.URL=o,n},t.URL=t.DNS=void 0;var n,i=(n=r(14))&&n.__esModule?n:{default:n};var a="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=a;var o="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=o},function(e,t,r){"use strict";r(15),r(91),r(92),r(95)},function(e,t,r){"use strict";e.exports={debug:!1,updateRate:15,useLerp:!0,firstSyncSource:null,syncSource:null}},function(e,t,r){"use strict";e.exports.whenEntityLoaded=function(e,t){e.hasLoaded&&t(),e.addEventListener("loaded",(function(){t()}))},e.exports.createHtmlNodeFromString=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild},e.exports.getCreator=function(e){var t=e.components;return t.networked?t.networked.data.creator:null},e.exports.getNetworkOwner=function(e){var t=e.components;return t.networked?t.networked.data.owner:null},e.exports.getNetworkId=function(e){var t=e.components;return t.networked?t.networked.data.networkId:null},e.exports.now=function(){return Date.now()},e.exports.createNetworkId=function(){return Math.random().toString(36).substring(2,9)},e.exports.getNetworkedEntity=function(e){return new Promise((function(t,r){for(var n=e;n&&n.components&&!n.components.networked;)n=n.parentNode;if(!n||!n.components||!n.components.networked)return r("Entity does not have and is not a child of an entity with the [networked] component ");n.hasLoaded?t(n):n.addEventListener("instantiated",(function(){t(n)}),{once:!0})}))},e.exports.takeOwnership=function(e){for(var t=e;t&&t.components&&!t.components.networked;)t=t.parentNode;if(!t||!t.components||!t.components.networked)throw new Error("Entity does not have and is not a child of an entity with the [networked] component ");return t.components.networked.takeOwnership()},e.exports.isMine=function(e){for(var t=e;t&&t.components&&!t.components.networked;)t=t.parentNode;if(!t||!t.components||!t.components.networked)throw new Error("Entity does not have and is not a child of an entity with the [networked] component ");return t.components.networked.data.owner===NAF.clientId},e.exports.almostEqualVec3=function(e,t,r){return Math.abs(e.x-t.x)<r&&Math.abs(e.y-t.y)<r&&Math.abs(e.z-t.z)<r}},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.debug=!1}var t,r,i;return t=e,(r=[{key:"setDebug",value:function(e){this.debug=e}},{key:"write",value:function(){this.debug&&console.log.apply(this,arguments)}},{key:"warn",value:function(){console.warn.apply(this,arguments)}},{key:"error",value:function(){console.error.apply(this,arguments)}}])&&n(t.prototype,r),i&&n(t,i),e}();e.exports=i},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemaDict={},this.templateCache={}}var t,r,i;return t=e,(r=[{key:"createDefaultSchema",value:function(e){return{template:e,components:["position","rotation"]}}},{key:"add",value:function(e){if(this.validateSchema(e)){this.schemaDict[e.template]=e;var t=document.querySelector(e.template);if(!t)return void NAF.log.error("Template el not found for ".concat(e.template,", make sure NAF.schemas.add is called after <a-scene> is defined."));if(!this.validateTemplate(e,t))return;this.templateCache[e.template]=document.importNode(t.content,!0)}else NAF.log.error("Schema not valid: ",e),NAF.log.error("See https://github.com/haydenjameslee/networked-aframe#syncing-custom-components")}},{key:"getCachedTemplate",value:function(e){return this.templateIsCached(e)||(this.templateExistsInScene(e)?this.add(this.createDefaultSchema(e)):NAF.log.error("Template el for ".concat(e," is not in the scene, add the template to <a-assets> and register with NAF.schemas.add."))),this.templateCache[e].firstElementChild.cloneNode(!0)}},{key:"templateIsCached",value:function(e){return!!this.templateCache[e]}},{key:"getComponents",value:function(e){var t=["position","rotation"];return this.hasTemplate(e)&&(t=this.schemaDict[e].components),t}},{key:"hasTemplate",value:function(e){return!!this.schemaDict[e]}},{key:"templateExistsInScene",value:function(e){var t=document.querySelector(e);return t&&this.isTemplateTag(t)}},{key:"validateSchema",value:function(e){return!(!e.template||!e.components)}},{key:"validateTemplate",value:function(e,t){return this.isTemplateTag(t)?!!this.templateHasOneOrZeroChildren(t)||(NAF.log.error("Template for ".concat(e.template," has more than one child. Templates must have one direct child element, no more. Template found:"),t),!1):(NAF.log.error("Template for ".concat(e.template," is not a <template> tag. Instead found: ").concat(t.tagName)),!1)}},{key:"isTemplateTag",value:function(e){return"template"===e.tagName.toLowerCase()}},{key:"templateHasOneOrZeroChildren",value:function(e){return e.content.childElementCount<2}},{key:"remove",value:function(e){delete this.schemaDict[e]}},{key:"clear",value:function(){this.schemaDict={}}}])&&n(t.prototype,r),i&&n(t,i),e}();e.exports=i},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=r(34),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.entities={},this.childCache=new i,this.onRemoteEntityCreatedEvent=new Event("remoteEntityCreated"),this._persistentFirstSyncs={}}var t,r,a;return t=e,(r=[{key:"registerEntity",value:function(e,t){this.entities[e]=t}},{key:"createRemoteEntity",value:function(e){NAF.log.write("Creating remote entity",e);var t=e.networkId,r=NAF.schemas.getCachedTemplate(e.template);return r.setAttribute("id","naf-"+t),this.initPosition(r,e.components),this.initRotation(r,e.components),this.addNetworkComponent(r,e),this.registerEntity(t,r),r}},{key:"initPosition",value:function(e,t){if(t.position){var r=t.position;e.setAttribute("position",r)}}},{key:"initRotation",value:function(e,t){if(t.rotation){var r=t.rotation;e.setAttribute("rotation",r)}}},{key:"addNetworkComponent",value:function(e,t){var r={template:t.template,creator:t.creator,owner:t.owner,networkId:t.networkId,persistent:t.persistent};e.setAttribute("networked",r),e.firstUpdateData=t}},{key:"updateEntityMulti",value:function(e,t,r,n){if(!NAF.options.syncSource||n===NAF.options.syncSource)for(var i=0,a=r.d.length;i<a;i++)this.updateEntity(e,"u",r.d[i],n)}},{key:"updateEntity",value:function(e,t,r,n){if(!NAF.options.syncSource||n===NAF.options.syncSource){var i=r.networkId;this.hasEntity(i)?this.entities[i].components.networked.networkUpdate(r):r.isFirstSync&&(NAF.options.firstSyncSource&&n!==NAF.options.firstSyncSource?NAF.log.write("Ignoring first sync from disallowed source",n):r.persistent?this._persistentFirstSyncs[i]=r:this.receiveFirstUpdateFromEntity(r))}}},{key:"receiveFirstUpdateFromEntity",value:function(e){var t=e.parent,r=e.networkId;if(t&&!this.hasEntity(t))this.childCache.addChild(t,e);else{var n=this.createRemoteEntity(e);this.createAndAppendChildren(r,n),this.addEntityToPage(n,t)}}},{key:"createAndAppendChildren",value:function(e,t){for(var r=this.childCache.getChildren(e),n=0;n<r.length;n++){var i=r[n],a=i.networkId;if(this.hasEntity(a))NAF.log.warn("Tried to instantiate entity multiple times",a,i,"Existing entity:",this.getEntity(a));else{var o=this.createRemoteEntity(i);this.createAndAppendChildren(a,o),t.appendChild(o)}}}},{key:"addEntityToPage",value:function(e,t){this.hasEntity(t)?this.addEntityToParent(e,t):this.addEntityToSceneRoot(e)}},{key:"addEntityToParent",value:function(e,t){document.getElementById("naf-"+t).appendChild(e)}},{key:"addEntityToSceneRoot",value:function(e){document.querySelector("a-scene").appendChild(e)}},{key:"completeSync",value:function(e,t){for(var r in this.entities)this.entities[r]&&this.entities[r].components.networked.syncAll(e,t)}},{key:"removeRemoteEntity",value:function(e,t,r,n){if(!NAF.options.syncSource||n===NAF.options.syncSource){var i=r.networkId;return this.removeEntity(i)}}},{key:"removeEntitiesOfClient",value:function(e){var t=[];for(var r in this.entities)if(NAF.utils.getCreator(this.entities[r])===e){var n=void 0,i=this.entities[r].getAttribute("networked");if(i&&i.persistent&&(n=NAF.utils.takeOwnership(this.entities[r])),!n){var a=this.removeEntity(r);t.push(a)}}return t}},{key:"removeEntity",value:function(e){if(this.forgetPersistentFirstSync(e),this.hasEntity(e)){var t=this.entities[e];return this.forgetEntity(e),t.parentNode.removeChild(t),t}return NAF.log.error("Tried to remove entity I don't have."),null}},{key:"forgetEntity",value:function(e){delete this.entities[e],this.forgetPersistentFirstSync(e)}},{key:"getPersistentFirstSync",value:function(e){return this._persistentFirstSyncs[e]}},{key:"forgetPersistentFirstSync",value:function(e){delete this._persistentFirstSyncs[e]}},{key:"getEntity",value:function(e){return this.entities[e]?this.entities[e]:null}},{key:"hasEntity",value:function(e){return!!this.entities[e]}},{key:"removeRemoteEntities",value:function(){for(var e in this.childCache=new i,this.entities)this.entities[e].getAttribute("networked").owner!=NAF.clientId&&this.removeEntity(e)}}])&&n(t.prototype,r),a&&n(t,a),e}();e.exports=a},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dict={}}var t,r,i;return t=e,(r=[{key:"addChild",value:function(e,t){this.hasParent(e)||(this.dict[e]=[]),this.dict[e].push(t)}},{key:"getChildren",value:function(e){if(!this.hasParent(e))return[];var t=this.dict[e];return delete this.dict[e],t}},{key:"hasParent",value:function(e){return!!this.dict[e]}}])&&n(t.prototype,r),i&&n(t,i),e}();e.exports=i},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i="u",a="um",o="r",s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.entities=t,this.setupDefaultDataSubscriptions(),this.connectedClients={},this.activeDataChannels={}}var t,r,s;return t=e,(r=[{key:"setNetworkAdapter",value:function(e){this.adapter=e}},{key:"setupDefaultDataSubscriptions",value:function(){this.dataChannelSubs={},this.dataChannelSubs[i]=this.entities.updateEntity.bind(this.entities),this.dataChannelSubs[a]=this.entities.updateEntityMulti.bind(this.entities),this.dataChannelSubs[o]=this.entities.removeRemoteEntity.bind(this.entities)}},{key:"connect",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];NAF.app=t,NAF.room=r,this.adapter.setServerUrl(e),this.adapter.setApp(t),this.adapter.setRoom(r);var i={audio:n,video:!1,datachannel:!0};return this.adapter.setWebRtcOptions(i),this.adapter.setServerConnectListeners(this.connectSuccess.bind(this),this.connectFailure.bind(this)),this.adapter.setDataChannelListeners(this.dataChannelOpen.bind(this),this.dataChannelClosed.bind(this),this.receivedData.bind(this)),this.adapter.setRoomOccupantListener(this.occupantsReceived.bind(this)),this.adapter.connect()}},{key:"onConnect",value:function(e){this.onConnectCallback=e,this.isConnected()?e():document.body.addEventListener("connected",e,!1)}},{key:"connectSuccess",value:function(e){NAF.log.write("Networked-Aframe Client ID:",e),NAF.clientId=e;var t=new CustomEvent("connected",{detail:{clientId:e}});document.body.dispatchEvent(t)}},{key:"connectFailure",value:function(e,t){NAF.log.error(e,"failure to connect")}},{key:"occupantsReceived",value:function(e){var t=Object.assign({},this.connectedClients);this.connectedClients=e,this.checkForDisconnectingClients(t,e),this.checkForConnectingClients(e)}},{key:"checkForDisconnectingClients",value:function(e,t){for(var r in e)t[r]||(NAF.log.write("Closing stream to ",r),this.adapter.closeStreamConnection(r))}},{key:"checkForConnectingClients",value:function(e){for(var t in e)this.isNewClient(t)&&this.adapter.shouldStartConnectionTo(e[t])&&(NAF.log.write("Opening datachannel to ",t),this.adapter.startStreamConnection(t))}},{key:"getConnectedClients",value:function(){return this.connectedClients}},{key:"isConnected",value:function(){return!!NAF.clientId}},{key:"isMineAndConnected",value:function(e){return this.isConnected()&&NAF.clientId===e}},{key:"isNewClient",value:function(e){return!this.isConnectedTo(e)}},{key:"isConnectedTo",value:function(e){return this.adapter.getConnectStatus(e)===NAF.adapters.IS_CONNECTED}},{key:"dataChannelOpen",value:function(e){NAF.log.write("Opened data channel from "+e),this.activeDataChannels[e]=!0,this.entities.completeSync(e,!0);var t=new CustomEvent("clientConnected",{detail:{clientId:e}});document.body.dispatchEvent(t)}},{key:"dataChannelClosed",value:function(e){NAF.log.write("Closed data channel from "+e),this.activeDataChannels[e]=!1,this.entities.removeEntitiesOfClient(e);var t=new CustomEvent("clientDisconnected",{detail:{clientId:e}});document.body.dispatchEvent(t)}},{key:"hasActiveDataChannel",value:function(e){return!(!this.activeDataChannels[e]||!this.activeDataChannels[e])}},{key:"broadcastData",value:function(e,t){this.adapter.broadcastData(e,t)}},{key:"broadcastDataGuaranteed",value:function(e,t){this.adapter.broadcastDataGuaranteed(e,t)}},{key:"sendData",value:function(e,t,r,n){this.hasActiveDataChannel(e)&&(n?this.adapter.sendDataGuaranteed(e,t,r):this.adapter.sendData(e,t,r))}},{key:"sendDataGuaranteed",value:function(e,t,r){this.sendData(e,t,r,!0)}},{key:"subscribeToDataChannel",value:function(e,t){this.isReservedDataType(e)?NAF.log.error("NetworkConnection@subscribeToDataChannel: "+e+" is a reserved dataType. Choose another"):this.dataChannelSubs[e]=t}},{key:"unsubscribeToDataChannel",value:function(e){this.isReservedDataType(e)?NAF.log.error("NetworkConnection@unsubscribeToDataChannel: "+e+" is a reserved dataType. Choose another"):delete this.dataChannelSubs[e]}},{key:"isReservedDataType",value:function(e){return e==i||e==o}},{key:"receivedData",value:function(e,t,r,n){this.dataChannelSubs[t]?this.dataChannelSubs[t](e,t,r,n):NAF.log.write("NetworkConnection@receivedData: "+t+" has not been subscribed to yet. Call subscribeToDataChannel()")}},{key:"getServerTime",value:function(){return this.adapter.getServerTime()}},{key:"disconnect",value:function(){this.entities.removeRemoteEntities(),this.adapter.disconnect(),NAF.app="",NAF.room="",NAF.clientId="",this.connectedClients={},this.activeDataChannels={},this.adapter=null,this.setupDefaultDataSubscriptions(),document.body.removeEventListener("connected",this.onConnectCallback)}}])&&n(t.prototype,r),s&&n(t,s),e}();e.exports=s},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=r(37),a=r(38),o=r(39),s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adapters={socketio:a,webrtc:i,nwclientapi:o},this.IS_CONNECTED=e.IS_CONNECTED,this.CONNECTING=e.CONNECTING,this.NOT_CONNECTED=e.NOT_CONNECTED}var t,r,s;return t=e,(r=[{key:"register",value:function(e,t){this.adapters[e]=t}},{key:"make",value:function(e){var t=e.toLowerCase();if(this.adapters[t])return new(0,this.adapters[t]);throw"easyrtc"===t||"wseasyrtc"==t?new Error("Adapter: "+e+" not registered. EasyRTC support was removed in Networked-Aframe 0.7.0. To use the deprecated EasyRTC adapter see https://github.com/networked-aframe/naf-easyrtc-adapter"):new Error("Adapter: "+e+" not registered. Please use NAF.adapters.register() to register this adapter.")}}])&&n(t.prototype,r),s&&n(t,s),e}();s.IS_CONNECTED="IS_CONNECTED",s.CONNECTING="CONNECTING",s.NOT_CONNECTED="NOT_CONNECTED",e.exports=s},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}var o=function(){function e(t,r,i){n(this,e),this.localId=t,this.remoteId=r,this.sendSignalFunc=i,this.open=!1,this.channelLabel="networked-aframe-channel",this.pc=this.createPeerConnection(),this.channel=null}return a(e,[{key:"setDatachannelListeners",value:function(e,t,r,n){this.openListener=e,this.closedListener=t,this.messageListener=r,this.trackListener=n}},{key:"offer",value:function(e){var t=this;this.setupChannel(this.pc.createDataChannel(this.channelLabel,{reliable:!1})),e.sendAudio&&e.localAudioStream.getTracks().forEach((function(r){return t.pc.addTrack(r,e.localAudioStream)})),this.pc.createOffer((function(e){t.handleSessionDescription(e)}),(function(e){NAF.log.error("WebRtcPeer.offer: "+e)}),{offerToReceiveAudio:!0,offerToReceiveVideo:!1})}},{key:"handleSignal",value:function(e){if(this.localId===e.to&&this.remoteId===e.from)switch(e.type){case"offer":this.handleOffer(e);break;case"answer":this.handleAnswer(e);break;case"candidate":this.handleCandidate(e);break;default:NAF.log.error("WebRtcPeer.handleSignal: Unknown signal type "+e.type)}}},{key:"send",value:function(e,t){null!==this.channel&&"open"===this.channel.readyState&&this.channel.send(JSON.stringify({type:e,data:t}))}},{key:"getStatus",value:function(){if(null===this.channel)return e.NOT_CONNECTED;switch(this.channel.readyState){case"open":return e.IS_CONNECTED;case"connecting":return e.CONNECTING;case"closing":case"closed":default:return e.NOT_CONNECTED}}},{key:"createPeerConnection",value:function(){var t=this,r=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection;if(void 0===r)throw new Error("WebRtcPeer.createPeerConnection: This browser does not seem to support WebRTC.");var n=new r({iceServers:e.ICE_SERVERS});return n.onicecandidate=function(e){e.candidate&&t.sendSignalFunc({from:t.localId,to:t.remoteId,type:"candidate",sdpMLineIndex:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate})},n.oniceconnectionstatechange=function(){t.open&&"disconnected"===n.iceConnectionState&&(t.open=!1,t.closedListener(t.remoteId))},n.ontrack=function(e){t.trackListener(t.remoteId,e.streams[0])},n}},{key:"setupChannel",value:function(e){var t=this;this.channel=e,this.channel.onmessage=function(e){var r=JSON.parse(e.data);t.messageListener(t.remoteId,r.type,r.data)},this.channel.onopen=function(e){t.open=!0,t.openListener(t.remoteId)},this.channel.onclose=function(e){t.open&&(t.open=!1,t.closedListener(t.remoteId))},this.channel.onerror=function(e){NAF.log.error("WebRtcPeer.channel.onerror: "+e)}}},{key:"handleOffer",value:function(e){var t=this;this.pc.ondatachannel=function(e){t.setupChannel(e.channel)},this.setRemoteDescription(e),this.pc.createAnswer((function(e){t.handleSessionDescription(e)}),(function(e){NAF.log.error("WebRtcPeer.handleOffer: "+e)}))}},{key:"handleAnswer",value:function(e){this.setRemoteDescription(e)}},{key:"handleCandidate",value:function(e){var t=window.RTCIceCandidate||window.webkitRTCIceCandidate||window.mozRTCIceCandidate;this.pc.addIceCandidate(new t(e),(function(){}),(function(e){NAF.log.error("WebRtcPeer.handleCandidate: "+e)}))}},{key:"handleSessionDescription",value:function(e){this.pc.setLocalDescription(e,(function(){}),(function(e){NAF.log.error("WebRtcPeer.handleSessionDescription: "+e)})),this.sendSignalFunc({from:this.localId,to:this.remoteId,type:e.type,sdp:e.sdp})}},{key:"setRemoteDescription",value:function(e){var t=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription||window.msRTCSessionDescription;this.pc.setRemoteDescription(new t(e),(function(){}),(function(e){NAF.log.error("WebRtcPeer.setRemoteDescription: "+e)}))}},{key:"close",value:function(){this.pc&&this.pc.close()}}]),e}();o.IS_CONNECTED="IS_CONNECTED",o.CONNECTING="CONNECTING",o.NOT_CONNECTED="NOT_CONNECTED",o.ICE_SERVERS=[{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}];var s=function(){function e(){n(this,e),void 0===io&&console.warn("It looks like socket.io has not been loaded before WebrtcAdapter. Please do that."),this.app="default",this.room="default",this.occupantListener=null,this.myRoomJoinTime=null,this.myId=null,this.peers={},this.occupants={},this.audioStreams={},this.pendingAudioRequest={},this.serverTimeRequests=0,this.timeOffsets=[],this.avgTimeOffset=0}return a(e,[{key:"setServerUrl",value:function(e){this.wsUrl=e}},{key:"setApp",value:function(e){this.app=e}},{key:"setRoom",value:function(e){this.room=e}},{key:"setWebRtcOptions",value:function(e){!1===e.datachannel&&NAF.log.error("WebrtcAdapter.setWebRtcOptions: datachannel must be true."),!0===e.audio&&(this.sendAudio=!0),!0===e.video&&NAF.log.warn("WebrtcAdapter does not support video yet.")}},{key:"setServerConnectListeners",value:function(e,t){this.connectSuccess=e,this.connectFailure=t}},{key:"setRoomOccupantListener",value:function(e){this.occupantListener=e}},{key:"setDataChannelListeners",value:function(e,t,r){this.openListener=e,this.closedListener=t,this.messageListener=r}},{key:"connect",value:function(){var e=this;this.updateTimeOffset().then((function(){e.wsUrl&&"/"!==e.wsUrl||("https:"===location.protocol?e.wsUrl="wss://"+location.host:e.wsUrl="ws://"+location.host),NAF.log.write("Attempting to connect to socket.io");var t=e.socket=io(e.wsUrl);function r(t){var r=t.from,n=t.type,i=t.data;"ice-candidate"!==n?e.messageListener(r,n,i):e.peers[r].handleSignal(i)}t.on("connect",(function(){NAF.log.write("User connected",t.id),e.myId=t.id,e.joinRoom()})),t.on("connectSuccess",(function(t){var r=t.joinedTime;if(e.myRoomJoinTime=r,NAF.log.write("Successfully joined room",e.room,"at server time",r),e.sendAudio){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(t){e.storeAudioStream(e.myId,t),e.connectSuccess(e.myId),t.getTracks().forEach((function(r){Object.keys(e.peers).forEach((function(n){e.peers[n].pc.addTrack(r,t)}))}))})).catch((function(t){NAF.log.error(t),console.error("Microphone is disabled due to lack of permissions"),e.sendAudio=!1,e.connectSuccess(e.myId)}))}else e.connectSuccess(e.myId)})),t.on("error",(function(t){console.error("Socket connection failure",t),e.connectFailure()})),t.on("occupantsChanged",(function(t){var r=t.occupants;NAF.log.write("occupants changed",t),e.receivedOccupants(r)})),t.on("send",r),t.on("broadcast",r)}))}},{key:"joinRoom",value:function(){NAF.log.write("Joining room",this.room),this.socket.emit("joinRoom",{room:this.room})}},{key:"receivedOccupants",value:function(e){var t=this;delete e[this.myId],this.occupants=e;var r=this,n=this.myId,i=function(e){var i=e;if(t.peers[i])return"continue";var a=new o(n,i,(function(e){r.socket.emit("send",{from:n,to:i,type:"ice-candidate",data:e,sending:!0})}));a.setDatachannelListeners(r.openListener,r.closedListener,r.messageListener,r.trackListener.bind(r)),r.peers[i]=a};for(var a in e)i(a);this.occupantListener(e)}},{key:"shouldStartConnectionTo",value:function(e){return(this.myRoomJoinTime||0)<=(e||0)}},{key:"startStreamConnection",value:function(e){var t=this;NAF.log.write("starting offer process"),this.sendAudio?this.getMediaStream(this.myId).then((function(r){var n={sendAudio:!0,localAudioStream:r};t.peers[e].offer(n)})):this.peers[e].offer({})}},{key:"closeStreamConnection",value:function(e){NAF.log.write("closeStreamConnection",e,this.peers),this.peers[e].close(),delete this.peers[e],delete this.occupants[e],this.closedListener(e)}},{key:"getConnectStatus",value:function(e){var t=this.peers[e];if(void 0===t)return NAF.adapters.NOT_CONNECTED;switch(t.getStatus()){case o.IS_CONNECTED:return NAF.adapters.IS_CONNECTED;case o.CONNECTING:return NAF.adapters.CONNECTING;case o.NOT_CONNECTED:default:return NAF.adapters.NOT_CONNECTED}}},{key:"sendData",value:function(e,t,r){this.peers[e].send(t,r)}},{key:"sendDataGuaranteed",value:function(e,t,r){var n={from:this.myId,to:e,type:t,data:r,sending:!0};this.socket.emit("send",n)}},{key:"broadcastData",value:function(e,t){for(var r in this.peers)this.sendData(r,e,t)}},{key:"broadcastDataGuaranteed",value:function(e,t){var r={from:this.myId,type:e,data:t,broadcasting:!0};this.socket.emit("broadcast",r)}},{key:"storeAudioStream",value:function(e,t){this.audioStreams[e]=t,this.pendingAudioRequest[e]&&(NAF.log.write("Received pending audio for "+e),this.pendingAudioRequest[e](t),this.pendingAudioRequest[e](t))}},{key:"trackListener",value:function(e,t){this.storeAudioStream(e,t)}},{key:"getMediaStream",value:function(e){var t=this;return this.audioStreams[e]?(NAF.log.write("Already had audio for "+e),Promise.resolve(this.audioStreams[e])):(NAF.log.write("Waiting on audio for "+e),new Promise((function(r){t.pendingAudioRequest[e]=r})))}},{key:"updateTimeOffset",value:function(){var e=this,t=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:"HEAD",cache:"no-cache"}).then((function(r){var n=new Date(r.headers.get("Date")).getTime()+500,i=Date.now(),a=n+(i-t)/2-i;e.serverTimeRequests++,e.serverTimeRequests<=10?e.timeOffsets.push(a):e.timeOffsets[e.serverTimeRequests%10]=a,e.avgTimeOffset=e.timeOffsets.reduce((function(e,t){return e+t}),0)/e.timeOffsets.length,e.serverTimeRequests>10?setTimeout((function(){return e.updateTimeOffset()}),3e5):e.updateTimeOffset()}))}},{key:"getServerTime",value:function(){return(new Date).getTime()+this.avgTimeOffset}}]),e}();e.exports=s},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===io&&console.warn("It looks like socket.io has not been loaded before SocketioAdapter. Please do that."),this.app="default",this.room="default",this.occupantListener=null,this.myRoomJoinTime=null,this.myId=null,this.occupants={},this.connectedClients=[],this.serverTimeRequests=0,this.timeOffsets=[],this.avgTimeOffset=0}var t,r,i;return t=e,(r=[{key:"setServerUrl",value:function(e){this.wsUrl=e}},{key:"setApp",value:function(e){this.app=e}},{key:"setRoom",value:function(e){this.room=e}},{key:"setWebRtcOptions",value:function(e){}},{key:"setServerConnectListeners",value:function(e,t){this.connectSuccess=e,this.connectFailure=t}},{key:"setRoomOccupantListener",value:function(e){this.occupantListener=e}},{key:"setDataChannelListeners",value:function(e,t,r){this.openListener=e,this.closedListener=t,this.messageListener=r}},{key:"connect",value:function(){var e=this;this.updateTimeOffset().then((function(){e.wsUrl&&"/"!==e.wsUrl||("https:"===location.protocol?e.wsUrl="wss://"+location.host:e.wsUrl="ws://"+location.host),NAF.log.write("Attempting to connect to socket.io");var t=e.socket=io(e.wsUrl);function r(t){var r=t.from,n=t.type,i=t.data;e.messageListener(r,n,i)}t.on("connect",(function(){NAF.log.write("User connected",t.id),e.myId=t.id,e.joinRoom()})),t.on("connectSuccess",(function(t){var r=t.joinedTime;e.myRoomJoinTime=r,NAF.log.write("Successfully joined room",e.room,"at server time",r),e.connectSuccess(e.myId)})),t.on("error",(function(t){console.error("Socket connection failure",t),e.connectFailure()})),t.on("occupantsChanged",(function(t){var r=t.occupants;NAF.log.write("occupants changed",t),e.receivedOccupants(r)})),t.on("send",r),t.on("broadcast",r)}))}},{key:"joinRoom",value:function(){NAF.log.write("Joining room",this.room),this.socket.emit("joinRoom",{room:this.room})}},{key:"receivedOccupants",value:function(e){delete e[this.myId],this.occupants=e,this.occupantListener(e)}},{key:"shouldStartConnectionTo",value:function(e){return!0}},{key:"startStreamConnection",value:function(e){this.connectedClients.push(e),this.openListener(e)}},{key:"closeStreamConnection",value:function(e){this.connectedClients=this.connectedClients.filter((function(t){return t!=e})),this.closedListener(e)}},{key:"getConnectStatus",value:function(e){return-1!=this.connectedClients.indexOf(e)?NAF.adapters.IS_CONNECTED:NAF.adapters.NOT_CONNECTED}},{key:"sendData",value:function(e,t,r){this.sendDataGuaranteed(e,t,r)}},{key:"sendDataGuaranteed",value:function(e,t,r){var n={from:this.myId,to:e,type:t,data:r,sending:!0};this.socket?this.socket.emit("send",n):NAF.log.warn("SocketIO socket not created yet")}},{key:"broadcastData",value:function(e,t){this.broadcastDataGuaranteed(e,t)}},{key:"broadcastDataGuaranteed",value:function(e,t){var r={from:this.myId,type:e,data:t,broadcasting:!0};this.socket?this.socket.emit("broadcast",r):NAF.log.warn("SocketIO socket not created yet")}},{key:"getMediaStream",value:function(e){}},{key:"updateTimeOffset",value:function(){var e=this,t=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:"HEAD",cache:"no-cache"}).then((function(r){var n=new Date(r.headers.get("Date")).getTime()+500,i=Date.now(),a=n+(i-t)/2-i;e.serverTimeRequests++,e.serverTimeRequests<=10?e.timeOffsets.push(a):e.timeOffsets[e.serverTimeRequests%10]=a,e.avgTimeOffset=e.timeOffsets.reduce((function(e,t){return e+t}),0)/e.timeOffsets.length,e.serverTimeRequests>10?setTimeout((function(){return e.updateTimeOffset()}),3e5):e.updateTimeOffset()}))}},{key:"getServerTime",value:function(){return(new Date).getTime()+this.avgTimeOffset}}])&&n(t.prototype,r),i&&n(t,i),e}();e.exports=i},function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){s(a,n,i,o,c,"next",e)}function c(e){s(a,n,i,o,c,"throw",e)}o(void 0)}))}}function u(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=d(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function d(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var f=r(40),h=r(65),m=r(80),y=r(83).uuid,v=m("naf-nwclientapi-adapter:debug"),g=m("naf-nwclientapi-adapter:error"),b=m("naf-nwclientapi-adapter:info"),w={optional:[{googDscp:!0}]},_=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._forceTcp=!1,this._timeOffsets=[],this._occupants={},this._micProducer=null,this._videoProducer=null,this._mediaStreams={},this._localMediaStream=null,this._consumers=new Map,this._frozenUpdates=new Map,this._pendingMediaRequests=new Map,this._micEnabled=!0,this._initialAudioConsumerPromise=null,this._initialAudioConsumerResolvers=new Map,this._serverTimeRequests=0,this._avgTimeOffset=0,this._blockedClients=new Map,this.type="dialog",this.occupants=[],this._clientId=y(),this._pendingBroadcasts=[]}var t,r,i,o,s,d;return t=e,(r=[{key:"setForceTcp",value:function(e){this._forceTcp=e}},{key:"setServerUrl",value:function(e){this._serverUrl=e}},{key:"setJoinToken",value:function(e){this._joinToken=e}},{key:"setPeerConnectionConfig",value:function(e){e.iceServers&&(this._iceServers=e.iceServers),e.iceTransportPolicy&&(this._iceTransportPolicy=e.iceTransportPolicy)}},{key:"setApp",value:function(){}},{key:"setRoom",value:function(e){this._roomId=e}},{key:"setClientId",value:function(e){this._clientId=e}},{key:"setServerConnectListeners",value:function(e,t){this._connectSuccess=e,this._connectFailure=t}},{key:"setRoomOccupantListener",value:function(e){this._onOccupantsChanged=e}},{key:"setDataChannelListeners",value:function(e,t,r){this._onOccupantConnected=e,this._onOccupantDisconnected=t,this._onOccupantMessage=r}},{key:"dumpConsumers",value:function(){if(this._consumers.size){console.log("consumers:");var e,t=u(this._consumers.entries());try{for(t.s();!(e=t.n()).done;){var r=e.value;console.log(r[0],r[1])}}catch(e){t.e(e)}finally{t.f()}}}},{key:"connect",value:(d=c(regeneratorRuntime.mark((function e(){var t,r,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new URL(this._serverUrl)).searchParams.append("roomId",this._roomId),t.searchParams.append("peerId",this._clientId),r=new h.WebSocketTransport(t.toString()),this._protoo=new h.Peer(r),e.next=7,new Promise((function(e){n._protoo.on("open",c(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("protoo opened. about to join room"),n._closed=!1,t.next=4,n._joinRoom();case 4:e();case 5:case"end":return t.stop()}}),t)}))))}));case 7:return this._protoo.on("disconnected",(function(){return n.disconnect()})),this._protoo.on("close",(function(){return n.disconnect()})),this._protoo.on("request",function(){var e=c(regeneratorRuntime.mark((function e(t,r,i){var o,s,c,u,d,p,l,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:v('proto "request" event [method:%s, data:%o]',t.method,t.data),e.t0=t.method,e.next="newConsumer"===e.t0?4:23;break;case 4:return o=t.data,s=o.peerId,c=o.producerId,u=o.id,d=o.kind,p=o.rtpParameters,l=o.appData,e.prev=5,console.log("creating a consumer on the transport"),e.next=9,n._recvTransport.consume({id:u,producerId:c,kind:d,rtpParameters:p,appData:a(a({},l),{},{peerId:s})});case 9:f=e.sent,n._consumers.set(f.id,f),n.dumpConsumers(),f.on("transportclose",(function(){return n.removeConsumer(f.id)})),r(),n.resolvePendingMediaRequestForTrack(s,f.track),"audio"===d&&(h=n._initialAudioConsumerResolvers.get(s))&&(h(),n._initialAudioConsumerResolvers.delete(s)),e.next=22;break;case 18:throw e.prev=18,e.t1=e.catch(5),g('"newConsumer" request failed:%o',e.t1),e.t1;case 22:return e.abrupt("break",23);case 23:case"end":return e.stop()}}),e,null,[[5,18]])})));return function(t,r,n){return e.apply(this,arguments)}}()),this._protoo.on("notification",(function(e){switch(v('proto "notification" event [method:%s, data:%o]',e.method,e.data),e.method){case"newPeer":var t=e.data;n._onOccupantConnected(t.id),n.occupants.push(t.id);break;case"peerClosed":var r=e.data.peerId;n._onOccupantDisconnected(r);var i=n._pendingMediaRequests.get(r);i&&(b("The user disconnected before the media stream was resolved."),i.audio&&i.audio.resolve(null),i.video&&i.video.resolve(null),n._pendingMediaRequests.delete(r));var a=n._initialAudioConsumerResolvers.get(r);a&&(a(),n._initialAudioConsumerResolvers.delete(r)),n.occupants=n.occupants.filter((function(e){return e!==r}));break;case"consumerClosed":var o=e.data.consumerId,s=n._consumers.get(o);if(!s)break;s.close(),n.removeConsumer(s.id);break;case"peerBlocked":var c=e.data.peerId;document.body.dispatchEvent(new CustomEvent("blocked",{detail:{clientId:c}}));break;case"peerUnblocked":var u=e.data.peerId;document.body.dispatchEvent(new CustomEvent("unblocked",{detail:{clientId:u}}));break;case"newBroadcastData":var d=e.data,p=d.clientId,l=d.dataType,f=d.data;n._onOccupantMessage(p,l,f,null)}})),e.next=13,Promise.all([this.updateTimeOffset(),this._initialAudioConsumerPromise]);case 13:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"shouldStartConnectionTo",value:function(){return!0}},{key:"startStreamConnection",value:function(){}},{key:"closeStreamConnection",value:function(){}},{key:"resolvePendingMediaRequestForTrack",value:function(e,t){var r=this._pendingMediaRequests.get(e);if(r&&r[t.kind]){var n=r[t.kind].resolve;delete r[t.kind],n(new MediaStream([t]))}r&&0===Object.keys(r).length&&this._pendingMediaRequests.delete(e)}},{key:"removeConsumer",value:function(e){this._consumers.delete(e)}},{key:"getConnectStatus",value:function(){return this._protoo.connected?NAF.adapters.IS_CONNECTED:NAF.adapters.NOT_CONNECTED}},{key:"getMediaStream",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio";if(this._clientId===e?"audio"===r&&this._micProducer?t=this._micProducer.track:"video"===r&&this._videoProducer&&(t=this._videoProducer.track):this._consumers.forEach((function(n){n.appData.peerId===e&&r==n.track.kind&&(t=n.track)})),t)return v("Already had ".concat(r," for ").concat(e)),Promise.resolve(new MediaStream([t]));v("Waiting on ".concat(r," for ").concat(e)),this._pendingMediaRequests.has(e)||this._pendingMediaRequests.set(e,{});var n=this._pendingMediaRequests.get(e),i=new Promise((function(e,t){return n[r]={resolve:e,reject:t}}));return n[r].promise=i,i.catch((function(t){return console.warn("".concat(e," getMediaStream Error"),t)})),i}},{key:"getServerTime",value:function(){return Date.now()+this._avgTimeOffset}},{key:"sendDataToAllOccupants",value:function(e){if(this._protoo&&this._protoo.connected){for(var t=0;t<this._pendingBroadcasts.length;t++)this._protoo.request("broadcastDataToPeers",this._pendingBroadcasts[t]);this._pendingBroadcasts.length=0,this._protoo.request("broadcastDataToPeers",e)}else this._pendingBroadcasts.push(e)}},{key:"sendData",value:function(e,t,r){this.sendDataToAllOccupants({clientId:this._clientId,dataType:t,data:r})}},{key:"sendDataGuaranteed",value:function(e,t,r){this.sendDataToAllOccupants({clientId:this._clientId,dataType:t,data:r})}},{key:"broadcastData",value:function(e,t){this.sendDataToAllOccupants({clientId:this._clientId,dataType:e,data:t})}},{key:"broadcastDataGuaranteed",value:function(e,t){this.sendDataToAllOccupants({clientId:this._clientId,dataType:e,data:t})}},{key:"setReconnectionListeners",value:function(e,t,r){this._reconnectingListener=e,this._reconnectedListener=t,this._reconnectionErrorListener=r}},{key:"syncOccupants",value:function(){}},{key:"_joinRoom",value:(s=c(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,s,u,d=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v("_joinRoom()"),e.prev=1,this._mediasoupDevice=new f.Device({}),e.next=5,this._protoo.request("getRouterRtpCapabilities");case 5:return t=e.sent,e.next=8,this._mediasoupDevice.load({routerRtpCapabilities:t});case 8:return e.next=10,this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!0,consuming:!1,sctpCapabilities:void 0});case 10:return r=e.sent,this._sendTransport=this._mediasoupDevice.createSendTransport({id:r.id,iceParameters:r.iceParameters,iceCandidates:r.iceCandidates,dtlsParameters:r.dtlsParameters,sctpParameters:r.sctpParameters,iceServers:this._iceServers,iceTransportPolicy:this._iceTransportPolicy,proprietaryConstraints:w}),this._sendTransport.on("connect",(function(e,t,r){var n=e.dtlsParameters;d._protoo.request("connectWebRtcTransport",{transportId:d._sendTransport.id,dtlsParameters:n}).then(t).catch(r)})),this._sendTransport.on("produce",function(){var e=c(regeneratorRuntime.mark((function e(t,r,n){var i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.kind,a=t.rtpParameters,o=t.appData,e.prev=1,e.next=4,d._protoo.request("produce",{transportId:d._sendTransport.id,kind:i,rtpParameters:a,appData:o});case 4:s=e.sent,c=s.id,r({id:c}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),n(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r,n){return e.apply(this,arguments)}}()),e.next=16,this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!1,consuming:!0,sctpCapabilities:void 0});case 16:return n=e.sent,this._recvTransport=this._mediasoupDevice.createRecvTransport({id:n.id,iceParameters:n.iceParameters,iceCandidates:n.iceCandidates,dtlsParameters:n.dtlsParameters,sctpParameters:n.sctpParameters,iceServers:this._iceServers}),this._recvTransport.on("connect",(function(e,t,r){var n=e.dtlsParameters;d._protoo.request("connectWebRtcTransport",{transportId:d._recvTransport.id,dtlsParameters:n}).then(t).catch(r)})),e.next=21,this._protoo.request("join",{displayName:this._clientId,device:this._device,rtpCapabilities:this._mediasoupDevice.rtpCapabilities,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0,token:this._joinToken});case 21:i=e.sent,a=i.peers,o=[],this.occupants=[],s=function(e){var t=a[e].id;if(d.occupants.push(t),!a[e].hasProducers)return"continue";o.push(new Promise((function(e){return d._initialAudioConsumerResolvers.set(t,e)})))},u=0;case 27:if(!(u<a.length)){e.next=34;break}if("continue"!==s(u)){e.next=31;break}return e.abrupt("continue",31);case 31:u++,e.next=27;break;case 34:this._connectSuccess(this._clientId),this._initialAudioConsumerPromise=Promise.all(o),this._localMediaStream&&this.createMissingProducers(this._localMediaStream),e.next=43;break;case 39:e.prev=39,e.t0=e.catch(1),g("_joinRoom() failed:%o",e.t0),this.disconnect();case 43:case"end":return e.stop()}}),e,this,[[1,39]])}))),function(){return s.apply(this,arguments)})},{key:"setLocalMediaStream",value:function(e){this.createMissingProducers(e)}},{key:"createMissingProducers",value:function(e){var t=this;if(this._sendTransport){var r=!1,n=!1;e.getTracks().forEach(function(){var e=c(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("audio"!==i.kind){e.next=14;break}if(r=!0,!t._micProducer){e.next=6;break}t._micProducer.track!==i&&(t._micProducer.track.stop(),t._micProducer.replaceTrack(i)),e.next=12;break;case 6:return t._micEnabled||(i.enabled=!1),e.next=9,t._sendTransport.produce({track:i,stopTracks:!1,codecOptions:{opusStereo:!1,opusDtx:!0}});case 9:t._micProducer=e.sent,t._micProducer.on("transportclose",(function(){return t._micProducer=null})),t._micEnabled||t._micProducer.pause();case 12:e.next=23;break;case 14:if(n=!0,!t._videoProducer){e.next=19;break}t._videoProducer.track!==i&&(t._videoProducer.track.stop(),t._videoProducer.replaceTrack(i)),e.next=23;break;case 19:return e.next=21,t._sendTransport.produce({track:i,stopTracks:!1,codecOptions:{videoGoogleStartBitrate:1e3}});case 21:t._videoProducer=e.sent,t._videoProducer.on("transportclose",(function(){return t._videoProducer=null}));case 23:t.resolvePendingMediaRequestForTrack(t._clientId,i);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),!r&&this._micProducer&&(this._micProducer.close(),this._protoo.request("closeProducer",{producerId:this._micProducer.id}),this._micProducer=null),!n&&this._videoProducer&&(this._videoProducer.close(),this._protoo.request("closeProducer",{producerId:this._videoProducer.id}),this._videoProducer=null),this._localMediaStream=e}}},{key:"enableMicrophone",value:function(e){this._micProducer&&(e?this._micProducer.resume():this._micProducer.pause()),this._micEnabled=e}},{key:"setWebRtcOptions",value:function(){}},{key:"isDisconnected",value:function(){return!this._protoo.connected}},{key:"disconnect",value:function(){if(!this._closed){this._closed=!0;for(var e=0;e<this.occupants.length;e++){var t=this.occupants[e];t!==this._clientId&&this._onOccupantDisconnected(t)}this.occupants=[],v("disconnect()"),this._protoo&&this._protoo.connected&&this._protoo.close(),this._sendTransport&&this._sendTransport.close(),this._recvTransport&&this._recvTransport.close()}}},{key:"reconnect",value:function(){var e=this;this.disconnect(),this.connect().then((function(){e.reconnectionDelay=e.initialReconnectionDelay,e.reconnectionAttempts=0,e._reconnectedListener&&e._reconnectedListener()})).catch((function(t){if(e.reconnectionDelay+=1e3,e.reconnectionAttempts++,e.reconnectionAttempts>e.maxReconnectionAttempts&&e._reconnectionErrorListener)return e._reconnectionErrorListener(new Error("Connection could not be reestablished, exceeded maximum number of reconnection attempts."));console.warn("Error during reconnect, retrying."),console.warn(t),e._reconnectingListener&&e._reconnectingListener(e.reconnectionDelay),e.reconnectionTimeout=setTimeout((function(){return e.reconnect()}),e.reconnectionDelay)}))}},{key:"kick",value:function(e,t){return this._protoo.request("kick",{room_id:this.room,user_id:e,token:t}).then((function(){document.body.dispatchEvent(new CustomEvent("kicked",{detail:{clientId:e}}))}))}},{key:"block",value:function(e){var t=this;return this._protoo.request("block",{whom:e}).then((function(){t._blockedClients.set(e,!0),document.body.dispatchEvent(new CustomEvent("blocked",{detail:{clientId:e}}))}))}},{key:"unblock",value:function(e){var t=this;return this._protoo.request("unblock",{whom:e}).then((function(){t._blockedClients.delete(e),document.body.dispatchEvent(new CustomEvent("unblocked",{detail:{clientId:e}}))}))}},{key:"updateTimeOffset",value:(o=c(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isDisconnected()){e.next=2;break}return e.abrupt("return");case 2:return t=Date.now(),e.next=5,fetch(document.location.href,{method:"HEAD",cache:"no-cache"});case 5:r=e.sent,n=new Date(r.headers.get("Date")).getTime()+500,i=Date.now(),a=n+(i-t)/2-i,this._serverTimeRequests++,this._serverTimeRequests<=10?this._timeOffsets.push(a):this._timeOffsets[this._serverTimeRequests%10]=a,this._avgTimeOffset=this._timeOffsets.reduce((function(e,t){return e+t}),0)/this._timeOffsets.length,this._serverTimeRequests>10?(v("new server time offset: ".concat(this._avgTimeOffset,"ms")),setTimeout((function(){return o.updateTimeOffset()}),3e5)):this.updateTimeOffset();case 15:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"toggleFreeze",value:function(){this.frozen?this.unfreeze():this.freeze()}},{key:"freeze",value:function(){this.frozen=!0}},{key:"unfreeze",value:function(){this.frozen=!1,this.flushPendingUpdates()}},{key:"storeMessage",value:function(e){if("um"===e.dataType)for(var t=0,r=e.data.d.length;t<r;t++)this.storeSingleMessage(e,t);else this.storeSingleMessage(e)}},{key:"storeSingleMessage",value:function(e,t){var r=void 0!==t?e.data.d[t]:e.data,n=e.dataType,i=r.networkId;if(this._frozenUpdates.has(i)){var a=this._frozenUpdates.get(i),o="um"===a.dataType?this.dataForUpdateMultiMessage(i,a):a.data,s=r.lastOwnerTime<o.lastOwnerTime,c=r.lastOwnerTime===o.lastOwnerTime;if(s||c&&o.owner>r.owner)return;"r"===n?o&&o.isFirstSync?this._frozenUpdates.delete(i):this._frozenUpdates.set(i,e):o.components&&r.components&&Object.assign(o.components,r.components)}else this._frozenUpdates.set(i,e)}},{key:"onDataChannelMessage",value:function(e,t){this.onData(JSON.parse(e.data),t)}},{key:"onData",value:function(e,t){v.enabled&&v("DC in: ".concat(e)),e.dataType&&(e.source=t,this.frozen?this.storeMessage(e):this._onOccupantMessage(null,e.dataType,e.data,e.source))}},{key:"getPendingData",value:function(e,t){if(!t)return null;var r="um"===t.dataType?this.dataForUpdateMultiMessage(e,t):t.data;return r.owner&&this._blockedClients.has(r.owner)?null:r}},{key:"getPendingDataForNetworkId",value:function(e){return this.getPendingData(e,this._frozenUpdates.get(e))}},{key:"flushPendingUpdates",value:function(){var e,t=u(this._frozenUpdates);try{for(t.s();!(e=t.n()).done;){var r=n(e.value,2),i=r[0],a=r[1],o=this.getPendingData(i,a);if(o){var s="um"===a.dataType?"u":a.dataType;this._onOccupantMessage(null,s,o,a.source)}}}catch(e){t.e(e)}finally{t.f()}this._frozenUpdates.clear()}},{key:"dataForUpdateMultiMessage",value:function(e,t){for(var r=0,n=t.data.d.length;r<n;r++){var i=t.data.d[r];if(i.networkId===e)return i}return null}}])&&l(t.prototype,r),i&&l(t,i),e}();e.exports=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(16);t.Device=n.Device,t.detectDevice=n.detectDevice;var i=r(64);t.types=i,t.version="3.6.9";var a=r(13);t.parseScalabilityMode=a.parse},function(e,t,r){"use strict";(function(e){var r,n,i,a;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}a=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==o(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){t.__esModule=!0,t.default=void 0;var n=r(18),i=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,n){void 0===n&&(n=!1);var i=e.getVersionPrecision(t),a=e.getVersionPrecision(r),o=Math.max(i,a),s=0,c=e.map([t,r],(function(t){var r=o-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(n&&(s=o-Math.min(i,a)),o-=1;o>=s;){if(c[0][o]>c[1][o])return 1;if(c[0][o]===c[1][o]){if(o===s)return 0;o-=1}else if(c[0][o]<c[1][o])return-1}},e.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},e.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var i=e[r];if(t(i,r))return i}},e.assign=function(e){for(var t,r,n=e,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[e].concat(a));var c=function(){var e=a[t];"object"==o(e)&&null!==e&&Object.keys(e).forEach((function(t){n[t]=e[t]}))};for(t=0,r=a.length;t<r;t+=1)c();return e},e.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},e}();t.default=i,e.exports=t.default},18:function(e,t,r){t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(91))&&n.__esModule?n:{default:n},a=r(18);function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function e(){}var t,r;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new i.default(e,t)},e.parse=function(e){return new i.default(e).getResult()},t=e,(r=[{key:"BROWSER_MAP",get:function(){return a.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return a.ENGINE_MAP}},{key:"OS_MAP",get:function(){return a.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return a.PLATFORMS_MAP}}])&&o(t,r),e}();t.default=s,e.exports=t.default},91:function(e,t,r){t.__esModule=!0,t.default=void 0;var n=u(r(92)),i=u(r(93)),a=u(r(94)),s=u(r(95)),c=u(r(17));function u(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=c.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=c.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=c.default.find(a.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=c.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return c.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},n=0,i={},a=0;if(Object.keys(e).forEach((function(t){var s=e[t];"string"==typeof s?(i[t]=s,a+=1):"object"==o(s)&&(r[t]=s,n+=1)})),n>0){var s=Object.keys(r),u=c.default.find(s,(function(e){return t.isOS(e)}));if(u){var d=this.satisfies(r[u]);if(void 0!==d)return d}var p=c.default.find(s,(function(e){return t.isPlatform(e)}));if(p){var l=this.satisfies(r[p]);if(void 0!==l)return l}}if(a>0){var f=Object.keys(i),h=c.default.find(f,(function(e){return t.isBrowser(e,!0)}));if(void 0!==h)return this.compareVersion(i[h])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),i=c.default.getBrowserTypeByAlias(n);return t&&i&&(n=i.toLowerCase()),n===r},t.compareVersion=function(e){var t=[0],r=e,n=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(c.default.compareVersions(i,r,n))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e){return this.isBrowser(e)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=d,e.exports=t.default},92:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},a=/version\/(\d+(\.?_?\d+)+)/i,o=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=i.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=i.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=i.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=i.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=i.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=i.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=i.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=i.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=i.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=i.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=i.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=i.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=i.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=i.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=i.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=i.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=i.default.getFirstMatch(a,e)||i.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=i.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=i.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=i.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=i.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=i.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=i.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=i.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=i.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=i.default.getFirstMatch(a,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:i.default.getFirstMatch(t,e),version:i.default.getSecondMatch(t,e)}}}];t.default=o,e.exports=t.default},93:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},a=r(18),o=[{test:[/Roku\/DVP/],describe:function(e){var t=i.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:a.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=i.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=i.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=i.default.getWindowsVersionName(t);return{name:a.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?) Version\//],describe:function(e){var t=i.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return{name:a.OS_MAP.iOS,version:t}}},{test:[/macintosh/i],describe:function(e){var t=i.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=i.default.getMacOSVersionName(t),n={name:a.OS_MAP.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=i.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:a.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=i.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=i.default.getAndroidVersionName(t),n={name:a.OS_MAP.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=i.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:a.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=i.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||i.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||i.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:a.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=i.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=i.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:a.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:a.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=i.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:a.OS_MAP.PlayStation4,version:t}}}];t.default=o,e.exports=t.default},94:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},a=r(18),o=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=i.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:a.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?) Version\//],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=i.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:a.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:a.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:a.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:a.PLATFORMS_MAP.tv}}}];t.default=o,e.exports=t.default},95:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,i=(n=r(17))&&n.__esModule?n:{default:n},a=r(18),o=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:a.ENGINE_MAP.Blink};var t=i.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:a.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:a.ENGINE_MAP.Trident},r=i.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:a.ENGINE_MAP.Presto},r=i.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:a.ENGINE_MAP.Gecko},r=i.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:a.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:a.ENGINE_MAP.WebKit},r=i.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=o,e.exports=t.default}})},"object"==o(t)&&"object"==o(e)?e.exports=a():(n=[],void 0===(i="function"==typeof(r=a)?r.apply(t,n):r)||(e.exports=i))}).call(this,r(42)(e))},function(e,t,r){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";(function(n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=r(44)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(9))},function(e,t,r){"use strict";function n(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}e.exports=function(e){function t(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return i.colors[Math.abs(t)%i.colors.length]}function i(e){var r;function n(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];if(n.enabled){var o=n,s=Number(new Date),c=s-(r||s);o.diff=c,o.prev=r,o.curr=s,r=s,t[0]=i.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var u=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return e;u++;var n=i.formatters[r];if("function"==typeof n){var a=t[u];e=n.call(o,a),t.splice(u,1),u--}return e})),i.formatArgs.call(o,t);var d=o.log||i.log;d.apply(o,t)}}return n.namespace=e,n.enabled=i.enabled(e),n.useColors=i.useColors(),n.color=t(e),n.destroy=a,n.extend=o,"function"==typeof i.init&&i.init(n),i.instances.push(n),n}function a(){var e=i.instances.indexOf(this);return-1!==e&&(i.instances.splice(e,1),!0)}function o(e,t){var r=i(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return i.debug=i,i.default=i,i.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},i.disable=function(){var e=[].concat(n(i.names.map(s)),n(i.skips.map(s).map((function(e){return"-"+e})))).join(",");return i.enable(""),e},i.enable=function(e){var t;i.save(e),i.names=[],i.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?i.skips.push(new RegExp("^"+e.substr(1)+"$")):i.names.push(new RegExp("^"+e+"$")));for(t=0;t<i.instances.length;t++){var a=i.instances[t];a.enabled=i.enabled(a.namespace)}},i.enabled=function(e){if("*"===e[e.length-1])return!0;var t,r;for(t=0,r=i.skips.length;t<r;t++)if(i.skips[t].test(e))return!1;for(t=0,r=i.names.length;t<r;t++)if(i.names[t].test(e))return!0;return!1},i.humanize=r(45),Object.keys(e).forEach((function(t){i[t]=e[t]})),i.instances=[],i.names=[],i.skips=[],i.formatters={},i.selectColor=t,i.enable(i.load()),i}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=1e3,a=6e4,o=60*a,s=24*o;function c(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,t){t=t||{};var r=n(e);if("string"===r&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"hrs":case"hr":case"h":return r*o;case"minutes":case"minute":case"mins":case"min":case"m":return r*a;case"seconds":case"second":case"secs":case"sec":case"s":return r*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===r&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=s)return c(e,t,s,"day");if(t>=o)return c(e,t,o,"hour");if(t>=a)return c(e,t,a,"minute");if(t>=i)return c(e,t,i,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=s)return Math.round(e/s)+"d";if(t>=o)return Math.round(e/o)+"h";if(t>=a)return Math.round(e/a)+"m";if(t>=i)return Math.round(e/i)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){"use strict";function n(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=r(47)("h264-profile-level-id");s.log=console.info.bind(console);t.ProfileConstrainedBaseline=1,t.ProfileBaseline=2,t.ProfileMain=3,t.ProfileConstrainedHigh=4,t.ProfileHigh=5;t.Level1_b=0,t.Level1=10,t.Level1_1=11,t.Level1_2=12,t.Level1_3=13,t.Level2=20,t.Level2_1=21,t.Level2_2=22,t.Level3=30,t.Level3_1=31,t.Level3_2=32,t.Level4=40,t.Level4_1=41,t.Level4_2=42,t.Level5=50,t.Level5_1=51,t.Level5_2=52;var c=function e(t,r){o(this,e),this.profile=t,this.level=r};t.ProfileLevelId=c;var u=new c(1,31),d=function(){function e(t){o(this,e),this._mask=~f("x",t),this._maskedValue=f("1",t)}var t,r,n;return t=e,(r=[{key:"isMatch",value:function(e){return this._maskedValue===(e&this._mask)}}])&&a(t.prototype,r),n&&a(t,n),e}(),p=function e(t,r,n){o(this,e),this.profile_idc=t,this.profile_iop=r,this.profile=n},l=[new p(66,new d("x1xx0000"),1),new p(77,new d("1xxx0000"),1),new p(88,new d("11xx0000"),1),new p(66,new d("x0xx0000"),2),new p(88,new d("10xx0000"),2),new p(77,new d("0x0x0000"),3),new p(100,new d("00000000"),5),new p(100,new d("00001100"),4)];function f(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function h(e,t){return function(e,t){return 0===e?10!==t&&0!==t:0===t?10!==e:e<t}(e,t)?e:t}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e["level-asymmetry-allowed"];return 1===t||"1"===t}t.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;var t=parseInt(e,16);if(0===t)return null;var r,i=255&t,a=t>>8&255,o=t>>16&255;switch(i){case 11:r=0!=(16&a)?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:r=i;break;default:return s("parseProfileLevelId() | unrecognized level_idc:%s",i),null}var u,d=n(l);try{for(d.s();!(u=d.n()).done;){var p=u.value;if(o===p.profile_idc&&p.profile_iop.isMatch(a))return new c(p.profile,r)}}catch(e){d.e(e)}finally{d.f()}return s("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},t.profileLevelIdToString=function(e){if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return s("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}var t;switch(e.profile){case 1:t="42e0";break;case 2:t="4200";break;case 3:t="4d00";break;case 4:t="640c";break;case 5:t="6400";break;default:return s("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}var r=e.level.toString(16);return 1===r.length&&(r="0".concat(r)),"".concat(t).concat(r)},t.parseSdpProfileLevelId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e["profile-level-id"];return r?t.parseProfileLevelId(r):u},t.isSameProfile=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.parseSdpProfileLevelId(e),i=t.parseSdpProfileLevelId(r);return Boolean(n&&i&&n.profile===i.profile)},t.generateProfileLevelIdForAnswer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e["profile-level-id"]&&!r["profile-level-id"])return s("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;var n=t.parseSdpProfileLevelId(e),i=t.parseSdpProfileLevelId(r);if(!n)throw new TypeError("invalid local_profile_level_id");if(!i)throw new TypeError("invalid remote_profile_level_id");if(n.profile!==i.profile)throw new TypeError("H264 Profile mismatch");var a=m(e)&&m(r),o=n.level,u=i.level,d=h(o,u),p=a?o:d;return s("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",n.profile,p),t.profileLevelIdToString(new c(n.profile,p))}},function(e,t,r){"use strict";(function(n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=r(48)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(9))},function(e,t,r){"use strict";function n(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}e.exports=function(e){function t(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return i.colors[Math.abs(t)%i.colors.length]}function i(e){var r;function n(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];if(n.enabled){var o=n,s=Number(new Date),c=s-(r||s);o.diff=c,o.prev=r,o.curr=s,r=s,t[0]=i.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var u=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return e;u++;var n=i.formatters[r];if("function"==typeof n){var a=t[u];e=n.call(o,a),t.splice(u,1),u--}return e})),i.formatArgs.call(o,t);var d=o.log||i.log;d.apply(o,t)}}return n.namespace=e,n.enabled=i.enabled(e),n.useColors=i.useColors(),n.color=t(e),n.destroy=a,n.extend=o,"function"==typeof i.init&&i.init(n),i.instances.push(n),n}function a(){var e=i.instances.indexOf(this);return-1!==e&&(i.instances.splice(e,1),!0)}function o(e,t){var r=i(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return i.debug=i,i.default=i,i.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},i.disable=function(){var e=[].concat(n(i.names.map(s)),n(i.skips.map(s).map((function(e){return"-"+e})))).join(",");return i.enable(""),e},i.enable=function(e){var t;i.save(e),i.names=[],i.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?i.skips.push(new RegExp("^"+e.substr(1)+"$")):i.names.push(new RegExp("^"+e+"$")));for(t=0;t<i.instances.length;t++){var a=i.instances[t];a.enabled=i.enabled(a.namespace)}},i.enabled=function(e){if("*"===e[e.length-1])return!0;var t,r;for(t=0,r=i.skips.length;t<r;t++)if(i.skips[t].test(e))return!1;for(t=0,r=i.names.length;t<r;t++)if(i.names[t].test(e))return!0;return!1},i.humanize=r(49),Object.keys(e).forEach((function(t){i[t]=e[t]})),i.instances=[],i.names=[],i.skips=[],i.formatters={},i.selectColor=t,i.enable(i.load()),i}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=1e3,a=6e4,o=60*a,s=24*o;function c(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,t){t=t||{};var r=n(e);if("string"===r&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"hrs":case"hr":case"h":return r*o;case"minutes":case"minute":case"mins":case"min":case"m":return r*a;case"seconds":case"second":case"secs":case"sec":case"s":return r*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===r&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=s)return c(e,t,s,"day");if(t>=o)return c(e,t,o,"hour");if(t>=a)return c(e,t,a,"minute");if(t>=i)return c(e,t,i,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=s)return Math.round(e/s)+"d";if(t>=o)return Math.round(e/o)+"h";if(t>=a)return Math.round(e/a)+"m";if(t>=i)return Math.round(e/i)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){"use strict";function n(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{ClosedErrorClass:Error,StoppedErrorClass:Error},r=t.ClosedErrorClass,n=t.StoppedErrorClass;a(this,e),this._closed=!1,this._pendingTasks=[],this._ClosedErrorClass=Error,this._StoppedErrorClass=Error,this._ClosedErrorClass=r,this._StoppedErrorClass=n}var t,r,i;return t=e,(r=[{key:"close",value:function(){this._closed=!0}},{key:"push",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"==typeof e){t.next=2;break}throw new TypeError("given task is not a function");case 2:return t.abrupt("return",new Promise((function(t,n){var i={execute:e,resolve:t,reject:n,stopped:!1};r._pendingTasks.push(i),1===r._pendingTasks.length&&r._next()})));case 3:case"end":return t.stop()}}),t)})))}},{key:"stop",value:function(){var e,t=n(this._pendingTasks);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.stopped=!0,r.reject(new this._StoppedErrorClass("AwaitQueue stopped"))}}catch(e){t.e(e)}finally{t.f()}this._pendingTasks.length=0}},{key:"_next",value:function(){return s(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._pendingTasks[0]){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this._executeTask(t);case 5:this._pendingTasks.shift(),this._next();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"_executeTask",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._closed){t.next=3;break}return e.reject(new this._ClosedErrorClass("AwaitQueue closed")),t.abrupt("return");case 3:if(!e.stopped){t.next=5;break}return t.abrupt("return");case 5:return t.prev=5,t.next=8,e.execute();case 8:if(r=t.sent,!this._closed){t.next=12;break}return e.reject(new this._ClosedErrorClass("AwaitQueue closed")),t.abrupt("return");case 12:if(!e.stopped){t.next=14;break}return t.abrupt("return");case 14:e.resolve(r),t.next=25;break;case 17:if(t.prev=17,t.t0=t.catch(5),!this._closed){t.next=22;break}return e.reject(new this._ClosedErrorClass("AwaitQueue closed")),t.abrupt("return");case 22:if(!e.stopped){t.next=24;break}return t.abrupt("return");case 24:e.reject(t.t0);case 25:case"end":return t.stop()}}),t,this,[[5,17]])})))}}])&&o(t.prototype,r),i&&o(t,i),e}();t.AwaitQueue=c},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){u(a,n,i,o,s,"next",e)}function s(e){u(a,n,i,o,s,"throw",e)}o(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=m(e);if(t){var i=m(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return h(this,r)}}function h(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var y=r(4),v=r(0),g=r(1),b=r(2),w=r(6),_=r(10),S=r(5),k=r(7),R=r(13),x=new v.Logger("Chrome74"),C={OS:1024,MIS:1024},P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(L,e);var t,r,n,a,o,c,u,h,m,v,S,P,T,O,E,D,j,I,M,A,F=f(L);function L(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,L),(e=F.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=L,r=[{key:"close",value:function(){if(x.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:(A=d(regeneratorRuntime.mark((function e(){var t,r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=y.parse(r.sdp),i=w.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 14:e.prev=14,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[2,14]])}))),function(){return A.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(M=d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:C});case 2:case"end":return e.stop()}}),e)}))),function(){return M.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,d=e.additionalSettings,p=e.proprietaryConstraints,l=e.extendedRtpCapabilities;x.debug("run()"),this._direction=r,this._remoteSdp=new k.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o}),this._sendingRtpParametersByKind={audio:b.getSendingRtpParameters("audio",l),video:b.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:b.getSendingRemoteRtpParameters("audio",l),video:b.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection(s({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},d),p),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(I=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:x.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"restartIce",value:(j=d(regeneratorRuntime.mark((function e(t){var r,n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,x.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},x.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},x.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,x.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"getTransportStats",value:(D=d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"send",value:(E=d(regeneratorRuntime.mark((function e(t){var r,n,a,o,s,c,u,d,p,l,f,h,m,v,S,k,C,P;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,a=t.codecOptions,o=t.codec,this._assertSendDirection(),x.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),n&&n.length>1&&n.forEach((function(e,t){e.rid="r".concat(t)})),(s=g.clone(this._sendingRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(s.codecs,o),(c=g.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(c.codecs,o),u=this._remoteSdp.getNextMediaSectionIdx(),d=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream],sendEncodings:n}),e.next=12,this._pc.createOffer();case 12:if(p=e.sent,l=y.parse(p.sdp),this._transportReady){e.next=17;break}return e.next=17,this._setupTransport({localDtlsRole:"server",localSdpObject:l});case 17:return h=!1,m=R.parse((n||[{}])[0].scalabilityMode),n&&1===n.length&&m.spatialLayers>1&&"video/vp9"===s.codecs[0].mimeType.toLowerCase()&&(x.debug("send() | enabling legacy simulcast for VP9 SVC"),h=!0,l=y.parse(p.sdp),f=l.media[u.idx],_.addLegacySimulcast({offerMediaObject:f,numStreams:m.spatialLayers}),p={type:"offer",sdp:y.write(l)}),x.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),e.next=23,this._pc.setLocalDescription(p);case 23:if(v=d.mid,s.mid=v,l=y.parse(this._pc.localDescription.sdp),f=l.media[u.idx],s.rtcp.cname=w.getCname({offerMediaObject:f}),n?1===n.length?(S=_.getRtpEncodings({offerMediaObject:f}),Object.assign(S[0],n[0]),h&&(S=[S[0]]),s.encodings=S):s.encodings=n:s.encodings=_.getRtpEncodings({offerMediaObject:f}),s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase())){k=i(s.encodings);try{for(k.s();!(C=k.n()).done;)C.value.scalabilityMode="S1T3"}catch(e){k.e(e)}finally{k.f()}}return this._remoteSdp.send({offerMediaObject:f,reuseMid:u.reuseMid,offerRtpParameters:s,answerRtpParameters:c,codecOptions:a,extmapAllowMixed:!0}),P={type:"answer",sdp:this._remoteSdp.getSdp()},x.debug("send() | calling pc.setRemoteDescription() [answer:%o]",P),e.next=35,this._pc.setRemoteDescription(P);case 35:return this._mapMidTransceiver.set(v,d),e.abrupt("return",{localId:v,rtpParameters:s,rtpSender:d.sender});case 37:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"stopSending",value:(O=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),x.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid),e.next=10,this._pc.createOffer();case 10:return n=e.sent,x.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return i={type:"answer",sdp:this._remoteSdp.getSdp()},x.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=18,this._pc.setRemoteDescription(i);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"replaceTrack",value:(T=d(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r?x.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):x.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return T.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(P=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),x.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(S=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),x.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=s(s({},e),r)})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return S.apply(this,arguments)})},{key:"getSenderStats",value:(v=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"sendDataChannel",value:(m=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,s=t.priority,this._assertSendDirection(),c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:o,priority:s},x.debug("sendDataChannel() [options:%o]",c),u=this._pc.createDataChannel(a,c),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%C.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(d=e.sent,p=y.parse(d.sdp),l=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:p});case 15:return x.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),e.next=18,this._pc.setLocalDescription(d);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:l}),f={type:"answer",sdp:this._remoteSdp.getSdp()},x.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.next=23,this._pc.setRemoteDescription(f);case 23:this._hasDataChannelMediaSection=!0;case 24:return h={streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits},e.abrupt("return",{dataChannel:u,sctpStreamParameters:h});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"receive",value:(h=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),x.debug("receive() [trackId:%s, kind:%s]",r,n),a=i.mid||String(this._mapMidTransceiver.size),this._remoteSdp.receive({mid:a,kind:n,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:r}),o={type:"offer",sdp:this._remoteSdp.getSdp()},x.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=9,this._pc.setRemoteDescription(o);case 9:return e.next=11,this._pc.createAnswer();case 11:if(s=e.sent,c=y.parse(s.sdp),u=c.media.find((function(e){return String(e.mid)===a})),w.applyCodecParameters({offerRtpParameters:i,answerMediaObject:u}),s={type:"answer",sdp:y.write(c)},this._transportReady){e.next=19;break}return e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:c});case 19:return x.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),e.next=22,this._pc.setLocalDescription(s);case 22:if(d=this._pc.getTransceivers().find((function(e){return e.mid===a}))){e.next=25;break}throw new Error("new RTCRtpTransceiver not found");case 25:return this._mapMidTransceiver.set(a,d),e.abrupt("return",{localId:a,track:d.receiver.track,rtpReceiver:d.receiver});case 27:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"stopReceiving",value:(u=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),x.debug("stopReceiving() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return this._remoteSdp.closeMediaSection(r.mid),n={type:"offer",sdp:this._remoteSdp.getSdp()},x.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),e.next=10,this._pc.setRemoteDescription(n);case 10:return e.next=12,this._pc.createAnswer();case 12:return i=e.sent,x.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),e.next=16,this._pc.setLocalDescription(i);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getReceiverStats",value:(c=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"receiveDataChannel",value:(o=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),a=r.streamId,o=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,u={negotiated:!0,id:a,ordered:o,maxPacketLifeTime:s,maxRetransmits:c,protocol:i},x.debug("receiveDataChannel() [options:%o]",u),d=this._pc.createDataChannel(n,u),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),p={type:"offer",sdp:this._remoteSdp.getSdp()},x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),e.next=12,this._pc.setRemoteDescription(p);case 12:return e.next=14,this._pc.createAnswer();case 14:if(l=e.sent,this._transportReady){e.next=19;break}return f=y.parse(l.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:f});case 19:return x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),e.next=22,this._pc.setLocalDescription(l);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_setupTransport",value:(a=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=y.parse(this._pc.localDescription.sdp)),(i=w.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Chrome74"}}],n=[{key:"createFactory",value:function(){return function(){return new L}}}],r&&p(t.prototype,r),n&&p(t,n),L}(S.HandlerInterface);t.Chrome74=P},function(e,t,r){"use strict";var n=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:i?t[e.name]:t;!function(e,t,r,i){if(i&&!r)t[i]=n(e[1]);else for(var a=0;a<r.length;a+=1)null!=e[a+1]&&(t[r[a]]=n(e[a+1]))}(r.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},a=r(23),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(o))return i(c,n,o)}})),t.media=r,t};var s=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),i=0;i<r.length;i+=3)t.push({component:r[i],ip:r[i+1],port:r[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},function(e,t,r){"use strict";var n=r(23),i=/%[sdv%]/g,a=function(e){var t=1,r=arguments,n=r.length;return e.replace(i,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},o=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?n.push(r[t.name][o]):n.push(r[t.names[i]])}else n.push(r[t.name]);return a.apply(null,n)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||s,i=t.innerOrder||c,a=[];return r.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(o(t,r,e))}))}))})),e.media.forEach((function(e){a.push(o("m",n.m[0],e)),i.forEach((function(t){n[t].forEach((function(r){r.name in e&&null!=e[r.name]?a.push(o(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){a.push(o(t,r,e))}))}))}))})),a.join("\r\n")+"\r\n"}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=c(e);if(t){var i=c(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return s(this,r)}}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),e}Object.defineProperty(t,"__esModule",{value:!0});var h=r(1),m=function(){function e(t){var r=t.iceParameters,n=t.iceCandidates,i=t.dtlsParameters,a=t.planB,o=void 0!==a&&a;if(p(this,e),this._mediaObject={},this._planB=o,r&&this.setIceParameters(r),n){this._mediaObject.candidates=[];var s,c=u(n);try{for(c.s();!(s=c.n()).done;){var d=s.value,l={component:1};l.foundation=d.foundation,l.ip=d.ip,l.port=d.port,l.priority=d.priority,l.transport=d.protocol,l.type=d.type,d.tcpType&&(l.tcptype=d.tcpType),this._mediaObject.candidates.push(l)}}catch(e){c.e(e)}finally{c.f()}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}i&&this.setDtlsRole(i.role)}return f(e,[{key:"getObject",value:function(){return this._mediaObject}},{key:"setIceParameters",value:function(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}},{key:"disable",value:function(){this._mediaObject.direction="inactive",delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids}},{key:"close",value:function(){this._mediaObject.direction="inactive",this._mediaObject.port=0,delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}},{key:"mid",get:function(){return String(this._mediaObject.mid)}},{key:"closed",get:function(){return 0===this._mediaObject.port}}]),e}();t.MediaSection=m;var y=function(e){i(r,e);var t=o(r);function r(e){var n,i=e.iceParameters,a=e.iceCandidates,o=e.dtlsParameters,s=e.sctpParameters,c=e.plainRtpParameters,d=e.planB,l=void 0!==d&&d,f=e.offerMediaObject,m=e.offerRtpParameters,y=e.answerRtpParameters,v=e.codecOptions,b=e.extmapAllowMixed,w=void 0!==b&&b;switch(p(this,r),(n=t.call(this,{iceParameters:i,iceCandidates:a,dtlsParameters:o,planB:l}))._mediaObject.mid=String(f.mid),n._mediaObject.type=f.type,n._mediaObject.protocol=f.protocol,c?(n._mediaObject.connection={ip:c.ip,version:c.ipVersion},n._mediaObject.port=c.port):(n._mediaObject.connection={ip:"127.0.0.1",version:4},n._mediaObject.port=7),f.type){case"audio":case"video":n._mediaObject.direction="recvonly",n._mediaObject.rtp=[],n._mediaObject.rtcpFb=[],n._mediaObject.fmtp=[];var _,S=u(y.codecs);try{var k=function(){var e=_.value,t={payload:e.payloadType,codec:g(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),n._mediaObject.rtp.push(t);var r=h.clone(e.parameters||{});if(v){var i=v.opusStereo,a=v.opusFec,o=v.opusDtx,s=v.opusMaxPlaybackRate,c=v.opusPtime,d=v.videoGoogleStartBitrate,p=v.videoGoogleMaxBitrate,l=v.videoGoogleMinBitrate,f=m.codecs.find((function(t){return t.payloadType===e.payloadType}));switch(e.mimeType.toLowerCase()){case"audio/opus":void 0!==i&&(f.parameters["sprop-stereo"]=i?1:0,r.stereo=i?1:0),void 0!==a&&(f.parameters.useinbandfec=a?1:0,r.useinbandfec=a?1:0),void 0!==o&&(f.parameters.usedtx=o?1:0,r.usedtx=o?1:0),void 0!==s&&(r.maxplaybackrate=s),void 0!==c&&(f.parameters.ptime=c,r.ptime=c);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==d&&(r["x-google-start-bitrate"]=d),void 0!==p&&(r["x-google-max-bitrate"]=p),void 0!==l&&(r["x-google-min-bitrate"]=l)}}for(var y={payload:e.payloadType,config:""},b=0,w=Object.keys(r);b<w.length;b++){var S=w[b];y.config&&(y.config+=";"),y.config+="".concat(S,"=").concat(r[S])}y.config&&n._mediaObject.fmtp.push(y);var k,R=u(e.rtcpFeedback);try{for(R.s();!(k=R.n()).done;){var x=k.value;n._mediaObject.rtcpFb.push({payload:e.payloadType,type:x.type,subtype:x.parameter})}}catch(e){R.e(e)}finally{R.f()}};for(S.s();!(_=S.n()).done;)k()}catch(e){S.e(e)}finally{S.f()}n._mediaObject.payloads=y.codecs.map((function(e){return e.payloadType})).join(" "),n._mediaObject.ext=[];var R,x=u(y.headerExtensions);try{var C=function(){var e=R.value;if(!(f.ext||[]).some((function(t){return t.uri===e.uri})))return"continue";n._mediaObject.ext.push({uri:e.uri,value:e.id})};for(x.s();!(R=x.n()).done;)C()}catch(e){x.e(e)}finally{x.f()}if(w&&"extmap-allow-mixed"===f.extmapAllowMixed&&(n._mediaObject.extmapAllowMixed="extmap-allow-mixed"),f.simulcast){n._mediaObject.simulcast={dir1:"recv",list1:f.simulcast.list1},n._mediaObject.rids=[];var P,T=u(f.rids||[]);try{for(T.s();!(P=T.n()).done;){var O=P.value;"send"===O.direction&&n._mediaObject.rids.push({id:O.id,direction:"recv"})}}catch(e){T.e(e)}finally{T.f()}}else if(f.simulcast_03){n._mediaObject.simulcast_03={value:f.simulcast_03.value.replace(/send/g,"recv")},n._mediaObject.rids=[];var E,D=u(f.rids||[]);try{for(D.s();!(E=D.n()).done;){var j=E.value;"send"===j.direction&&n._mediaObject.rids.push({id:j.id,direction:"recv"})}}catch(e){D.e(e)}finally{D.f()}}n._mediaObject.rtcpMux="rtcp-mux",n._mediaObject.rtcpRsize="rtcp-rsize",n._planB&&"video"===n._mediaObject.type&&(n._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof f.sctpPort?(n._mediaObject.payloads="webrtc-datachannel",n._mediaObject.sctpPort=s.port,n._mediaObject.maxMessageSize=s.maxMessageSize):f.sctpmap&&(n._mediaObject.payloads=s.port,n._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:s.port,maxMessageSize:s.maxMessageSize})}return n}return f(r,[{key:"setDtlsRole",value:function(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}}]),r}(m);t.AnswerMediaSection=y;var v=function(e){i(r,e);var t=o(r);function r(e){var n,i=e.iceParameters,a=e.iceCandidates,o=e.dtlsParameters,s=e.sctpParameters,c=e.plainRtpParameters,d=e.planB,l=void 0!==d&&d,f=e.mid,h=e.kind,m=e.offerRtpParameters,y=e.streamId,v=e.trackId,b=e.oldDataChannelSpec,w=void 0!==b&&b;switch(p(this,r),(n=t.call(this,{iceParameters:i,iceCandidates:a,dtlsParameters:o,planB:l}))._mediaObject.mid=String(f),n._mediaObject.type=h,c?(n._mediaObject.connection={ip:c.ip,version:c.ipVersion},n._mediaObject.protocol="RTP/AVP",n._mediaObject.port=c.port):(n._mediaObject.connection={ip:"127.0.0.1",version:4},n._mediaObject.protocol=s?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",n._mediaObject.port=7),h){case"audio":case"video":n._mediaObject.direction="sendonly",n._mediaObject.rtp=[],n._mediaObject.rtcpFb=[],n._mediaObject.fmtp=[],n._planB||(n._mediaObject.msid="".concat(y||"-"," ").concat(v));var _,S=u(m.codecs);try{for(S.s();!(_=S.n()).done;){var k=_.value,R={payload:k.payloadType,codec:g(k),rate:k.clockRate};k.channels>1&&(R.encoding=k.channels),n._mediaObject.rtp.push(R);for(var x={payload:k.payloadType,config:""},C=0,P=Object.keys(k.parameters);C<P.length;C++){var T=P[C];x.config&&(x.config+=";"),x.config+="".concat(T,"=").concat(k.parameters[T])}x.config&&n._mediaObject.fmtp.push(x);var O,E=u(k.rtcpFeedback);try{for(E.s();!(O=E.n()).done;){var D=O.value;n._mediaObject.rtcpFb.push({payload:k.payloadType,type:D.type,subtype:D.parameter})}}catch(e){E.e(e)}finally{E.f()}}}catch(e){S.e(e)}finally{S.f()}n._mediaObject.payloads=m.codecs.map((function(e){return e.payloadType})).join(" "),n._mediaObject.ext=[];var j,I=u(m.headerExtensions);try{for(I.s();!(j=I.n()).done;){var M=j.value;n._mediaObject.ext.push({uri:M.uri,value:M.id})}}catch(e){I.e(e)}finally{I.f()}n._mediaObject.rtcpMux="rtcp-mux",n._mediaObject.rtcpRsize="rtcp-rsize";var A=m.encodings[0],F=A.ssrc,L=A.rtx&&A.rtx.ssrc?A.rtx.ssrc:void 0;n._mediaObject.ssrcs=[],n._mediaObject.ssrcGroups=[],m.rtcp.cname&&n._mediaObject.ssrcs.push({id:F,attribute:"cname",value:m.rtcp.cname}),n._planB&&n._mediaObject.ssrcs.push({id:F,attribute:"msid",value:"".concat(y||"-"," ").concat(v)}),L&&(m.rtcp.cname&&n._mediaObject.ssrcs.push({id:L,attribute:"cname",value:m.rtcp.cname}),n._planB&&n._mediaObject.ssrcs.push({id:L,attribute:"msid",value:"".concat(y||"-"," ").concat(v)}),n._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(F," ").concat(L)}));break;case"application":w?(n._mediaObject.payloads=s.port,n._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:s.port,maxMessageSize:s.maxMessageSize}):(n._mediaObject.payloads="webrtc-datachannel",n._mediaObject.sctpPort=s.port,n._mediaObject.maxMessageSize=s.maxMessageSize)}return n}return f(r,[{key:"setDtlsRole",value:function(e){this._mediaObject.setup="actpass"}},{key:"planBReceive",value:function(e){var t=e.offerRtpParameters,r=e.streamId,n=e.trackId,i=t.encodings[0],a=i.ssrc,o=i.rtx&&i.rtx.ssrc?i.rtx.ssrc:void 0;t.rtcp.cname&&this._mediaObject.ssrcs.push({id:a,attribute:"cname",value:t.rtcp.cname}),this._mediaObject.ssrcs.push({id:a,attribute:"msid",value:"".concat(r||"-"," ").concat(n)}),o&&(t.rtcp.cname&&this._mediaObject.ssrcs.push({id:o,attribute:"cname",value:t.rtcp.cname}),this._mediaObject.ssrcs.push({id:o,attribute:"msid",value:"".concat(r||"-"," ").concat(n)}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(a," ").concat(o)}))}},{key:"planBStopReceiving",value:function(e){var t=e.offerRtpParameters.encodings[0],r=t.ssrc,n=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((function(e){return e.id!==r&&e.id!==n})),n&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((function(e){return e.ssrcs!=="".concat(r," ").concat(n)})))}}]),r}(m);function g(e){var t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}t.OfferMediaSection=v},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){u(a,n,i,o,s,"next",e)}function s(e){u(a,n,i,o,s,"throw",e)}o(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=m(e);if(t){var i=m(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return h(this,r)}}function h(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var y=r(4),v=r(0),g=r(1),b=r(2),w=r(6),_=r(10),S=r(5),k=r(7),R=r(13),x=new v.Logger("Chrome70"),C={OS:1024,MIS:1024},P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(L,e);var t,r,n,a,o,c,u,h,m,v,S,P,T,O,E,D,j,I,M,A,F=f(L);function L(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,L),(e=F.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=L,r=[{key:"close",value:function(){if(x.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:(A=d(regeneratorRuntime.mark((function e(){var t,r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=y.parse(r.sdp),i=w.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 14:e.prev=14,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[2,14]])}))),function(){return A.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(M=d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:C});case 2:case"end":return e.stop()}}),e)}))),function(){return M.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,d=e.additionalSettings,p=e.proprietaryConstraints,l=e.extendedRtpCapabilities;x.debug("run()"),this._direction=r,this._remoteSdp=new k.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o}),this._sendingRtpParametersByKind={audio:b.getSendingRtpParameters("audio",l),video:b.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:b.getSendingRemoteRtpParameters("audio",l),video:b.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection(s({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},d),p),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(I=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:x.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"restartIce",value:(j=d(regeneratorRuntime.mark((function e(t){var r,n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,x.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},x.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},x.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,x.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"getTransportStats",value:(D=d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"send",value:(E=d(regeneratorRuntime.mark((function e(t){var r,n,a,o,s,c,u,d,p,l,f,h,m,v,S,k,C,P,T,O,E,D;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,a=t.codecOptions,o=t.codec,this._assertSendDirection(),x.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),(s=g.clone(this._sendingRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(s.codecs,o),(c=g.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(c.codecs,o),u=this._remoteSdp.getNextMediaSectionIdx(),d=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream]}),e.next=11,this._pc.createOffer();case 11:if(p=e.sent,l=y.parse(p.sdp),this._transportReady){e.next=16;break}return e.next=16,this._setupTransport({localDtlsRole:"server",localSdpObject:l});case 16:return n&&n.length>1&&(x.debug("send() | enabling legacy simulcast"),l=y.parse(p.sdp),f=l.media[u.idx],_.addLegacySimulcast({offerMediaObject:f,numStreams:n.length}),p={type:"offer",sdp:y.write(l)}),h=!1,m=R.parse((n||[{}])[0].scalabilityMode),n&&1===n.length&&m.spatialLayers>1&&"video/vp9"===s.codecs[0].mimeType.toLowerCase()&&(x.debug("send() | enabling legacy simulcast for VP9 SVC"),h=!0,l=y.parse(p.sdp),f=l.media[u.idx],_.addLegacySimulcast({offerMediaObject:f,numStreams:m.spatialLayers}),p={type:"offer",sdp:y.write(l)}),x.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),e.next=23,this._pc.setLocalDescription(p);case 23:if(!n){e.next=38;break}x.debug("send() | applying given encodings"),v=d.sender.getParameters(),S=0;case 27:if(!(S<(v.encodings||[]).length)){e.next=36;break}if(k=v.encodings[S],C=n[S]){e.next=32;break}return e.abrupt("break",36);case 32:v.encodings[S]=Object.assign(k,C);case 33:++S,e.next=27;break;case 36:return e.next=38,d.sender.setParameters(v);case 38:if(P=d.mid,s.mid=P,l=y.parse(this._pc.localDescription.sdp),f=l.media[u.idx],s.rtcp.cname=w.getCname({offerMediaObject:f}),s.encodings=_.getRtpEncodings({offerMediaObject:f}),n)for(T=0;T<s.encodings.length;++T)n[T]&&Object.assign(s.encodings[T],n[T]);if(h&&(s.encodings=[s.encodings[0]]),s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase())){O=i(s.encodings);try{for(O.s();!(E=O.n()).done;)E.value.scalabilityMode="S1T3"}catch(e){O.e(e)}finally{O.f()}}return this._remoteSdp.send({offerMediaObject:f,reuseMid:u.reuseMid,offerRtpParameters:s,answerRtpParameters:c,codecOptions:a}),D={type:"answer",sdp:this._remoteSdp.getSdp()},x.debug("send() | calling pc.setRemoteDescription() [answer:%o]",D),e.next=52,this._pc.setRemoteDescription(D);case 52:return this._mapMidTransceiver.set(P,d),e.abrupt("return",{localId:P,rtpParameters:s,rtpSender:d.sender});case 54:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"stopSending",value:(O=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),x.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid),e.next=10,this._pc.createOffer();case 10:return n=e.sent,x.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return i={type:"answer",sdp:this._remoteSdp.getSdp()},x.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=18,this._pc.setRemoteDescription(i);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"replaceTrack",value:(T=d(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r?x.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):x.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return T.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(P=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),x.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(S=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),x.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=s(s({},e),r)})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return S.apply(this,arguments)})},{key:"getSenderStats",value:(v=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"sendDataChannel",value:(m=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,s=t.priority,this._assertSendDirection(),c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:i,protocol:o,priority:s},x.debug("sendDataChannel() [options:%o]",c),u=this._pc.createDataChannel(a,c),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%C.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(d=e.sent,p=y.parse(d.sdp),l=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:p});case 15:return x.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),e.next=18,this._pc.setLocalDescription(d);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:l}),f={type:"answer",sdp:this._remoteSdp.getSdp()},x.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.next=23,this._pc.setRemoteDescription(f);case 23:this._hasDataChannelMediaSection=!0;case 24:return h={streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits},e.abrupt("return",{dataChannel:u,sctpStreamParameters:h});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"receive",value:(h=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),x.debug("receive() [trackId:%s, kind:%s]",r,n),a=i.mid||String(this._mapMidTransceiver.size),this._remoteSdp.receive({mid:a,kind:n,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:r}),o={type:"offer",sdp:this._remoteSdp.getSdp()},x.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=9,this._pc.setRemoteDescription(o);case 9:return e.next=11,this._pc.createAnswer();case 11:if(s=e.sent,c=y.parse(s.sdp),u=c.media.find((function(e){return String(e.mid)===a})),w.applyCodecParameters({offerRtpParameters:i,answerMediaObject:u}),s={type:"answer",sdp:y.write(c)},this._transportReady){e.next=19;break}return e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:c});case 19:return x.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),e.next=22,this._pc.setLocalDescription(s);case 22:if(d=this._pc.getTransceivers().find((function(e){return e.mid===a}))){e.next=25;break}throw new Error("new RTCRtpTransceiver not found");case 25:return this._mapMidTransceiver.set(a,d),e.abrupt("return",{localId:a,track:d.receiver.track,rtpReceiver:d.receiver});case 27:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"stopReceiving",value:(u=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),x.debug("stopReceiving() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return this._remoteSdp.closeMediaSection(r.mid),n={type:"offer",sdp:this._remoteSdp.getSdp()},x.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),e.next=10,this._pc.setRemoteDescription(n);case 10:return e.next=12,this._pc.createAnswer();case 12:return i=e.sent,x.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),e.next=16,this._pc.setLocalDescription(i);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getReceiverStats",value:(c=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"receiveDataChannel",value:(o=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),a=r.streamId,o=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,u={negotiated:!0,id:a,ordered:o,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:c,protocol:i},x.debug("receiveDataChannel() [options:%o]",u),d=this._pc.createDataChannel(n,u),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),p={type:"offer",sdp:this._remoteSdp.getSdp()},x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),e.next=12,this._pc.setRemoteDescription(p);case 12:return e.next=14,this._pc.createAnswer();case 14:if(l=e.sent,this._transportReady){e.next=19;break}return f=y.parse(l.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:f});case 19:return x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),e.next=22,this._pc.setLocalDescription(l);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_setupTransport",value:(a=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=y.parse(this._pc.localDescription.sdp)),(i=w.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Chrome70"}}],n=[{key:"createFactory",value:function(){return function(){return new L}}}],r&&p(t.prototype,r),n&&p(t,n),L}(S.HandlerInterface);t.Chrome70=P},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){u(a,n,i,o,s,"next",e)}function s(e){u(a,n,i,o,s,"throw",e)}o(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=m(e);if(t){var i=m(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return h(this,r)}}function h(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var y=r(4),v=r(0),g=r(1),b=r(2),w=r(6),_=r(11),S=r(5),k=r(7),R=new v.Logger("Chrome67"),x={OS:1024,MIS:1024},C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(F,e);var t,r,n,a,o,c,u,h,m,v,S,C,P,T,O,E,D,j,I,M,A=f(F);function F(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,F),(e=A.call(this))._sendStream=new MediaStream,e._mapSendLocalIdRtpSender=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=F,r=[{key:"close",value:function(){if(R.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:(M=d(regeneratorRuntime.mark((function e(){var t,r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=y.parse(r.sdp),i=w.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),function(){return M.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(I=d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:x});case 2:case"end":return e.stop()}}),e)}))),function(){return I.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,d=e.additionalSettings,p=e.proprietaryConstraints,l=e.extendedRtpCapabilities;R.debug("run()"),this._direction=r,this._remoteSdp=new k.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o,planB:!0}),this._sendingRtpParametersByKind={audio:b.getSendingRtpParameters("audio",l),video:b.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:b.getSendingRemoteRtpParameters("audio",l),video:b.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection(s({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},d),p),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(j=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:R.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"restartIce",value:(D=d(regeneratorRuntime.mark((function e(t){var r,n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,R.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,R.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"getTransportStats",value:(E=d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"send",value:(O=d(regeneratorRuntime.mark((function e(t){var r,n,a,o,s,c,u,d,p,l,f,h,m,v,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,a=t.codecOptions,o=t.codec,this._assertSendDirection(),R.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),o&&R.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addTrack(r,this._sendStream),e.next=8,this._pc.createOffer();case 8:if(s=e.sent,c=y.parse(s.sdp),(d=g.clone(this._sendingRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(d.codecs),(p=g.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(p.codecs),this._transportReady){e.next=17;break}return e.next=17,this._setupTransport({localDtlsRole:"server",localSdpObject:c});case 17:return"video"===r.kind&&n&&n.length>1&&(R.debug("send() | enabling simulcast"),c=y.parse(s.sdp),u=c.media.find((function(e){return"video"===e.type})),_.addLegacySimulcast({offerMediaObject:u,track:r,numStreams:n.length}),s={type:"offer",sdp:y.write(c)}),R.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),e.next=21,this._pc.setLocalDescription(s);case 21:if(c=y.parse(this._pc.localDescription.sdp),u=c.media.find((function(e){return e.type===r.kind})),d.rtcp.cname=w.getCname({offerMediaObject:u}),d.encodings=_.getRtpEncodings({offerMediaObject:u,track:r}),n)for(l=0;l<d.encodings.length;++l)n[l]&&Object.assign(d.encodings[l],n[l]);if(d.encodings.length>1&&"video/vp8"===d.codecs[0].mimeType.toLowerCase()){f=i(d.encodings);try{for(f.s();!(h=f.n()).done;)h.value.scalabilityMode="S1T3"}catch(e){f.e(e)}finally{f.f()}}return this._remoteSdp.send({offerMediaObject:u,offerRtpParameters:d,answerRtpParameters:p,codecOptions:a}),m={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),e.next=32,this._pc.setRemoteDescription(m);case 32:return v=String(this._nextSendLocalId),this._nextSendLocalId++,S=this._pc.getSenders().find((function(e){return e.track===r})),this._mapSendLocalIdRtpSender.set(v,S),e.abrupt("return",{localId:v,rtpParameters:d,rtpSender:S});case 37:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"stopSending",value:(T=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),R.debug("stopSending() [localId:%s]",t),r=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return this._pc.removeTrack(r),r.track&&this._sendStream.removeTrack(r.track),this._mapSendLocalIdRtpSender.delete(t),e.next=10,this._pc.createOffer();case 10:return n=e.sent,R.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=12,e.next=15,this._pc.setLocalDescription(n);case 15:e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(12),0!==this._sendStream.getTracks().length){e.next=22;break}return R.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 22:throw e.t0;case 23:if("stable"!==this._pc.signalingState){e.next=25;break}return e.abrupt("return");case 25:return i={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=29,this._pc.setRemoteDescription(i);case 29:case"end":return e.stop()}}),e,this,[[12,17]])}))),function(e){return T.apply(this,arguments)})},{key:"replaceTrack",value:(P=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r?R.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):R.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return i=n.track,e.next=8,n.replaceTrack(r);case 8:i&&this._sendStream.removeTrack(i),r&&this._sendStream.addTrack(r);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(C=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),R.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=n.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(S=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),R.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=n.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=s(s({},e),r)})),e.next=9,n.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return S.apply(this,arguments)})},{key:"getSenderStats",value:(v=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapSendLocalIdRtpSender.get(t)){e.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return e.abrupt("return",r.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"sendDataChannel",value:(m=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,s=t.priority,this._assertSendDirection(),c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:i,protocol:o,priority:s},R.debug("sendDataChannel() [options:%o]",c),u=this._pc.createDataChannel(a,c),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%x.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(d=e.sent,p=y.parse(d.sdp),l=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:p});case 15:return R.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),e.next=18,this._pc.setLocalDescription(d);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:l}),f={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.next=23,this._pc.setRemoteDescription(f);case 23:this._hasDataChannelMediaSection=!0;case 24:return h={streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits},e.abrupt("return",{dataChannel:u,sctpStreamParameters:h});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"receive",value:(h=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),R.debug("receive() [trackId:%s, kind:%s]",r,n),a=r,o=n,this._remoteSdp.receive({mid:o,kind:n,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:r}),s={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=10,this._pc.setRemoteDescription(s);case 10:return e.next=12,this._pc.createAnswer();case 12:if(c=e.sent,u=y.parse(c.sdp),d=u.media.find((function(e){return String(e.mid)===o})),w.applyCodecParameters({offerRtpParameters:i,answerMediaObject:d}),c={type:"answer",sdp:y.write(u)},this._transportReady){e.next=20;break}return e.next=20,this._setupTransport({localDtlsRole:"client",localSdpObject:u});case 20:return R.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),e.next=23,this._pc.setLocalDescription(c);case 23:if(p=this._pc.getReceivers().find((function(e){return e.track&&e.track.id===a}))){e.next=26;break}throw new Error("new RTCRtpReceiver not");case 26:return this._mapRecvLocalIdInfo.set(a,{mid:o,rtpParameters:i,rtpReceiver:p}),e.abrupt("return",{localId:a,track:p.track,rtpReceiver:p});case 28:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"stopReceiving",value:(u=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertRecvDirection(),R.debug("stopReceiving() [localId:%s]",t),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.mid,i=r.rtpParameters,this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:n,offerRtpParameters:i}),a={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),e.next=9,this._pc.setRemoteDescription(a);case 9:return e.next=11,this._pc.createAnswer();case 11:return o=e.sent,R.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",o),e.next=15,this._pc.setLocalDescription(o);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getReceiverStats",value:(c=d(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.rtpReceiver){e.next=4;break}throw new Error("associated RTCRtpReceiver not found");case 4:return e.abrupt("return",n.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"receiveDataChannel",value:(o=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),a=r.streamId,o=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,u={negotiated:!0,id:a,ordered:o,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:c,protocol:i},R.debug("receiveDataChannel() [options:%o]",u),d=this._pc.createDataChannel(n,u),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),p={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),e.next=12,this._pc.setRemoteDescription(p);case 12:return e.next=14,this._pc.createAnswer();case 14:if(l=e.sent,this._transportReady){e.next=19;break}return f=y.parse(l.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:f});case 19:return R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),e.next=22,this._pc.setLocalDescription(l);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_setupTransport",value:(a=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=y.parse(this._pc.localDescription.sdp)),(i=w.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Chrome67"}}],n=[{key:"createFactory",value:function(){return function(){return new F}}}],r&&p(t.prototype,r),n&&p(t,n),F}(S.HandlerInterface);t.Chrome67=C},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){c(a,n,i,o,s,"next",e)}function s(e){c(a,n,i,o,s,"throw",e)}o(void 0)}))}}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=h(e);if(t){var i=h(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}function f(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var m=r(4),y=r(0),v=r(3),g=r(1),b=r(2),w=r(6),_=r(11),S=r(5),k=r(7),R=new y.Logger("Chrome55"),x={OS:1024,MIS:1024},C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(N,e);var t,r,n,a,c,f,h,y,S,C,P,T,O,E,D,j,I,M,A,F,L=l(N);function N(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,N),(e=L.call(this))._sendStream=new MediaStream,e._mapSendLocalIdTrack=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=N,r=[{key:"close",value:function(){if(R.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:(F=u(regeneratorRuntime.mark((function e(){var t,r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=m.parse(r.sdp),i=w.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),function(){return F.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(A=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:x});case 2:case"end":return e.stop()}}),e)}))),function(){return A.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,c=e.sctpParameters,u=e.iceServers,d=e.iceTransportPolicy,p=e.additionalSettings,l=e.proprietaryConstraints,f=e.extendedRtpCapabilities;R.debug("run()"),this._direction=r,this._remoteSdp=new k.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:c,planB:!0}),this._sendingRtpParametersByKind={audio:b.getSendingRtpParameters("audio",f),video:b.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:b.getSendingRemoteRtpParameters("audio",f),video:b.getSendingRemoteRtpParameters("video",f)},this._pc=new RTCPeerConnection(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({iceServers:u||[],iceTransportPolicy:d||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},p),l),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(M=u(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:R.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"restartIce",value:(I=u(regeneratorRuntime.mark((function e(t){var r,n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,R.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,R.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"getTransportStats",value:(j=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"send",value:(D=u(regeneratorRuntime.mark((function e(t){var r,n,a,o,s,c,u,d,p,l,f,h,y,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,a=t.codecOptions,o=t.codec,this._assertSendDirection(),R.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),o&&R.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addStream(this._sendStream),e.next=8,this._pc.createOffer();case 8:if(s=e.sent,c=m.parse(s.sdp),(d=g.clone(this._sendingRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(d.codecs),(p=g.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(p.codecs),this._transportReady){e.next=17;break}return e.next=17,this._setupTransport({localDtlsRole:"server",localSdpObject:c});case 17:return"video"===r.kind&&n&&n.length>1&&(R.debug("send() | enabling simulcast"),c=m.parse(s.sdp),u=c.media.find((function(e){return"video"===e.type})),_.addLegacySimulcast({offerMediaObject:u,track:r,numStreams:n.length}),s={type:"offer",sdp:m.write(c)}),R.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),e.next=21,this._pc.setLocalDescription(s);case 21:if(c=m.parse(this._pc.localDescription.sdp),u=c.media.find((function(e){return e.type===r.kind})),d.rtcp.cname=w.getCname({offerMediaObject:u}),d.encodings=_.getRtpEncodings({offerMediaObject:u,track:r}),n)for(l=0;l<d.encodings.length;++l)n[l]&&Object.assign(d.encodings[l],n[l]);if(d.encodings.length>1&&"video/vp8"===d.codecs[0].mimeType.toLowerCase()){f=i(d.encodings);try{for(f.s();!(h=f.n()).done;)h.value.scalabilityMode="S1T3"}catch(e){f.e(e)}finally{f.f()}}return this._remoteSdp.send({offerMediaObject:u,offerRtpParameters:d,answerRtpParameters:p,codecOptions:a}),y={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("send() | calling pc.setRemoteDescription() [answer:%o]",y),e.next=32,this._pc.setRemoteDescription(y);case 32:return v=String(this._nextSendLocalId),this._nextSendLocalId++,this._mapSendLocalIdTrack.set(v,r),e.abrupt("return",{localId:v,rtpParameters:d});case 36:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"stopSending",value:(E=u(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),R.debug("stopSending() [localId:%s]",t),r=this._mapSendLocalIdTrack.get(t)){e.next=5;break}throw new Error("track not found");case 5:return this._mapSendLocalIdTrack.delete(t),this._sendStream.removeTrack(r),this._pc.addStream(this._sendStream),e.next=10,this._pc.createOffer();case 10:return n=e.sent,R.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=12,e.next=15,this._pc.setLocalDescription(n);case 15:e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(12),0!==this._sendStream.getTracks().length){e.next=22;break}return R.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 22:throw e.t0;case 23:if("stable"!==this._pc.signalingState){e.next=25;break}return e.abrupt("return");case 25:return i={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=29,this._pc.setRemoteDescription(i);case 29:case"end":return e.stop()}}),e,this,[[12,17]])}))),function(e){return E.apply(this,arguments)})},{key:"replaceTrack",value:(O=u(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return O.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(T=u(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v.UnsupportedError(" not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return T.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(P=u(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return P.apply(this,arguments)})},{key:"getSenderStats",value:(C=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return C.apply(this,arguments)})},{key:"sendDataChannel",value:(S=u(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,s=t.priority,this._assertSendDirection(),c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:i,protocol:o,priority:s},R.debug("sendDataChannel() [options:%o]",c),u=this._pc.createDataChannel(a,c),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%x.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(d=e.sent,p=m.parse(d.sdp),l=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:p});case 15:return R.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),e.next=18,this._pc.setLocalDescription(d);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:l}),f={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.next=23,this._pc.setRemoteDescription(f);case 23:this._hasDataChannelMediaSection=!0;case 24:return h={streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits},e.abrupt("return",{dataChannel:u,sctpStreamParameters:h});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"receive",value:(y=u(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),R.debug("receive() [trackId:%s, kind:%s]",r,n),a=r,o=n,s=i.rtcp.cname,this._remoteSdp.receive({mid:o,kind:n,offerRtpParameters:i,streamId:s,trackId:r}),c={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=11,this._pc.setRemoteDescription(c);case 11:return e.next=13,this._pc.createAnswer();case 13:if(u=e.sent,d=m.parse(u.sdp),p=d.media.find((function(e){return String(e.mid)===o})),w.applyCodecParameters({offerRtpParameters:i,answerMediaObject:p}),u={type:"answer",sdp:m.write(d)},this._transportReady){e.next=21;break}return e.next=21,this._setupTransport({localDtlsRole:"client",localSdpObject:d});case 21:return R.debug("receive() | calling pc.setLocalDescription() [answer:%o]",u),e.next=24,this._pc.setLocalDescription(u);case 24:if(l=this._pc.getRemoteStreams().find((function(e){return e.id===s})),f=l.getTrackById(a)){e.next=28;break}throw new Error("remote track not found");case 28:return this._mapRecvLocalIdInfo.set(a,{mid:o,rtpParameters:i}),e.abrupt("return",{localId:a,track:f});case 30:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"stopReceiving",value:(h=u(regeneratorRuntime.mark((function e(t){var r,n,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertRecvDirection(),R.debug("stopReceiving() [localId:%s]",t),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.mid,i=r.rtpParameters,this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:n,offerRtpParameters:i}),a={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),e.next=9,this._pc.setRemoteDescription(a);case 9:return e.next=11,this._pc.createAnswer();case 11:return o=e.sent,R.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",o),e.next=15,this._pc.setLocalDescription(o);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getReceiverStats",value:(f=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"receiveDataChannel",value:(c=u(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),a=r.streamId,o=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,u={negotiated:!0,id:a,ordered:o,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:c,protocol:i},R.debug("receiveDataChannel() [options:%o]",u),d=this._pc.createDataChannel(n,u),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),p={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),e.next=12,this._pc.setRemoteDescription(p);case 12:return e.next=14,this._pc.createAnswer();case 14:if(l=e.sent,this._transportReady){e.next=19;break}return f=m.parse(l.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:f});case 19:return R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),e.next=22,this._pc.setLocalDescription(l);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"_setupTransport",value:(a=u(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=m.parse(this._pc.localDescription.sdp)),(i=w.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Chrome55"}}],n=[{key:"createFactory",value:function(){return function(){return new N}}}],r&&d(t.prototype,r),n&&d(t,n),N}(S.HandlerInterface);t.Chrome55=C},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){u(a,n,i,o,s,"next",e)}function s(e){u(a,n,i,o,s,"throw",e)}o(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=m(e);if(t){var i=m(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return h(this,r)}}function h(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var y=r(4),v=r(0),g=r(3),b=r(1),w=r(2),_=r(6),S=r(10),k=r(5),R=r(7),x=new v.Logger("Firefox60"),C={OS:16,MIS:2048},P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(L,e);var t,r,n,a,o,c,u,h,m,v,k,P,T,O,E,D,j,I,M,A,F=f(L);function L(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,L),(e=F.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=L,r=[{key:"close",value:function(){if(x.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:(A=d(regeneratorRuntime.mark((function e(){var t,r,n,i,a,o,s,c,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),(r=document.createElement("canvas")).getContext("2d"),n=r.captureStream(),i=n.getVideoTracks()[0],e.prev=6,t.addTransceiver("audio",{direction:"sendrecv"}),a=t.addTransceiver(i,{direction:"sendrecv"}),o=a.sender.getParameters(),s=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}],o.encodings=s,e.next=14,a.sender.setParameters(o);case 14:return e.next=16,t.createOffer();case 16:c=e.sent;try{r.remove()}catch(e){}try{i.stop()}catch(e){}try{t.close()}catch(e){}return u=y.parse(c.sdp),d=_.extractRtpCapabilities({sdpObject:u}),e.abrupt("return",d);case 25:e.prev=25,e.t0=e.catch(6);try{r.remove()}catch(e){}try{i.stop()}catch(e){}try{t.close()}catch(e){}throw e.t0;case 31:case"end":return e.stop()}}),e,null,[[6,25]])}))),function(){return A.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(M=d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:C});case 2:case"end":return e.stop()}}),e)}))),function(){return M.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,d=e.additionalSettings,p=e.proprietaryConstraints,l=e.extendedRtpCapabilities;x.debug("run()"),this._direction=r,this._remoteSdp=new R.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o}),this._sendingRtpParametersByKind={audio:w.getSendingRtpParameters("audio",l),video:w.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:w.getSendingRemoteRtpParameters("audio",l),video:w.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection(s({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},d),p),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(I=d(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new g.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"restartIce",value:(j=d(regeneratorRuntime.mark((function e(t){var r,n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,x.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},x.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},x.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,x.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"getTransportStats",value:(D=d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"send",value:(E=d(regeneratorRuntime.mark((function e(t){var r,n,a,o,s,c,u,d,p,l,f,h,m,v,g,k,R;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.track,n=t.encodings,a=t.codecOptions,o=t.codec,this._assertSendDirection(),x.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),n&&n.length>1&&(n.forEach((function(e,t){e.rid="r".concat(t)})),s=b.clone(n).reverse()),(c=b.clone(this._sendingRtpParametersByKind[r.kind])).codecs=w.reduceCodecs(c.codecs,o),(u=b.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=w.reduceCodecs(u.codecs,o),d=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream]}),!s){e.next=14;break}return(p=d.sender.getParameters()).encodings=s,e.next=14,d.sender.setParameters(p);case 14:return e.next=16,this._pc.createOffer();case 16:if(l=e.sent,f=y.parse(l.sdp),this._transportReady){e.next=21;break}return e.next=21,this._setupTransport({localDtlsRole:"client",localSdpObject:f});case 21:return x.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),e.next=24,this._pc.setLocalDescription(l);case 24:if(h=d.mid,c.mid=h,f=y.parse(this._pc.localDescription.sdp),m=f.media[f.media.length-1],c.rtcp.cname=_.getCname({offerMediaObject:m}),n?1===n.length?(v=S.getRtpEncodings({offerMediaObject:m}),Object.assign(v[0],n[0]),c.encodings=v):c.encodings=n:c.encodings=S.getRtpEncodings({offerMediaObject:m}),c.encodings.length>1&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase())){g=i(c.encodings);try{for(g.s();!(k=g.n()).done;)k.value.scalabilityMode="S1T3"}catch(e){g.e(e)}finally{g.f()}}return this._remoteSdp.send({offerMediaObject:m,offerRtpParameters:c,answerRtpParameters:u,codecOptions:a,extmapAllowMixed:!0}),R={type:"answer",sdp:this._remoteSdp.getSdp()},x.debug("send() | calling pc.setRemoteDescription() [answer:%o]",R),e.next=36,this._pc.setRemoteDescription(R);case 36:return this._mapMidTransceiver.set(h,d),e.abrupt("return",{localId:h,rtpParameters:c,rtpSender:d.sender});case 38:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"stopSending",value:(O=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated transceiver not found");case 4:return r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.disableMediaSection(r.mid),e.next=9,this._pc.createOffer();case 9:return n=e.sent,x.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=13,this._pc.setLocalDescription(n);case 13:return i={type:"answer",sdp:this._remoteSdp.getSdp()},x.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=17,this._pc.setRemoteDescription(i);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"replaceTrack",value:(T=d(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r?x.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):x.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return T.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(P=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),x.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated transceiver not found");case 5:return i=n.sender.getParameters(),r=i.encodings.length-1-r,i.encodings.forEach((function(e,t){e.active=t>=r})),e.next=10,n.sender.setParameters(i);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(k=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),x.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=s(s({},e),r)})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"getSenderStats",value:(v=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"sendDataChannel",value:(m=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,s=t.priority,this._assertSendDirection(),c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:o,priority:s},x.debug("sendDataChannel() [options:%o]",c),u=this._pc.createDataChannel(a,c),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%C.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(d=e.sent,p=y.parse(d.sdp),l=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:p});case 15:return x.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),e.next=18,this._pc.setLocalDescription(d);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:l}),f={type:"answer",sdp:this._remoteSdp.getSdp()},x.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.next=23,this._pc.setRemoteDescription(f);case 23:this._hasDataChannelMediaSection=!0;case 24:return h={streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits},e.abrupt("return",{dataChannel:u,sctpStreamParameters:h});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"receive",value:(h=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),x.debug("receive() [trackId:%s, kind:%s]",r,n),a=i.mid||String(this._mapMidTransceiver.size),this._remoteSdp.receive({mid:a,kind:n,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:r}),o={type:"offer",sdp:this._remoteSdp.getSdp()},x.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=9,this._pc.setRemoteDescription(o);case 9:return e.next=11,this._pc.createAnswer();case 11:if(s=e.sent,c=y.parse(s.sdp),u=c.media.find((function(e){return String(e.mid)===a})),_.applyCodecParameters({offerRtpParameters:i,answerMediaObject:u}),s={type:"answer",sdp:y.write(c)},this._transportReady){e.next=19;break}return e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:c});case 19:return x.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),e.next=22,this._pc.setLocalDescription(s);case 22:if(d=this._pc.getTransceivers().find((function(e){return e.mid===a}))){e.next=25;break}throw new Error("new RTCRtpTransceiver not found");case 25:return this._mapMidTransceiver.set(a,d),e.abrupt("return",{localId:a,track:d.receiver.track,rtpReceiver:d.receiver});case 27:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"stopReceiving",value:(u=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),x.debug("stopReceiving() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return this._remoteSdp.closeMediaSection(r.mid),n={type:"offer",sdp:this._remoteSdp.getSdp()},x.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),e.next=10,this._pc.setRemoteDescription(n);case 10:return e.next=12,this._pc.createAnswer();case 12:return i=e.sent,x.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),e.next=16,this._pc.setLocalDescription(i);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getReceiverStats",value:(c=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"receiveDataChannel",value:(o=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),a=r.streamId,o=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,u={negotiated:!0,id:a,ordered:o,maxPacketLifeTime:s,maxRetransmits:c,protocol:i},x.debug("receiveDataChannel() [options:%o]",u),d=this._pc.createDataChannel(n,u),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),p={type:"offer",sdp:this._remoteSdp.getSdp()},x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),e.next=12,this._pc.setRemoteDescription(p);case 12:return e.next=14,this._pc.createAnswer();case 14:if(l=e.sent,this._transportReady){e.next=19;break}return f=y.parse(l.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:f});case 19:return x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),e.next=22,this._pc.setLocalDescription(l);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_setupTransport",value:(a=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=y.parse(this._pc.localDescription.sdp)),(i=_.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Firefox60"}}],n=[{key:"createFactory",value:function(){return function(){return new L}}}],r&&p(t.prototype,r),n&&p(t,n),L}(k.HandlerInterface);t.Firefox60=P},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){u(a,n,i,o,s,"next",e)}function s(e){u(a,n,i,o,s,"throw",e)}o(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=m(e);if(t){var i=m(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return h(this,r)}}function h(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var y=r(4),v=r(0),g=r(1),b=r(2),w=r(6),_=r(10),S=r(5),k=r(7),R=new v.Logger("Safari12"),x={OS:1024,MIS:1024},C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(F,e);var t,r,n,a,o,c,u,h,m,v,S,C,P,T,O,E,D,j,I,M,A=f(F);function F(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,F),(e=A.call(this))._mapMidTransceiver=new Map,e._sendStream=new MediaStream,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=F,r=[{key:"close",value:function(){if(R.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:(M=d(regeneratorRuntime.mark((function e(){var t,r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),e.prev=2,t.addTransceiver("audio"),t.addTransceiver("video"),e.next=7,t.createOffer();case 7:r=e.sent;try{t.close()}catch(e){}return n=y.parse(r.sdp),i=w.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 14:e.prev=14,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[2,14]])}))),function(){return M.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(I=d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:x});case 2:case"end":return e.stop()}}),e)}))),function(){return I.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,d=e.additionalSettings,p=e.proprietaryConstraints,l=e.extendedRtpCapabilities;R.debug("run()"),this._direction=r,this._remoteSdp=new k.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o}),this._sendingRtpParametersByKind={audio:b.getSendingRtpParameters("audio",l),video:b.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:b.getSendingRemoteRtpParameters("audio",l),video:b.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection(s({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},d),p),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(j=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:R.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"restartIce",value:(D=d(regeneratorRuntime.mark((function e(t){var r,n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,R.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,R.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"getTransportStats",value:(E=d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"send",value:(O=d(regeneratorRuntime.mark((function e(t){var r,n,a,o,s,c,u,d,p,l,f,h,m,v,S,k;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,a=t.codecOptions,o=t.codec,this._assertSendDirection(),R.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),(s=g.clone(this._sendingRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(s.codecs,o),(c=g.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(c.codecs,o),u=this._remoteSdp.getNextMediaSectionIdx(),d=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream]}),e.next=11,this._pc.createOffer();case 11:if(p=e.sent,l=y.parse(p.sdp),this._transportReady){e.next=16;break}return e.next=16,this._setupTransport({localDtlsRole:"server",localSdpObject:l});case 16:return n&&n.length>1&&(R.debug("send() | enabling legacy simulcast"),l=y.parse(p.sdp),f=l.media[u.idx],_.addLegacySimulcast({offerMediaObject:f,numStreams:n.length}),p={type:"offer",sdp:y.write(l)}),R.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),e.next=20,this._pc.setLocalDescription(p);case 20:if(h=d.mid,s.mid=h,l=y.parse(this._pc.localDescription.sdp),f=l.media[u.idx],s.rtcp.cname=w.getCname({offerMediaObject:f}),s.encodings=_.getRtpEncodings({offerMediaObject:f}),n)for(m=0;m<s.encodings.length;++m)n[m]&&Object.assign(s.encodings[m],n[m]);if(s.encodings.length>1&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase())){v=i(s.encodings);try{for(v.s();!(S=v.n()).done;)S.value.scalabilityMode="S1T3"}catch(e){v.e(e)}finally{v.f()}}return this._remoteSdp.send({offerMediaObject:f,reuseMid:u.reuseMid,offerRtpParameters:s,answerRtpParameters:c,codecOptions:a}),k={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),e.next=33,this._pc.setRemoteDescription(k);case 33:return this._mapMidTransceiver.set(h,d),e.abrupt("return",{localId:h,rtpParameters:s,rtpSender:d.sender});case 35:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"stopSending",value:(T=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),R.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid),e.next=10,this._pc.createOffer();case 10:return n=e.sent,R.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.next=14,this._pc.setLocalDescription(n);case 14:return i={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=18,this._pc.setRemoteDescription(i);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"replaceTrack",value:(P=d(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r?R.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):R.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return e.next=7,n.sender.replaceTrack(r);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(C=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),R.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(S=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),R.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return(i=n.sender.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=s(s({},e),r)})),e.next=9,n.sender.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return S.apply(this,arguments)})},{key:"getSenderStats",value:(v=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.sender.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"sendDataChannel",value:(m=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,s=t.priority,this._assertSendDirection(),c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:o,priority:s},R.debug("sendDataChannel() [options:%o]",c),u=this._pc.createDataChannel(a,c),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%x.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(d=e.sent,p=y.parse(d.sdp),l=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:p});case 15:return R.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),e.next=18,this._pc.setLocalDescription(d);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:l}),f={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.next=23,this._pc.setRemoteDescription(f);case 23:this._hasDataChannelMediaSection=!0;case 24:return h={streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits},e.abrupt("return",{dataChannel:u,sctpStreamParameters:h});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"receive",value:(h=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),R.debug("receive() [trackId:%s, kind:%s]",r,n),a=i.mid||String(this._mapMidTransceiver.size),this._remoteSdp.receive({mid:a,kind:n,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:r}),o={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),e.next=9,this._pc.setRemoteDescription(o);case 9:return e.next=11,this._pc.createAnswer();case 11:if(s=e.sent,c=y.parse(s.sdp),u=c.media.find((function(e){return String(e.mid)===a})),w.applyCodecParameters({offerRtpParameters:i,answerMediaObject:u}),s={type:"answer",sdp:y.write(c)},this._transportReady){e.next=19;break}return e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:c});case 19:return R.debug("receive() | calling pc.setLocalDescription() [answer:%o]",s),e.next=22,this._pc.setLocalDescription(s);case 22:if(d=this._pc.getTransceivers().find((function(e){return e.mid===a}))){e.next=25;break}throw new Error("new RTCRtpTransceiver not found");case 25:return this._mapMidTransceiver.set(a,d),e.abrupt("return",{localId:a,track:d.receiver.track,rtpReceiver:d.receiver});case 27:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"stopReceiving",value:(u=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),R.debug("stopReceiving() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.next=5;break}throw new Error("associated RTCRtpTransceiver not found");case 5:return this._remoteSdp.closeMediaSection(r.mid),n={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),e.next=10,this._pc.setRemoteDescription(n);case 10:return e.next=12,this._pc.createAnswer();case 12:return i=e.sent,R.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),e.next=16,this._pc.setLocalDescription(i);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getReceiverStats",value:(c=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.next=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:return e.abrupt("return",r.receiver.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"receiveDataChannel",value:(o=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),a=r.streamId,o=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,u={negotiated:!0,id:a,ordered:o,maxPacketLifeTime:s,maxRetransmits:c,protocol:i},R.debug("receiveDataChannel() [options:%o]",u),d=this._pc.createDataChannel(n,u),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation(),p={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),e.next=12,this._pc.setRemoteDescription(p);case 12:return e.next=14,this._pc.createAnswer();case 14:if(l=e.sent,this._transportReady){e.next=19;break}return f=y.parse(l.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:f});case 19:return R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),e.next=22,this._pc.setLocalDescription(l);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_setupTransport",value:(a=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=y.parse(this._pc.localDescription.sdp)),(i=w.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Safari12"}}],n=[{key:"createFactory",value:function(){return function(){return new F}}}],r&&p(t.prototype,r),n&&p(t,n),F}(S.HandlerInterface);t.Safari12=C},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){u(a,n,i,o,s,"next",e)}function s(e){u(a,n,i,o,s,"throw",e)}o(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=m(e);if(t){var i=m(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return h(this,r)}}function h(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var y=r(4),v=r(0),g=r(1),b=r(2),w=r(6),_=r(11),S=r(5),k=r(7),R=new v.Logger("Safari11"),x={OS:1024,MIS:1024},C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(F,e);var t,r,n,a,o,c,u,h,m,v,S,C,P,T,O,E,D,j,I,M,A=f(F);function F(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,F),(e=A.call(this))._sendStream=new MediaStream,e._mapSendLocalIdRtpSender=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=F,r=[{key:"close",value:function(){if(R.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:(M=d(regeneratorRuntime.mark((function e(){var t,r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=y.parse(r.sdp),i=w.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),function(){return M.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(I=d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:x});case 2:case"end":return e.stop()}}),e)}))),function(){return I.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,c=e.iceServers,u=e.iceTransportPolicy,d=e.additionalSettings,p=e.proprietaryConstraints,l=e.extendedRtpCapabilities;R.debug("run()"),this._direction=r,this._remoteSdp=new k.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:o,planB:!0}),this._sendingRtpParametersByKind={audio:b.getSendingRtpParameters("audio",l),video:b.getSendingRtpParameters("video",l)},this._sendingRemoteRtpParametersByKind={audio:b.getSendingRemoteRtpParameters("audio",l),video:b.getSendingRemoteRtpParameters("video",l)},this._pc=new RTCPeerConnection(s({iceServers:c||[],iceTransportPolicy:u||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},d),p),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(j=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:R.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"restartIce",value:(D=d(regeneratorRuntime.mark((function e(t){var r,n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,R.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,R.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"getTransportStats",value:(E=d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"send",value:(O=d(regeneratorRuntime.mark((function e(t){var r,n,a,o,s,c,u,d,p,l,f,h,m,v,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,a=t.codecOptions,o=t.codec,this._assertSendDirection(),R.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),o&&R.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addTrack(r,this._sendStream),e.next=8,this._pc.createOffer();case 8:if(s=e.sent,c=y.parse(s.sdp),(d=g.clone(this._sendingRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(d.codecs),(p=g.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(p.codecs),this._transportReady){e.next=17;break}return e.next=17,this._setupTransport({localDtlsRole:"server",localSdpObject:c});case 17:return"video"===r.kind&&n&&n.length>1&&(R.debug("send() | enabling simulcast"),c=y.parse(s.sdp),u=c.media.find((function(e){return"video"===e.type})),_.addLegacySimulcast({offerMediaObject:u,track:r,numStreams:n.length}),s={type:"offer",sdp:y.write(c)}),R.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),e.next=21,this._pc.setLocalDescription(s);case 21:if(c=y.parse(this._pc.localDescription.sdp),u=c.media.find((function(e){return e.type===r.kind})),d.rtcp.cname=w.getCname({offerMediaObject:u}),d.encodings=_.getRtpEncodings({offerMediaObject:u,track:r}),n)for(l=0;l<d.encodings.length;++l)n[l]&&Object.assign(d.encodings[l],n[l]);if(d.encodings.length>1&&"video/vp8"===d.codecs[0].mimeType.toLowerCase()){f=i(d.encodings);try{for(f.s();!(h=f.n()).done;)h.value.scalabilityMode="S1T3"}catch(e){f.e(e)}finally{f.f()}}return this._remoteSdp.send({offerMediaObject:u,offerRtpParameters:d,answerRtpParameters:p,codecOptions:a}),m={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),e.next=32,this._pc.setRemoteDescription(m);case 32:return v=String(this._nextSendLocalId),this._nextSendLocalId++,S=this._pc.getSenders().find((function(e){return e.track===r})),this._mapSendLocalIdRtpSender.set(v,S),e.abrupt("return",{localId:v,rtpParameters:d,rtpSender:S});case 37:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"stopSending",value:(T=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapSendLocalIdRtpSender.get(t)){e.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return r.track&&this._sendStream.removeTrack(r.track),this._mapSendLocalIdRtpSender.delete(t),e.next=8,this._pc.createOffer();case 8:return n=e.sent,R.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=10,e.next=13,this._pc.setLocalDescription(n);case 13:e.next=21;break;case 15:if(e.prev=15,e.t0=e.catch(10),0!==this._sendStream.getTracks().length){e.next=20;break}return R.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 20:throw e.t0;case 21:if("stable"!==this._pc.signalingState){e.next=23;break}return e.abrupt("return");case 23:return i={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=27,this._pc.setRemoteDescription(i);case 27:case"end":return e.stop()}}),e,this,[[10,15]])}))),function(e){return T.apply(this,arguments)})},{key:"replaceTrack",value:(P=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r?R.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):R.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return i=n.track,e.next=8,n.replaceTrack(r);case 8:i&&this._sendStream.removeTrack(i),r&&this._sendStream.addTrack(r);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(C=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),R.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=n.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=9,n.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(S=d(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),R.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapSendLocalIdRtpSender.get(t)){e.next=5;break}throw new Error("associated RTCRtpSender not found");case 5:return(i=n.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=s(s({},e),r)})),e.next=9,n.setParameters(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return S.apply(this,arguments)})},{key:"getSenderStats",value:(v=d(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),r=this._mapSendLocalIdRtpSender.get(t)){e.next=4;break}throw new Error("associated RTCRtpSender not found");case 4:return e.abrupt("return",r.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"sendDataChannel",value:(m=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,s=t.priority,this._assertSendDirection(),c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:o,priority:s},R.debug("sendDataChannel() [options:%o]",c),u=this._pc.createDataChannel(a,c),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%x.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(d=e.sent,p=y.parse(d.sdp),l=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:p});case 15:return R.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),e.next=18,this._pc.setLocalDescription(d);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:l}),f={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.next=23,this._pc.setRemoteDescription(f);case 23:this._hasDataChannelMediaSection=!0;case 24:return h={streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits},e.abrupt("return",{dataChannel:u,sctpStreamParameters:h});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"receive",value:(h=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),R.debug("receive() [trackId:%s, kind:%s]",r,n),a=r,o=n,this._remoteSdp.receive({mid:o,kind:n,offerRtpParameters:i,streamId:i.rtcp.cname,trackId:r}),s={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",s),e.next=10,this._pc.setRemoteDescription(s);case 10:return e.next=12,this._pc.createAnswer();case 12:if(c=e.sent,u=y.parse(c.sdp),d=u.media.find((function(e){return String(e.mid)===o})),w.applyCodecParameters({offerRtpParameters:i,answerMediaObject:d}),c={type:"answer",sdp:y.write(u)},this._transportReady){e.next=20;break}return e.next=20,this._setupTransport({localDtlsRole:"client",localSdpObject:u});case 20:return R.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),e.next=23,this._pc.setLocalDescription(c);case 23:if(p=this._pc.getReceivers().find((function(e){return e.track&&e.track.id===a}))){e.next=26;break}throw new Error("new RTCRtpReceiver not");case 26:return this._mapRecvLocalIdInfo.set(a,{mid:o,rtpParameters:i,rtpReceiver:p}),e.abrupt("return",{localId:a,track:p.track,rtpReceiver:p});case 28:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"stopReceiving",value:(u=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertRecvDirection(),R.debug("stopReceiving() [localId:%s]",t),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.mid,i=r.rtpParameters,this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:n,offerRtpParameters:i}),a={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),e.next=9,this._pc.setRemoteDescription(a);case 9:return e.next=11,this._pc.createAnswer();case 11:return o=e.sent,R.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",o),e.next=15,this._pc.setLocalDescription(o);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"getReceiverStats",value:(c=d(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertRecvDirection(),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.rtpReceiver){e.next=4;break}throw new Error("associated RTCRtpReceiver not found");case 4:return e.abrupt("return",n.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"receiveDataChannel",value:(o=d(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),a=r.streamId,o=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,u={negotiated:!0,id:a,ordered:o,maxPacketLifeTime:s,maxRetransmits:c,protocol:i},R.debug("receiveDataChannel() [options:%o]",u),d=this._pc.createDataChannel(n,u),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),p={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),e.next=12,this._pc.setRemoteDescription(p);case 12:return e.next=14,this._pc.createAnswer();case 14:if(l=e.sent,this._transportReady){e.next=19;break}return f=y.parse(l.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:f});case 19:return R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),e.next=22,this._pc.setLocalDescription(l);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_setupTransport",value:(a=d(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=y.parse(this._pc.localDescription.sdp)),(i=w.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"Safari11"}}],n=[{key:"createFactory",value:function(){return function(){return new F}}}],r&&p(t.prototype,r),n&&p(t,n),F}(S.HandlerInterface);t.Safari11=C},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){s(a,n,i,o,c,"next",e)}function c(e){s(a,n,i,o,c,"throw",e)}o(void 0)}))}}function u(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=m(e);if(t){var i=m(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return h(this,r)}}function h(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var y=r(0),v=r(3),g=r(1),b=r(2),w=r(62),_=r(5),S=new y.Logger("Edge11"),k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(I,e);var t,r,n,i,o,s,d,h,m,y,_,k,R,x,C,P,T,O,E,D,j=f(I);function I(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,I),(e=j.call(this))._rtpSenders=new Map,e._rtpReceivers=new Map,e._nextSendLocalId=0,e._transportReady=!1,e}return t=I,r=[{key:"close",value:function(){S.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e,t=u(this._rtpSenders.values());try{for(t.s();!(e=t.n()).done;){var r=e.value;try{r.stop()}catch(e){}}}catch(e){t.e(e)}finally{t.f()}var n,i=u(this._rtpReceivers.values());try{for(i.s();!(n=i.n()).done;){var a=n.value;try{a.stop()}catch(e){}}}catch(e){i.e(e)}finally{i.f()}}},{key:"getNativeRtpCapabilities",value:(D=c(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("getNativeRtpCapabilities()"),e.abrupt("return",w.getCapabilities());case 2:case"end":return e.stop()}}),e)}))),function(){return D.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(E=c(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:{OS:0,MIS:0}});case 2:case"end":return e.stop()}}),e)}))),function(){return E.apply(this,arguments)})},{key:"run",value:function(e){e.direction;var t=e.iceParameters,r=e.iceCandidates,n=e.dtlsParameters,i=(e.sctpParameters,e.iceServers),a=e.iceTransportPolicy,o=(e.additionalSettings,e.proprietaryConstraints,e.extendedRtpCapabilities);S.debug("run()"),this._sendingRtpParametersByKind={audio:b.getSendingRtpParameters("audio",o),video:b.getSendingRtpParameters("video",o)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=n,this._cname="CNAME-".concat(g.generateRandomNumber()),this._setIceGatherer({iceServers:i,iceTransportPolicy:a}),this._setIceTransport(),this._setDtlsTransport()}},{key:"updateIceServers",value:(O=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v.UnsupportedError("not supported");case 1:case"end":return e.stop()}}),e)}))),function(e){return O.apply(this,arguments)})},{key:"restartIce",value:(T=c(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.debug("restartIce()"),this._remoteIceParameters=t,this._transportReady){e.next=4;break}return e.abrupt("return");case 4:S.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,t,"controlling"),r=u(this._remoteIceCandidates);try{for(r.s();!(n=r.n()).done;)i=n.value,this._iceTransport.addRemoteCandidate(i)}catch(e){r.e(e)}finally{r.f()}this._iceTransport.addRemoteCandidate({});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"getTransportStats",value:(P=c(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._iceTransport.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return P.apply(this,arguments)})},{key:"send",value:(C=c(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,d,p,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.track,n=t.encodings,t.codecOptions,i=t.codec,S.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),this._transportReady){e.next=5;break}return e.next=5,this._setupTransport({localDtlsRole:"server"});case 5:S.debug("send() | calling new RTCRtpSender()"),a=new RTCRtpSender(r,this._dtlsTransport),(o=g.clone(this._sendingRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(o.codecs,i),s=o.codecs.some((function(e){return/.+\/rtx$/i.test(e.mimeType)})),n||(n=[{}]),c=u(n);try{for(c.s();!(d=c.n()).done;)(p=d.value).ssrc=g.generateRandomNumber(),s&&(p.rtx={ssrc:g.generateRandomNumber()})}catch(e){c.e(e)}finally{c.f()}return o.encodings=n,o.rtcp={cname:this._cname,reducedSize:!0,mux:!0},l=w.mangleRtpParameters(o),S.debug("send() | calling rtpSender.send() [params:%o]",l),e.next=19,a.send(l);case 19:return f=String(this._nextSendLocalId),this._nextSendLocalId++,this._rtpSenders.set(f,a),e.abrupt("return",{localId:f,rtpParameters:o,rtpSender:a});case 23:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"stopSending",value:(x=c(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.debug("stopSending() [localId:%s]",t),r=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:this._rtpSenders.delete(t),e.prev=5,S.debug("stopSending() | calling rtpSender.stop()"),r.stop(),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(5),S.warn("stopSending() | rtpSender.stop() failed:%o",e.t0),e.t0;case 14:case"end":return e.stop()}}),e,this,[[5,10]])}))),function(e){return x.apply(this,arguments)})},{key:"replaceTrack",value:(R=c(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r?S.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):S.debug("replaceTrack() [localId:%s, no track]",t),n=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:n.setTrack(r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return R.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(k=c(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:return(i=n.getParameters()).encodings.forEach((function(e,t){e.active=t<=r})),e.next=8,n.setParameters(i);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(_=c(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._rtpSenders.get(t)){e.next=4;break}throw new Error("RTCRtpSender not found");case 4:return(i=n.getParameters()).encodings.forEach((function(e,t){i.encodings[t]=a(a({},e),r)})),e.next=8,n.setParameters(i);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"getSenderStats",value:(y=c(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._rtpSenders.get(t)){e.next=3;break}throw new Error("RTCRtpSender not found");case 3:return e.abrupt("return",r.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"sendDataChannel",value:(m=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"receive",value:(h=c(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.trackId,n=t.kind,i=t.rtpParameters,S.debug("receive() [trackId:%s, kind:%s]",r,n),this._transportReady){e.next=5;break}return e.next=5,this._setupTransport({localDtlsRole:"server"});case 5:return S.debug("receive() | calling new RTCRtpReceiver()"),(a=new RTCRtpReceiver(this._dtlsTransport,n)).addEventListener("error",(function(e){S.error('rtpReceiver "error" event [event:%o]',e)})),o=w.mangleRtpParameters(i),S.debug("receive() | calling rtpReceiver.receive() [params:%o]",o),e.next=12,a.receive(o);case 12:return s=r,this._rtpReceivers.set(s,a),e.abrupt("return",{localId:s,track:a.track,rtpReceiver:a});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"stopReceiving",value:(d=c(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.debug("stopReceiving() [localId:%s]",t),r=this._rtpReceivers.get(t)){e.next=4;break}throw new Error("RTCRtpReceiver not found");case 4:this._rtpReceivers.delete(t);try{S.debug("stopReceiving() | calling rtpReceiver.stop()"),r.stop()}catch(e){S.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}case 6:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getReceiverStats",value:(s=c(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._rtpReceivers.get(t)){e.next=3;break}throw new Error("RTCRtpReceiver not found");case 3:return e.abrupt("return",r.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"receiveDataChannel",value:(o=c(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"_setIceGatherer",value:function(e){var t=e.iceServers,r=e.iceTransportPolicy,n=new RTCIceGatherer({iceServers:t||[],gatherPolicy:r||"all"});n.addEventListener("error",(function(e){S.error('iceGatherer "error" event [event:%o]',e)}));try{n.gather()}catch(e){S.debug("_setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=n}},{key:"_setIceTransport",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",(function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}})),t.addEventListener("icestatechange",(function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}})),t.addEventListener("candidatepairchange",(function(e){S.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=t}},{key:"_setDtlsTransport",value:function(){var e=this,t=new RTCDtlsTransport(this._iceTransport);t.addEventListener("statechange",(function(){S.debug('dtlsTransport "statechange" event [state:%s]',t.state)})),t.addEventListener("dtlsstatechange",(function(){S.debug('dtlsTransport "dtlsstatechange" event [state:%s]',t.state),"closed"===t.state&&e.emit("@connectionstatechange","closed")})),t.addEventListener("error",(function(e){S.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=t}},{key:"_setupTransport",value:(i=c(regeneratorRuntime.mark((function e(t){var r,n,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,S.debug("_setupTransport()"),(n=this._dtlsTransport.getLocalParameters()).role=r,e.next=6,this.safeEmitAsPromise("@connect",{dtlsParameters:n});case 6:this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling"),i=u(this._remoteIceCandidates);try{for(i.s();!(a=i.n()).done;)o=a.value,this._iceTransport.addRemoteCandidate(o)}catch(e){i.e(e)}finally{i.f()}this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter((function(e){return"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm})),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0;case 13:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"name",get:function(){return"Edge11"}}],n=[{key:"createFactory",value:function(){return function(){return new I}}}],r&&p(t.prototype,r),n&&p(t,n),I}(_.HandlerInterface);t.Edge11=k},function(e,t,r){"use strict";function n(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Object.defineProperty(t,"__esModule",{value:!0});var a=r(1);t.getCapabilities=function(){var e,t=RTCRtpReceiver.getCapabilities(),r=a.clone(t),i=n(r.codecs);try{for(i.s();!(e=i.n()).done;){var o=e.value;if(o.channels=o.numChannels,delete o.numChannels,o.mimeType=o.mimeType||"".concat(o.kind,"/").concat(o.name),o.parameters){var s=o.parameters;s.apt&&(s.apt=Number(s.apt)),s["packetization-mode"]&&(s["packetization-mode"]=Number(s["packetization-mode"]))}var c,u=n(o.rtcpFeedback||[]);try{for(u.s();!(c=u.n()).done;){var d=c.value;d.parameter||(d.parameter="")}}catch(e){u.e(e)}finally{u.f()}}}catch(e){i.e(e)}finally{i.f()}return r},t.mangleRtpParameters=function(e){var t=a.clone(e);t.mid&&(t.muxId=t.mid,delete t.mid);var r,i=n(t.codecs);try{for(i.s();!(r=i.n()).done;){var o=r.value;o.channels&&(o.numChannels=o.channels,delete o.channels),o.mimeType&&!o.name&&(o.name=o.mimeType.split("/")[1]),delete o.mimeType}}catch(e){i.e(e)}finally{i.f()}return t}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){c(a,n,i,o,s,"next",e)}function s(e){c(a,n,i,o,s,"throw",e)}o(void 0)}))}}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=h(e);if(t){var i=h(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f(this,r)}}function f(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(t,"__esModule",{value:!0});var m=r(4),y=r(0),v=r(3),g=r(1),b=r(2),w=r(6),_=r(11),S=r(5),k=r(7),R=new y.Logger("ReactNative"),x={OS:1024,MIS:1024},C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(N,e);var t,r,n,a,c,f,h,y,S,C,P,T,O,E,D,j,I,M,A,F,L=l(N);function N(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,N),(e=L.call(this))._sendStream=new MediaStream,e._mapSendLocalIdTrack=new Map,e._nextSendLocalId=0,e._mapRecvLocalIdInfo=new Map,e._hasDataChannelMediaSection=!1,e._nextSendSctpStreamId=0,e._transportReady=!1,e}return t=N,r=[{key:"close",value:function(){if(R.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}},{key:"getNativeRtpCapabilities",value:(F=u(regeneratorRuntime.mark((function e(){var t,r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"}),e.prev=2,e.next=5,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 5:r=e.sent;try{t.close()}catch(e){}return n=m.parse(r.sdp),i=w.extractRtpCapabilities({sdpObject:n}),e.abrupt("return",i);case 12:e.prev=12,e.t0=e.catch(2);try{t.close()}catch(e){}throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),function(){return F.apply(this,arguments)})},{key:"getNativeSctpCapabilities",value:(A=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.debug("getNativeSctpCapabilities()"),e.abrupt("return",{numStreams:x});case 2:case"end":return e.stop()}}),e)}))),function(){return A.apply(this,arguments)})},{key:"run",value:function(e){var t=this,r=e.direction,n=e.iceParameters,i=e.iceCandidates,a=e.dtlsParameters,c=e.sctpParameters,u=e.iceServers,d=e.iceTransportPolicy,p=e.additionalSettings,l=e.proprietaryConstraints,f=e.extendedRtpCapabilities;R.debug("run()"),this._direction=r,this._remoteSdp=new k.RemoteSdp({iceParameters:n,iceCandidates:i,dtlsParameters:a,sctpParameters:c,planB:!0}),this._sendingRtpParametersByKind={audio:b.getSendingRtpParameters("audio",f),video:b.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:b.getSendingRemoteRtpParameters("audio",f),video:b.getSendingRemoteRtpParameters("video",f)},this._pc=new RTCPeerConnection(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({iceServers:u||[],iceTransportPolicy:d||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},p),l),this._pc.addEventListener("iceconnectionstatechange",(function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}))}},{key:"updateIceServers",value:(M=u(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:R.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"restartIce",value:(I=u(regeneratorRuntime.mark((function e(t){var r,n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.next=4;break}return e.abrupt("return");case 4:if("send"!==this._direction){e.next=17;break}return e.next=7,this._pc.createOffer({iceRestart:!0});case 7:return r=e.sent,R.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.next=11,this._pc.setLocalDescription(r);case 11:return n={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.next=15,this._pc.setRemoteDescription(n);case 15:e.next=27;break;case 17:return i={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.next=21,this._pc.setRemoteDescription(i);case 21:return e.next=23,this._pc.createAnswer();case 23:return a=e.sent,R.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",a),e.next=27,this._pc.setLocalDescription(a);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"getTransportStats",value:(j=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pc.getStats());case 1:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"send",value:(D=u(regeneratorRuntime.mark((function e(t){var r,n,a,o,s,c,u,d,p,l,f,h,y,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.track,n=t.encodings,a=t.codecOptions,o=t.codec,this._assertSendDirection(),R.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),o&&R.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(r),this._pc.addStream(this._sendStream),e.next=8,this._pc.createOffer();case 8:if(s=e.sent,c=m.parse(s.sdp),(d=g.clone(this._sendingRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(d.codecs),(p=g.clone(this._sendingRemoteRtpParametersByKind[r.kind])).codecs=b.reduceCodecs(p.codecs),this._transportReady){e.next=17;break}return e.next=17,this._setupTransport({localDtlsRole:"server",localSdpObject:c});case 17:return"video"===r.kind&&n&&n.length>1&&(R.debug("send() | enabling simulcast"),c=m.parse(s.sdp),u=c.media.find((function(e){return"video"===e.type})),_.addLegacySimulcast({offerMediaObject:u,track:r,numStreams:n.length}),s={type:"offer",sdp:m.write(c)}),R.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),e.next=21,this._pc.setLocalDescription(s);case 21:if(c=m.parse(this._pc.localDescription.sdp),u=c.media.find((function(e){return e.type===r.kind})),d.rtcp.cname=w.getCname({offerMediaObject:u}),d.encodings=_.getRtpEncodings({offerMediaObject:u,track:r}),n)for(l=0;l<d.encodings.length;++l)n[l]&&Object.assign(d.encodings[l],n[l]);if(d.encodings.length>1&&("video/vp8"===d.codecs[0].mimeType.toLowerCase()||"video/h264"===d.codecs[0].mimeType.toLowerCase())){f=i(d.encodings);try{for(f.s();!(h=f.n()).done;)h.value.scalabilityMode="S1T3"}catch(e){f.e(e)}finally{f.f()}}return this._remoteSdp.send({offerMediaObject:u,offerRtpParameters:d,answerRtpParameters:p,codecOptions:a}),y={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("send() | calling pc.setRemoteDescription() [answer:%o]",y),e.next=32,this._pc.setRemoteDescription(y);case 32:return v=String(this._nextSendLocalId),this._nextSendLocalId++,this._mapSendLocalIdTrack.set(v,r),e.abrupt("return",{localId:v,rtpParameters:d});case 36:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"stopSending",value:(E=u(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertSendDirection(),R.debug("stopSending() [localId:%s]",t),r=this._mapSendLocalIdTrack.get(t)){e.next=5;break}throw new Error("track not found");case 5:return this._mapSendLocalIdTrack.delete(t),this._sendStream.removeTrack(r),this._pc.addStream(this._sendStream),e.next=10,this._pc.createOffer();case 10:return n=e.sent,R.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.prev=12,e.next=15,this._pc.setLocalDescription(n);case 15:e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(12),0!==this._sendStream.getTracks().length){e.next=22;break}return R.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.t0.toString()),e.abrupt("return");case 22:throw e.t0;case 23:if("stable"!==this._pc.signalingState){e.next=25;break}return e.abrupt("return");case 25:return i={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.next=29,this._pc.setRemoteDescription(i);case 29:case"end":return e.stop()}}),e,this,[[12,17]])}))),function(e){return E.apply(this,arguments)})},{key:"replaceTrack",value:(O=u(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return O.apply(this,arguments)})},{key:"setMaxSpatialLayer",value:(T=u(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return T.apply(this,arguments)})},{key:"setRtpEncodingParameters",value:(P=u(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return P.apply(this,arguments)})},{key:"getSenderStats",value:(C=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return C.apply(this,arguments)})},{key:"sendDataChannel",value:(S=u(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,o=t.protocol,s=t.priority,this._assertSendDirection(),c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:i,protocol:o,priority:s},R.debug("sendDataChannel() [options:%o]",c),u=this._pc.createDataChannel(a,c),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%x.MIS,this._hasDataChannelMediaSection){e.next=24;break}return e.next=9,this._pc.createOffer();case 9:if(d=e.sent,p=m.parse(d.sdp),l=p.media.find((function(e){return"application"===e.type})),this._transportReady){e.next=15;break}return e.next=15,this._setupTransport({localDtlsRole:"server",localSdpObject:p});case 15:return R.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",d),e.next=18,this._pc.setLocalDescription(d);case 18:return this._remoteSdp.sendSctpAssociation({offerMediaObject:l}),f={type:"answer",sdp:this._remoteSdp.getSdp()},R.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.next=23,this._pc.setRemoteDescription(f);case 23:this._hasDataChannelMediaSection=!0;case 24:return h={streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits},e.abrupt("return",{dataChannel:u,sctpStreamParameters:h});case 26:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"receive",value:(y=u(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.trackId,n=t.kind,i=t.rtpParameters,this._assertRecvDirection(),R.debug("receive() [trackId:%s, kind:%s]",r,n),a=r,o=n,s=i.rtcp.cname,R.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),s+="-hack-".concat(g.generateRandomNumber()),this._remoteSdp.receive({mid:o,kind:n,offerRtpParameters:i,streamId:s,trackId:r}),c={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),e.next=13,this._pc.setRemoteDescription(c);case 13:return e.next=15,this._pc.createAnswer();case 15:if(u=e.sent,d=m.parse(u.sdp),p=d.media.find((function(e){return String(e.mid)===o})),w.applyCodecParameters({offerRtpParameters:i,answerMediaObject:p}),u={type:"answer",sdp:m.write(d)},this._transportReady){e.next=23;break}return e.next=23,this._setupTransport({localDtlsRole:"client",localSdpObject:d});case 23:return R.debug("receive() | calling pc.setLocalDescription() [answer:%o]",u),e.next=26,this._pc.setLocalDescription(u);case 26:if(l=this._pc.getRemoteStreams().find((function(e){return e.id===s})),f=l.getTrackById(a)){e.next=30;break}throw new Error("remote track not found");case 30:return this._mapRecvLocalIdInfo.set(a,{mid:o,rtpParameters:i}),e.abrupt("return",{localId:a,track:f});case 32:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"stopReceiving",value:(h=u(regeneratorRuntime.mark((function e(t){var r,n,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertRecvDirection(),R.debug("stopReceiving() [localId:%s]",t),r=this._mapRecvLocalIdInfo.get(t)||{},n=r.mid,i=r.rtpParameters,this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:n,offerRtpParameters:i}),a={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),e.next=9,this._pc.setRemoteDescription(a);case 9:return e.next=11,this._pc.createAnswer();case 11:return o=e.sent,R.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",o),e.next=15,this._pc.setLocalDescription(o);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getReceiverStats",value:(f=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v.UnsupportedError("not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"receiveDataChannel",value:(c=u(regeneratorRuntime.mark((function e(t){var r,n,i,a,o,s,c,u,d,p,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this._assertRecvDirection(),a=r.streamId,o=r.ordered,s=r.maxPacketLifeTime,c=r.maxRetransmits,u={negotiated:!0,id:a,ordered:o,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:c,protocol:i},R.debug("receiveDataChannel() [options:%o]",u),d=this._pc.createDataChannel(n,u),this._hasDataChannelMediaSection){e.next=23;break}return this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),p={type:"offer",sdp:this._remoteSdp.getSdp()},R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",p),e.next=12,this._pc.setRemoteDescription(p);case 12:return e.next=14,this._pc.createAnswer();case 14:if(l=e.sent,this._transportReady){e.next=19;break}return f=m.parse(l.sdp),e.next=19,this._setupTransport({localDtlsRole:"client",localSdpObject:f});case 19:return R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",l),e.next=22,this._pc.setLocalDescription(l);case 22:this._hasDataChannelMediaSection=!0;case 23:return e.abrupt("return",{dataChannel:d});case 24:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"_setupTransport",value:(a=u(regeneratorRuntime.mark((function e(t){var r,n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=m.parse(this._pc.localDescription.sdp)),(i=w.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.next=7,this.safeEmitAsPromise("@connect",{dtlsParameters:i});case 7:this._transportReady=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"_assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"_assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}},{key:"name",get:function(){return"ReactNative"}}],n=[{key:"createFactory",value:function(){return function(){return new N}}}],r&&d(t.prototype,r),n&&d(t,n),N}(S.HandlerInterface);t.ReactNative=C},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(16)),n(r(17)),n(r(19)),n(r(20)),n(r(21)),n(r(22)),n(r(5)),n(r(3))},function(e,t,r){"use strict";var n=r(66).version,i=r(67),a=r(72);t.version=n,t.Peer=i,t.WebSocketTransport=a},function(e){e.exports=JSON.parse('{"_args":[["protoo-client@4.0.4","/home/ubuntu/networked-aframe"]],"_from":"protoo-client@4.0.4","_id":"protoo-client@4.0.4","_inBundle":false,"_integrity":"sha512-+WZUJJTlBSTWYeNu0Tv8SGI3kjettLvr2IUdBsAfioi0Szf8peeky79h6li7gThA3pIpNC+A+IuCUWaK7MlFfQ==","_location":"/protoo-client","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"protoo-client@4.0.4","name":"protoo-client","escapedName":"protoo-client","rawSpec":"4.0.4","saveSpec":null,"fetchSpec":"4.0.4"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/protoo-client/-/protoo-client-4.0.4.tgz","_spec":"4.0.4","_where":"/home/ubuntu/networked-aframe","author":{"name":"Iaki Baz Castillo","email":"ibc@aliax.net"},"bugs":{"url":"https://github.com/ibc/protoo/issues"},"dependencies":{"debug":"^4.1.1","events":"^3.1.0","retry":"^0.12.0","websocket":"^1.0.31"},"description":"protoo JavaScript client module","devDependencies":{"eslint":"^5.16.0"},"engines":{"node":">=8.0.0"},"homepage":"https://protoojs.org","keywords":["nodejs","browser","websocket"],"license":"MIT","main":"lib/index.js","name":"protoo-client","optionalDependencies":{"websocket":"^1.0.31"},"repository":{"type":"git","url":"git+https://github.com/ibc/protoo.git"},"scripts":{"lint":"eslint -c .eslintrc.js lib"},"version":"4.0.4"}')},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function s(e){i(o,n,a,s,c,"next",e)}function c(e){i(o,n,a,s,c,"throw",e)}s(void 0)}))}}function o(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=l(e);if(t){var i=l(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return p(this,r)}}function p(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=r(12),h=r(24),m=r(25),y=new f("Peer"),v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(l,e);var t,r,n,i,s,p=d(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),t=p.call(this,y),y.debug("constructor()"),t._closed=!1,t._transport=e,t._connected=!1,t._data={},t._sents=new Map,t._handleTransport(),t}return t=l,(r=[{key:"close",value:function(){if(!this._closed){y.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();var e,t=o(this._sents.values());try{for(t.s();!(e=t.n()).done;)e.value.close()}catch(e){t.e(e)}finally{t.f()}this.safeEmit("close")}}},{key:"request",value:(s=a(regeneratorRuntime.mark((function e(t){var r,n,i=this,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:void 0,n=m.createRequest(t,r),this._logger.debug("request() [method:%s, id:%s]",t,n.id),e.next=5,this._transport.send(n);case 5:return e.abrupt("return",new Promise((function(e,t){var r=1500*(15+.1*i._sents.size),a={id:n.id,method:n.method,resolve:function(t){i._sents.delete(n.id)&&(clearTimeout(a.timer),e(t))},reject:function(e){i._sents.delete(n.id)&&(clearTimeout(a.timer),t(e))},timer:setTimeout((function(){i._sents.delete(n.id)&&t(new Error("request timeout"))}),r),close:function(){clearTimeout(a.timer),t(new Error("peer closed"))}};i._sents.set(n.id,a)})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"notify",value:(i=a(regeneratorRuntime.mark((function e(t){var r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:void 0,n=m.createNotification(t,r),this._logger.debug("notify() [method:%s]",t),e.next=5,this._transport.send(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_handleTransport",value:function(){var e=this;if(this._transport.closed)return this._closed=!0,void setTimeout((function(){e._closed||(e._connected=!1,e.safeEmit("close"))}));this._transport.on("open",(function(){e._closed||(y.debug('emit "open"'),e._connected=!0,e.safeEmit("open"))})),this._transport.on("disconnected",(function(){e._closed||(y.debug('emit "disconnected"'),e._connected=!1,e.safeEmit("disconnected"))})),this._transport.on("failed",(function(t){e._closed||(y.debug('emit "failed" [currentAttempt:%s]',t),e._connected=!1,e.safeEmit("failed",t))})),this._transport.on("close",(function(){e._closed||(e._closed=!0,y.debug('emit "close"'),e._connected=!1,e.safeEmit("close"))})),this._transport.on("message",(function(t){t.request?e._handleRequest(t):t.response?e._handleResponse(t):t.notification&&e._handleNotification(t)}))}},{key:"_handleRequest",value:function(e){var t=this;try{this.emit("request",e,(function(r){var n=m.createSuccessResponse(e,r);t._transport.send(n).catch((function(){}))}),(function(r,n){r instanceof Error?(r=500,n=String(r)):"number"==typeof r&&n instanceof Error&&(n=String(n));var i=m.createErrorResponse(e,r,n);t._transport.send(i).catch((function(){}))}))}catch(t){var r=m.createErrorResponse(e,500,String(t));this._transport.send(r).catch((function(){}))}}},{key:"_handleResponse",value:function(e){var t=this._sents.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{var r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}else y.error("received response does not match any sent request [id:%s]",e.id)}},{key:"_handleNotification",value:function(e){this.safeEmit("notification",e)}},{key:"closed",get:function(){return this._closed}},{key:"connected",get:function(){return this._connected}},{key:"data",get:function(){return this._data},set:function(e){throw new Error("cannot override data object")}}])&&c(t.prototype,r),n&&c(t,n),l}(h);e.exports=v},function(e,t,r){"use strict";(function(n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=r(69)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(9))},function(e,t,r){"use strict";function n(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}e.exports=function(e){function t(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return i.colors[Math.abs(t)%i.colors.length]}function i(e){var r;function n(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];if(n.enabled){var o=n,s=Number(new Date),c=s-(r||s);o.diff=c,o.prev=r,o.curr=s,r=s,t[0]=i.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var u=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,r){if("%%"===e)return e;u++;var n=i.formatters[r];if("function"==typeof n){var a=t[u];e=n.call(o,a),t.splice(u,1),u--}return e})),i.formatArgs.call(o,t);var d=o.log||i.log;d.apply(o,t)}}return n.namespace=e,n.enabled=i.enabled(e),n.useColors=i.useColors(),n.color=t(e),n.destroy=a,n.extend=o,"function"==typeof i.init&&i.init(n),i.instances.push(n),n}function a(){var e=i.instances.indexOf(this);return-1!==e&&(i.instances.splice(e,1),!0)}function o(e,t){var r=i(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return i.debug=i,i.default=i,i.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},i.disable=function(){var e=[].concat(n(i.names.map(s)),n(i.skips.map(s).map((function(e){return"-"+e})))).join(",");return i.enable(""),e},i.enable=function(e){var t;i.save(e),i.names=[],i.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?i.skips.push(new RegExp("^"+e.substr(1)+"$")):i.names.push(new RegExp("^"+e+"$")));for(t=0;t<i.instances.length;t++){var a=i.instances[t];a.enabled=i.enabled(a.namespace)}},i.enabled=function(e){if("*"===e[e.length-1])return!0;var t,r;for(t=0,r=i.skips.length;t<r;t++)if(i.skips[t].test(e))return!1;for(t=0,r=i.names.length;t<r;t++)if(i.names[t].test(e))return!0;return!1},i.humanize=r(70),Object.keys(e).forEach((function(t){i[t]=e[t]})),i.instances=[],i.names=[],i.skips=[],i.formatters={},i.selectColor=t,i.enable(i.load()),i}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=1e3,a=6e4,o=60*a,s=24*o;function c(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,t){t=t||{};var r=n(e);if("string"===r&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"hrs":case"hr":case"h":return r*o;case"minutes":case"minute":case"mins":case"min":case"m":return r*a;case"seconds":case"second":case"secs":case"sec":case"s":return r*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===r&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=s)return c(e,t,s,"day");if(t>=o)return c(e,t,o,"hour");if(t>=a)return c(e,t,a,"minute");if(t>=i)return c(e,t,i,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=s)return Math.round(e/s)+"d";if(t>=o)return Math.round(e/o)+"h";if(t>=a)return Math.round(e/a)+"m";if(t>=i)return Math.round(e/i)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){"use strict";t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=u(e);if(t){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c(this,r)}}function c(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=r(73).w3cwebsocket,p=r(77),l=r(12),f=r(24),h=r(25),m={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},y=new l("WebSocketTransport"),v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(f,e);var t,r,n,c,u,l=s(f);function f(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),r=l.call(this,y),y.debug("constructor() [url:%s, options:%o]",e,t),r._closed=!1,r._url=e,r._options=t||{},r._ws=null,r._runWebSocket(),r}return t=f,(r=[{key:"close",value:function(){if(!this._closed){y.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){y.error("close() | error closing the WebSocket: %o",e)}}}},{key:"send",value:(c=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=2;break}throw new Error("transport closed");case 2:e.prev=2,this._ws.send(JSON.stringify(t)),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(2),y.warn("send() failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[2,6]])})),u=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=c.apply(e,t);function o(e){i(a,r,n,o,s,"next",e)}function s(e){i(a,r,n,o,s,"throw",e)}o(void 0)}))},function(e){return u.apply(this,arguments)})},{key:"_runWebSocket",value:function(){var e=this,t=p.operation(this._options.retry||m),r=!1;t.attempt((function(n){e._closed?t.stop():(y.debug("_runWebSocket() [currentAttempt:%s]",n),e._ws=new d(e._url,"protoo",e._options.origin,e._options.headers,e._options.requestOptions,e._options.clientConfig),e._ws.onopen=function(){e._closed||(r=!0,e.safeEmit("open"))},e._ws.onclose=function(i){if(!e._closed){if(y.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',i.wasClean,i.code,i.reason),4e3!==i.code){if(r){if(t.stop(),e.safeEmit("disconnected"),e._closed)return;return void e._runWebSocket()}if(e.safeEmit("failed",n),e._closed)return;if(t.retry(!0))return}e._closed=!0,e.safeEmit("close")}},e._ws.onerror=function(){e._closed||y.error('WebSocket "error" event')},e._ws.onmessage=function(t){if(!e._closed){var r=h.parse(t.data);r&&(0!==e.listenerCount("message")?e.safeEmit("message",r):y.error('no listeners for WebSocket "message" event, ignoring received message'))}})}))}},{key:"closed",get:function(){return this._closed}}])&&a(t.prototype,r),n&&a(t,n),f}(f);e.exports=v},function(e,t,r){"use strict";var n;try{n=r(74)}catch(e){}finally{if(n||"undefined"==typeof window||(n=window),!n)throw new Error("Could not determine global this")}var i=n.WebSocket||n.MozWebSocket,a=r(75);function o(e,t){return t?new i(e,t):new i(e)}i&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(o,e,{get:function(){return i[e]}})})),e.exports={w3cwebsocket:i?o:null,version:a}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=function(){if("object"===("undefined"==typeof self?"undefined":n(self))&&self)return self;if("object"===("undefined"==typeof window?"undefined":n(window))&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"===("undefined"==typeof globalThis?"undefined":n(globalThis))&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return i()}try{return __global__||i()}finally{delete Object.prototype.__global__}}()},function(e,t,r){"use strict";e.exports=r(76).version},function(e){e.exports=JSON.parse('{"_args":[["websocket@1.0.31","/home/ubuntu/networked-aframe"]],"_from":"websocket@1.0.31","_id":"websocket@1.0.31","_inBundle":false,"_integrity":"sha512-VAouplvGKPiKFDTeCCO65vYHsyay8DqoBSlzIO3fayrfOgU94lQN5a1uWVnFrMLceTJw/+fQXR5PGbUVRaHshQ==","_location":"/websocket","_optional":true,"_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"websocket@1.0.31","name":"websocket","escapedName":"websocket","rawSpec":"1.0.31","saveSpec":null,"fetchSpec":"1.0.31"},"_requiredBy":["/protoo-client"],"_resolved":"https://registry.npmjs.org/websocket/-/websocket-1.0.31.tgz","_spec":"1.0.31","_where":"/home/ubuntu/networked-aframe","author":{"name":"Brian McKelvey","email":"theturtle32@gmail.com","url":"https://github.com/theturtle32"},"browser":"lib/browser.js","bugs":{"url":"https://github.com/theturtle32/WebSocket-Node/issues"},"config":{"verbose":false},"contributors":[{"name":"Iaki Baz Castillo","email":"ibc@aliax.net","url":"http://dev.sipdoc.net"}],"dependencies":{"debug":"^2.2.0","es5-ext":"^0.10.50","nan":"^2.14.0","typedarray-to-buffer":"^3.1.5","yaeti":"^0.0.6"},"description":"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.","devDependencies":{"buffer-equal":"^1.0.0","faucet":"^0.0.1","gulp":"^4.0.2","gulp-jshint":"^2.0.4","jshint":"^2.0.0","jshint-stylish":"^2.2.1","tape":"^4.9.1"},"directories":{"lib":"./lib"},"engines":{"node":">=0.10.0"},"homepage":"https://github.com/theturtle32/WebSocket-Node","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"license":"Apache-2.0","main":"index","name":"websocket","repository":{"type":"git","url":"git+https://github.com/theturtle32/WebSocket-Node.git"},"scripts":{"gulp":"gulp","install":"(node-gyp rebuild 2> builderror.log) || (exit 0)","test":"faucet test/unit"},"version":"1.0.31"}')},function(e,t,r){"use strict";e.exports=r(78)},function(e,t,r){"use strict";var n=r(79);t.operation=function(e){var r=t.timeouts(e);return new n(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<t.retries;i++)n.push(this.createTimeout(i,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(i,t)),n.sort((function(e,t){return e-t})),n},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return n=Math.min(n,t.maxTimeout)},t.wrap=function(e,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var i in n=[],e)"function"==typeof e[i]&&n.push(i);for(var a=0;a<n.length;a++){var o=n[a],s=e[o];e[o]=function(n){var i=t.operation(r),a=Array.prototype.slice.call(arguments,1),o=a.pop();a.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),o.apply(this,arguments))})),i.attempt((function(){n.apply(e,a)}))}.bind(e,s),e[o].options=r}}},function(e,t,r){"use strict";function n(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=n,n.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},n.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},n.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,i=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&i.unref(),!0},n.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},n.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},n.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},n.prototype.start=n.prototype.try,n.prototype.errors=function(){return this._errors},n.prototype.attempts=function(){return this._attempts},n.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],a=i.message,o=(e[a]||0)+1;e[a]=o,o>=r&&(t=i,r=o)}return t}},function(e,t,r){"use strict";(function(n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}(t=e.exports=r(81)).log=function(){return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),!r)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,a=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(a=i))})),e.splice(a,0,n)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=a,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(a())}).call(this,r(9))},function(e,t,r){"use strict";var n;function i(e){function r(){if(r.enabled){var e=r,i=+new Date,a=i-(n||i);e.diff=a,e.prev=n,e.curr=i,n=i;for(var o=new Array(arguments.length),s=0;s<o.length;s++)o[s]=arguments[s];o[0]=t.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var c=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(r,n){if("%%"===r)return r;c++;var i=t.formatters[n];if("function"==typeof i){var a=o[c];r=i.call(e,a),o.splice(c,1),c--}return r})),t.formatArgs.call(e,o);var u=r.log||t.log||console.log.bind(console);u.apply(e,o)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var r,n=0;for(r in e)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]}(e),"function"==typeof t.init&&t.init(r),r}(t=e.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length,i=0;i<n;i++)r[i]&&("-"===(e=r[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(82),t.names=[],t.skips=[],t.formatters={}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=1e3,a=6e4,o=60*a,s=24*o;function c(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}e.exports=function(e,t){t=t||{};var r,u=n(e);if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"days":case"day":case"d":return r*s;case"hours":case"hour":case"hrs":case"hr":case"h":return r*o;case"minutes":case"minute":case"mins":case"min":case"m":return r*a;case"seconds":case"second":case"secs":case"sec":case"s":return r*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===u&&!1===isNaN(e))return t.long?c(r=e,s,"day")||c(r,o,"hour")||c(r,a,"minute")||c(r,i,"second")||r+" ms":function(e){if(e>=s)return Math.round(e/s)+"d";if(e>=o)return Math.round(e/o)+"h";if(e>=a)return Math.round(e/a)+"m";if(e>=i)return Math.round(e/i)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jsonSchema=t.fromString=t.empty=t.isUuid=t.regex=t.uuid=void 0;var n=r(84);t.uuid=function(){return n.v4()};var i={v4:/(?:^[0-9a-f]{8}\x2D[0-9a-f]{4}\x2D4[0-9a-f]{3}\x2D[0-9a-f]{4}\x2D[0-9a-f]{12}$)|(?:^0{8}\x2D0{4}\x2D0{4}\x2D0{4}\x2D0{12}$)/,v5:/(?:^[0-9a-f]{8}\x2D[0-9a-f]{4}\x2D5[0-9a-f]{3}\x2D[0-9a-f]{4}\x2D[0-9a-f]{12}$)|(?:^0{8}\x2D0{4}\x2D0{4}\x2D0{4}\x2D0{12}$)/};t.regex=i;var a={v4:{type:"string",pattern:i.v4.toString().slice(1,-1)},v5:{type:"string",pattern:i.v5.toString().slice(1,-1)}};t.jsonSchema=a;t.isUuid=function(e){return i.v4.test(e)||i.v5.test(e)};t.empty=function(){return"00000000-0000-0000-0000-000000000000"};t.fromString=function(e){return n.v5(e,"bb5d0ffa-9a4c-4d7c-8fc2-0a7d2220ba45")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return o.default}});var n=s(r(85)),i=s(r(86)),a=s(r(88)),o=s(r(89));function s(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i,a=s(r(26)),o=s(r(14));function s(e){return e&&e.__esModule?e:{default:e}}var c=0,u=0;var d=function(e,t,r){var s=t&&r||0,d=t||[],p=(e=e||{}).node||n,l=void 0!==e.clockseq?e.clockseq:i;if(null==p||null==l){var f=e.random||(e.rng||a.default)();null==p&&(p=n=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==l&&(l=i=16383&(f[6]<<8|f[7]))}var h=void 0!==e.msecs?e.msecs:Date.now(),m=void 0!==e.nsecs?e.nsecs:u+1,y=h-c+(m-u)/1e4;if(y<0&&void 0===e.clockseq&&(l=l+1&16383),(y<0||h>c)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=h,u=m,i=l;var v=(1e4*(268435455&(h+=122192928e5))+m)%4294967296;d[s++]=v>>>24&255,d[s++]=v>>>16&255,d[s++]=v>>>8&255,d[s++]=255&v;var g=h/4294967296*1e4&268435455;d[s++]=g>>>8&255,d[s++]=255&g,d[s++]=g>>>24&15|16,d[s++]=g>>>16&255,d[s++]=l>>>8|128,d[s++]=255&l;for(var b=0;b<6;++b)d[s+b]=p[b];return t||(0,o.default)(d)};t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(27)),i=a(r(87));function a(e){return e&&e.__esModule?e:{default:e}}var o=(0,n.default)("v3",48,i.default);t.default=o},function(e,t,r){"use strict";function n(e){return 14+(e+64>>>9<<4)+1}function i(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function a(e,t,r,n,a,o){return i((s=i(i(t,e),i(n,o)))<<(c=a)|s>>>32-c,r);var s,c}function o(e,t,r,n,i,o,s){return a(t&r|~t&n,e,t,i,o,s)}function s(e,t,r,n,i,o,s){return a(t&n|r&~n,e,t,i,o,s)}function c(e,t,r,n,i,o,s){return a(t^r^n,e,t,i,o,s)}function u(e,t,r,n,i,o,s){return a(r^(t|~n),e,t,i,o,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,n=0;n<r;n+=8){var i=e[n>>5]>>>n%32&255,a=parseInt("0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i),16);t.push(a)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[n(t)-1]=t;for(var r=1732584193,a=-271733879,d=-1732584194,p=271733878,l=0;l<e.length;l+=16){var f=r,h=a,m=d,y=p;r=o(r,a,d,p,e[l],7,-680876936),p=o(p,r,a,d,e[l+1],12,-389564586),d=o(d,p,r,a,e[l+2],17,606105819),a=o(a,d,p,r,e[l+3],22,-1044525330),r=o(r,a,d,p,e[l+4],7,-176418897),p=o(p,r,a,d,e[l+5],12,1200080426),d=o(d,p,r,a,e[l+6],17,-1473231341),a=o(a,d,p,r,e[l+7],22,-45705983),r=o(r,a,d,p,e[l+8],7,1770035416),p=o(p,r,a,d,e[l+9],12,-1958414417),d=o(d,p,r,a,e[l+10],17,-42063),a=o(a,d,p,r,e[l+11],22,-1990404162),r=o(r,a,d,p,e[l+12],7,1804603682),p=o(p,r,a,d,e[l+13],12,-40341101),d=o(d,p,r,a,e[l+14],17,-1502002290),a=o(a,d,p,r,e[l+15],22,1236535329),r=s(r,a,d,p,e[l+1],5,-165796510),p=s(p,r,a,d,e[l+6],9,-1069501632),d=s(d,p,r,a,e[l+11],14,643717713),a=s(a,d,p,r,e[l],20,-373897302),r=s(r,a,d,p,e[l+5],5,-701558691),p=s(p,r,a,d,e[l+10],9,38016083),d=s(d,p,r,a,e[l+15],14,-660478335),a=s(a,d,p,r,e[l+4],20,-405537848),r=s(r,a,d,p,e[l+9],5,568446438),p=s(p,r,a,d,e[l+14],9,-1019803690),d=s(d,p,r,a,e[l+3],14,-187363961),a=s(a,d,p,r,e[l+8],20,1163531501),r=s(r,a,d,p,e[l+13],5,-1444681467),p=s(p,r,a,d,e[l+2],9,-51403784),d=s(d,p,r,a,e[l+7],14,1735328473),a=s(a,d,p,r,e[l+12],20,-1926607734),r=c(r,a,d,p,e[l+5],4,-378558),p=c(p,r,a,d,e[l+8],11,-2022574463),d=c(d,p,r,a,e[l+11],16,1839030562),a=c(a,d,p,r,e[l+14],23,-35309556),r=c(r,a,d,p,e[l+1],4,-1530992060),p=c(p,r,a,d,e[l+4],11,1272893353),d=c(d,p,r,a,e[l+7],16,-155497632),a=c(a,d,p,r,e[l+10],23,-1094730640),r=c(r,a,d,p,e[l+13],4,681279174),p=c(p,r,a,d,e[l],11,-358537222),d=c(d,p,r,a,e[l+3],16,-722521979),a=c(a,d,p,r,e[l+6],23,76029189),r=c(r,a,d,p,e[l+9],4,-640364487),p=c(p,r,a,d,e[l+12],11,-421815835),d=c(d,p,r,a,e[l+15],16,530742520),a=c(a,d,p,r,e[l+2],23,-995338651),r=u(r,a,d,p,e[l],6,-198630844),p=u(p,r,a,d,e[l+7],10,1126891415),d=u(d,p,r,a,e[l+14],15,-1416354905),a=u(a,d,p,r,e[l+5],21,-57434055),r=u(r,a,d,p,e[l+12],6,1700485571),p=u(p,r,a,d,e[l+3],10,-1894986606),d=u(d,p,r,a,e[l+10],15,-1051523),a=u(a,d,p,r,e[l+1],21,-2054922799),r=u(r,a,d,p,e[l+8],6,1873313359),p=u(p,r,a,d,e[l+15],10,-30611744),d=u(d,p,r,a,e[l+6],15,-1560198380),a=u(a,d,p,r,e[l+13],21,1309151649),r=u(r,a,d,p,e[l+4],6,-145523070),p=u(p,r,a,d,e[l+11],10,-1120210379),d=u(d,p,r,a,e[l+2],15,718787259),a=u(a,d,p,r,e[l+9],21,-343485551),r=i(r,f),a=i(a,h),d=i(d,m),p=i(p,y)}return[r,a,d,p]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(n(t)),i=0;i<t;i+=8)r[i>>5]|=(255&e[i/8])<<i%32;return r}(e),8*e.length))};t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(26)),i=a(r(14));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(e,t,r){"string"==typeof e&&(t="binary"===e?new Uint8Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||n.default)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){for(var o=r||0,s=0;s<16;++s)t[o+s]=a[s];return t}return(0,i.default)(a)};t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r(27)),i=a(r(90));function a(e){return e&&e.__esModule?e:{default:e}}var o=(0,n.default)("v5",80,i.default);t.default=o},function(e,t,r){"use strict";function n(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:return t^r^n;case 2:return t&r^t&n^r&n;case 3:return t^r^n}}function i(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var a=unescape(encodeURIComponent(e));e=[];for(var o=0;o<a.length;++o)e.push(a.charCodeAt(o))}e.push(128);for(var s=e.length/4+2,c=Math.ceil(s/16),u=new Array(c),d=0;d<c;++d){for(var p=new Uint32Array(16),l=0;l<16;++l)p[l]=e[64*d+4*l]<<24|e[64*d+4*l+1]<<16|e[64*d+4*l+2]<<8|e[64*d+4*l+3];u[d]=p}u[c-1][14]=8*(e.length-1)/Math.pow(2,32),u[c-1][14]=Math.floor(u[c-1][14]),u[c-1][15]=8*(e.length-1)&4294967295;for(var f=0;f<c;++f){for(var h=new Uint32Array(80),m=0;m<16;++m)h[m]=u[f][m];for(var y=16;y<80;++y)h[y]=i(h[y-3]^h[y-8]^h[y-14]^h[y-16],1);for(var v=r[0],g=r[1],b=r[2],w=r[3],_=r[4],S=0;S<80;++S){var k=Math.floor(S/20),R=i(v,5)+n(k,g,b,w)+_+t[k]+h[S]>>>0;_=w,w=b,b=i(g,30)>>>0,g=v,v=R}r[0]=r[0]+v>>>0,r[1]=r[1]+g>>>0,r[2]=r[2]+b>>>0,r[3]=r[3]+w>>>0,r[4]=r[4]+_>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]};t.default=a},function(e,t,r){"use strict";AFRAME.registerComponent("networked-scene",{schema:{serverURL:{default:"/"},app:{default:"default"},room:{default:"default"},connectOnLoad:{default:!0},onConnect:{default:"onConnect"},adapter:{default:"socketio"},audio:{default:!1},debug:{default:!1}},init:function(){var e=this.el;this.connect=this.connect.bind(this),e.addEventListener("connect",this.connect),this.data.connectOnLoad&&e.emit("connect",null,!1)},connect:function(){return NAF.log.setDebug(this.data.debug),NAF.log.write("Networked-Aframe Connecting..."),this.checkDeprecatedProperties(),this.setupNetworkAdapter(),this.hasOnConnectFunction()&&this.callOnConnect(),NAF.connection.connect(this.data.serverURL,this.data.app,this.data.room,this.data.audio)},checkDeprecatedProperties:function(){},setupNetworkAdapter:function(){var e=this.data.adapter,t=NAF.adapters.make(e);NAF.connection.setNetworkAdapter(t),this.el.emit("adapter-ready",t,!1)},hasOnConnectFunction:function(){return""!=this.data.onConnect&&window[this.data.onConnect]},callOnConnect:function(){NAF.connection.onConnect(window[this.data.onConnect])},remove:function(){NAF.log.write("networked-scene disconnected"),this.el.removeEventListener("connect",this.connect),NAF.connection.disconnect()}})},function(e,t,r){"use strict";var n=r(93),i=r(94),a=THREE.Math.DEG2RAD,o=["position","rotation","scale"];AFRAME.registerSystem("networked",{init:function(){this.components=[],this.nextSyncTime=0},register:function(e){this.components.push(e)},deregister:function(e){var t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)},tick:function(){if(NAF.connection.adapter&&!(this.el.clock.elapsedTime<this.nextSyncTime)){for(var e={d:[]},t=0,r=this.components.length;t<r;t++){var n=this.components[t];if(n.isMine()){if(!n.el.parentElement)return void NAF.log.error("entity registered with system despite being removed");var i=this.components[t].syncDirty();i&&e.d.push(i)}}e.d.length>0&&NAF.connection.broadcastData("um",e),this.updateNextSyncTime()}},updateNextSyncTime:function(){this.nextSyncTime=this.el.clock.elapsedTime+1/NAF.options.updateRate}}),AFRAME.registerComponent("networked",{schema:{template:{default:""},attachTemplateToLocal:{default:!0},persistent:{default:!1},networkId:{default:""},owner:{default:""},creator:{default:""}},init:function(){this.OWNERSHIP_GAINED="ownership-gained",this.OWNERSHIP_CHANGED="ownership-changed",this.OWNERSHIP_LOST="ownership-lost",this.onOwnershipGainedEvent={el:this.el},this.onOwnershipChangedEvent={el:this.el},this.onOwnershipLostEvent={el:this.el},this.conversionEuler=new THREE.Euler,this.conversionEuler.order="YXZ",this.bufferInfos=[],this.bufferPosition=new THREE.Vector3,this.bufferQuaternion=new THREE.Quaternion,this.bufferScale=new THREE.Vector3;var e=this.wasCreatedByNetwork();this.onConnected=this.onConnected.bind(this),this.syncData={},this.componentSchemas=NAF.schemas.getComponents(this.data.template),this.cachedElements=new Array(this.componentSchemas.length),this.networkUpdatePredicates=this.componentSchemas.map((function(e){return e.requiresNetworkUpdate&&e.requiresNetworkUpdate()||(t=null,function(e){return!(null!==t&&n(t,e)||(t=AFRAME.utils.clone(e),0))});var t})),this.invalidateCachedElements(),this.initNetworkParent(),""===this.data.networkId&&this.el.setAttribute(this.name,{networkId:NAF.utils.createNetworkId()}),e?this.firstUpdate():(this.data.attachTemplateToLocal&&this.attachTemplateToLocal(),this.registerEntity(this.data.networkId)),this.lastOwnerTime=-1,NAF.clientId?this.onConnected():document.body.addEventListener("connected",this.onConnected,!1),document.body.dispatchEvent(this.entityCreatedEvent()),this.el.dispatchEvent(new CustomEvent("instantiated",{detail:{el:this.el}})),this.el.sceneEl.systems.networked.register(this)},attachTemplateToLocal:function(){for(var e=NAF.schemas.getCachedTemplate(this.data.template),t=e.attributes,r=0;r<t.length;r++)this.el.setAttribute(t[r].name,t[r].value);for(;e.firstElementChild;)this.el.appendChild(e.firstElementChild)},takeOwnership:function(){var e=this.data.owner,t=this.lastOwnerTime,r=NAF.connection.getServerTime();return!!(e&&!this.isMine()&&t<r)&&(this.lastOwnerTime=r,this.removeLerp(),this.el.setAttribute("networked",{owner:NAF.clientId}),this.syncAll(),this.onOwnershipGainedEvent.oldOwner=e,this.el.emit(this.OWNERSHIP_GAINED,this.onOwnershipGainedEvent),this.onOwnershipChangedEvent.oldOwner=e,this.onOwnershipChangedEvent.newOwner=NAF.clientId,this.el.emit(this.OWNERSHIP_CHANGED,this.onOwnershipChangedEvent),!0)},wasCreatedByNetwork:function(){return!!this.el.firstUpdateData},initNetworkParent:function(){var e=this.el.parentElement;e.components&&e.components.networked?this.parent=e:this.parent=null},registerEntity:function(e){NAF.entities.registerEntity(e,this.el)},applyPersistentFirstSync:function(){var e=this.data.networkId,t=NAF.entities.getPersistentFirstSync(e);t&&(this.networkUpdate(t),NAF.entities.forgetPersistentFirstSync(e))},firstUpdate:function(){var e=this.el.firstUpdateData;this.networkUpdate(e)},onConnected:function(){var e=this;""===this.data.owner&&(this.lastOwnerTime=NAF.connection.getServerTime(),this.el.setAttribute(this.name,{owner:NAF.clientId,creator:NAF.clientId}),setTimeout((function(){e.el.parentNode?e.syncAll(void 0,!0):NAF.log.warn("Networked element was removed before ever getting the chance to syncAll")}),0)),document.body.removeEventListener("connected",this.onConnected,!1)},isMine:function(){return this.data.owner===NAF.clientId},createdByMe:function(){return this.data.creator===NAF.clientId},tick:function(e,t){if(!this.isMine()&&NAF.options.useLerp)for(var r=0;r<this.bufferInfos.length;r++){var n=this.bufferInfos[r],i=n.buffer,a=n.object3D,o=n.componentNames;i.update(t),o.includes("position")&&a.position.copy(i.getPosition()),o.includes("rotation")&&a.quaternion.copy(i.getQuaternion()),o.includes("scale")&&a.scale.copy(i.getScale())}},syncAll:function(e,t){if(this.canSync()){var r=this.gatherComponentsData(!0),n=this.createSyncData(r,t);e?NAF.connection.sendDataGuaranteed(e,"u",n):NAF.connection.broadcastDataGuaranteed("u",n)}},syncDirty:function(){if(this.canSync()){var e=this.gatherComponentsData(!1);if(null!==e)return this.createSyncData(e)}},getCachedElement:function(e){var t=this.cachedElements[e];if(t)return t;var r=this.componentSchemas[e];return r.selector?this.cachedElements[e]=this.el.querySelector(r.selector):this.cachedElements[e]=this.el},invalidateCachedElements:function(){for(var e=0;e<this.cachedElements.length;e++)this.cachedElements[e]=null},gatherComponentsData:function(e){for(var t=null,r=0;r<this.componentSchemas.length;r++){var n=this.componentSchemas[r],i=this.getCachedElement(r);if(i){var a=n.component?n.component:n,o=i.getAttribute(a);if(null!==o){var s=n.property?o[n.property]:o;(this.networkUpdatePredicates[r](s)||e)&&((t=t||{})[r]=s)}else e&&((t=t||{})[r]=null)}else e&&((t=t||{})[r]=null)}return t},createSyncData:function(e,t){var r=this.syncData,n=this.data;return r.networkId=n.networkId,r.owner=n.owner,r.creator=n.creator,r.lastOwnerTime=this.lastOwnerTime,r.template=n.template,r.persistent=n.persistent,r.parent=this.getParentId(),r.components=e,r.isFirstSync=!!t,r},canSync:function(){if(this.data.owner&&this.isMine())return!0;if(!this.createdByMe())return!1;var e=NAF.connection.getConnectedClients();for(var t in e)if(t===this.data.owner)return!1;return!0},getParentId:function(){return this.initNetworkParent(),this.parent?this.parent.getAttribute("networked").networkId:null},networkUpdate:function(e){if(!(e.lastOwnerTime<this.lastOwnerTime||this.lastOwnerTime===e.lastOwnerTime&&this.data.owner>e.owner)&&void 0!==this.data){if(this.data.owner!==e.owner){var t=this.isMine();this.lastOwnerTime=e.lastOwnerTime;var r=this.data.owner,n=e.owner;this.el.setAttribute("networked",{owner:e.owner}),t&&(this.onOwnershipLostEvent.newOwner=n,this.el.emit(this.OWNERSHIP_LOST,this.onOwnershipLostEvent)),this.onOwnershipChangedEvent.oldOwner=r,this.onOwnershipChangedEvent.newOwner=n,this.el.emit(this.OWNERSHIP_CHANGED,this.onOwnershipChangedEvent)}this.data.persistent!==e.persistent&&this.el.setAttribute("networked",{persistent:e.persistent}),this.updateNetworkedComponents(e.components)}},updateNetworkedComponents:function(e){for(var t=0,r=this.componentSchemas.length;t<r;t++){var n=e[t],i=this.componentSchemas[t],a=this.getCachedElement(t);null!==a&&null!=n&&(i.component?i.property?this.updateNetworkedComponent(a,i.component,i.property,n):this.updateNetworkedComponent(a,i.component,n):this.updateNetworkedComponent(a,i,n))}},updateNetworkedComponent:function(e,t,r,n){if(NAF.options.useLerp&&o.includes(t)){for(var s,c=0,u=this.bufferInfos.length;c<u;c++){var d=this.bufferInfos[c];if(d.object3D===e.object3D){s=d;break}}if(s){var p=s.componentNames;p.includes(t)||p.push(t)}else s={buffer:new i(i.MODE_LERP,.1),object3D:e.object3D,componentNames:[t]},this.bufferInfos.push(s);var l=s.buffer;switch(t){case"position":return void l.setPosition(this.bufferPosition.set(r.x,r.y,r.z));case"rotation":return this.conversionEuler.set(a*r.x,a*r.y,a*r.z),void l.setQuaternion(this.bufferQuaternion.setFromEuler(this.conversionEuler));case"scale":return void l.setScale(this.bufferScale.set(r.x,r.y,r.z))}NAF.log.error("Could not set value in interpolation buffer.",e,t,r,s)}else void 0===n?e.setAttribute(t,r):e.setAttribute(t,r,n)},removeLerp:function(){this.bufferInfos=[]},remove:function(){if(this.isMine()&&NAF.connection.isConnected()){var e={networkId:this.data.networkId};NAF.entities.hasEntity(this.data.networkId)?NAF.connection.broadcastDataGuaranteed("r",e):NAF.log.error("Removing networked entity that is not in entities array.")}NAF.entities.forgetEntity(this.data.networkId),document.body.dispatchEvent(this.entityRemovedEvent(this.data.networkId)),this.el.sceneEl.systems.networked.deregister(this)},entityCreatedEvent:function(){return new CustomEvent("entityCreated",{detail:{el:this.el}})},entityRemovedEvent:function(e){return new CustomEvent("entityRemoved",{detail:{networkId:e}})}})},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=Array.isArray,a=Object.keys,o=Object.prototype.hasOwnProperty;e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==n(t)&&"object"==n(r)){var s,c,u,d=i(t),p=i(r);if(d&&p){if((c=t.length)!=r.length)return!1;for(s=c;0!=s--;)if(!e(t[s],r[s]))return!1;return!0}if(d!=p)return!1;var l=t instanceof Date,f=r instanceof Date;if(l!=f)return!1;if(l&&f)return t.getTime()==r.getTime();var h=t instanceof RegExp,m=r instanceof RegExp;if(h!=m)return!1;if(h&&m)return t.toString()==r.toString();var y=a(t);if((c=y.length)!==a(r).length)return!1;for(s=c;0!=s--;)if(!o.call(r,y[s]))return!1;for(s=c;0!=s--;)if(!e(t[u=y[s]],r[u]))return!1;return!0}return t!=t&&r!=r}},function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=[],o=function(){var e=a.pop();return e||(e={position:new THREE.Vector3,velocity:new THREE.Vector3,scale:new THREE.Vector3,quaternion:new THREE.Quaternion,time:0}),e},s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;i(this,e),this.state=0,this.buffer=[],this.bufferTime=1e3*r,this.time=0,this.mode=t,this.originFrame=o(),this.position=new THREE.Vector3,this.quaternion=new THREE.Quaternion,this.scale=new THREE.Vector3(1,1,1)}return n(e,[{key:"hermite",value:function(e,t,r,n,i,a){var o=t*t,s=t*t*t,c=2*s-3*o+1,u=-2*s+3*o,d=s-2*o+t,p=s-o;e.copy(r.multiplyScalar(c)),e.add(n.multiplyScalar(u)),e.add(i.multiplyScalar(d)),e.add(a.multiplyScalar(p))}},{key:"lerp",value:function(e,t,r,n){e.lerpVectors(t,r,n)}},{key:"slerp",value:function(e,t,r,n){THREE.Quaternion.slerp(t,r,e,n)}},{key:"updateOriginFrameToBufferTail",value:function(){var e;e=this.originFrame,a.push(e),this.originFrame=this.buffer.shift()}},{key:"appendBuffer",value:function(e,t,r,n){var i=this.buffer.length>0?this.buffer[this.buffer.length-1]:null;if(i&&i.time===this.time)e&&i.position.copy(e),t&&i.velocity.copy(t),r&&i.quaternion.copy(r),n&&i.scale.copy(n);else{var a=i||this.originFrame,s=o();s.position.copy(e||a.position),s.velocity.copy(t||a.velocity),s.quaternion.copy(r||a.quaternion),s.scale.copy(n||a.scale),s.time=this.time,this.buffer.push(s)}}},{key:"setTarget",value:function(e,t,r,n){this.appendBuffer(e,t,r,n)}},{key:"setPosition",value:function(e,t){this.appendBuffer(e,t,null,null)}},{key:"setQuaternion",value:function(e){this.appendBuffer(null,null,e,null)}},{key:"setScale",value:function(e){this.appendBuffer(null,null,null,e)}},{key:"update",value:function(e){if(0===this.state&&this.buffer.length>0&&(this.updateOriginFrameToBufferTail(),this.position.copy(this.originFrame.position),this.quaternion.copy(this.originFrame.quaternion),this.scale.copy(this.originFrame.scale),this.state=1),1===this.state&&this.buffer.length>0&&this.time>this.bufferTime&&(this.state=2),2===this.state){for(var t=this.time-this.bufferTime;this.buffer.length>0&&t>this.buffer[0].time;)this.buffer.length>1?this.updateOriginFrameToBufferTail():(this.originFrame.position.copy(this.buffer[0].position),this.originFrame.velocity.copy(this.buffer[0].velocity),this.originFrame.quaternion.copy(this.buffer[0].quaternion),this.originFrame.scale.copy(this.buffer[0].scale),this.originFrame.time=this.buffer[0].time,this.buffer[0].time=this.time+e);if(this.buffer.length>0&&this.buffer[0].time>0){var r=this.buffer[0],n=r.time-this.originFrame.time,i=(t-this.originFrame.time)/n;0===this.mode?this.lerp(this.position,this.originFrame.position,r.position,i):1===this.mode&&this.hermite(this.position,i,this.originFrame.position,r.position,this.originFrame.velocity.multiplyScalar(n),r.velocity.multiplyScalar(n)),this.slerp(this.quaternion,this.originFrame.quaternion,r.quaternion,i),this.lerp(this.scale,this.originFrame.scale,r.scale,i)}}0!==this.state&&(this.time+=e)}},{key:"getPosition",value:function(){return this.position}},{key:"getQuaternion",value:function(){return this.quaternion}},{key:"getScale",value:function(){return this.scale}}]),e}();e.exports=s},function(e,t,r){"use strict";var n=r(15);AFRAME.registerComponent("networked-audio-source",{schema:{positional:{default:!0},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},maxDistance:{default:1e4},refDistance:{default:1},rolloffFactor:{default:1}},init:function(){var e=this;this.listener=null,this.stream=null,this._setMediaStream=this._setMediaStream.bind(this),NAF.utils.getNetworkedEntity(this.el).then((function(t){var r=t.components.networked.data.owner;r&&NAF.connection.adapter.getMediaStream(r).then(e._setMediaStream).catch((function(e){return n.log.error("Error getting media stream for ".concat(r),e)}))}))},update:function(){this._setPannerProperties()},_setMediaStream:function(e){if(this.sound||this.setupSound(),e!=this.stream){if(this.stream&&this.sound.disconnect(),e){/chrome/i.test(navigator.userAgent)&&(this.audioEl=new Audio,this.audioEl.setAttribute("autoplay","autoplay"),this.audioEl.setAttribute("playsinline","playsinline"),this.audioEl.srcObject=e,this.audioEl.volume=0);var t=this.sound.context.createMediaStreamSource(e);this.sound.setNodeSource(t),this.el.emit("sound-source-set",{soundSource:t})}this.stream=e}},_setPannerProperties:function(){this.sound&&this.data.positional&&(this.sound.setDistanceModel(this.data.distanceModel),this.sound.setMaxDistance(this.data.maxDistance),this.sound.setRefDistance(this.data.refDistance),this.sound.setRolloffFactor(this.data.rolloffFactor))},remove:function(){this.sound&&(this.el.removeObject3D(this.attrName),this.stream&&this.sound.disconnect())},setupSound:function(){var e=this.el,t=e.sceneEl;this.sound&&e.removeObject3D(this.attrName),t.audioListener||(t.audioListener=new THREE.AudioListener,t.camera&&t.camera.add(t.audioListener),t.addEventListener("camera-set-active",(function(e){e.detail.cameraEl.getObject3D("camera").add(t.audioListener)}))),this.listener=t.audioListener,this.sound=this.data.positional?new THREE.PositionalAudio(this.listener):new THREE.Audio(this.listener),e.setObject3D(this.attrName,this.sound),this._setPannerProperties()}})}]);
=======
!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";var i=n(2),o=n(3),s=n(4),r=n(5),a=n(6),c=n(8),u=n(9),l={app:"",room:"",clientId:""};l.options=i,l.utils=o,l.log=new s,l.schemas=new r,l.version="0.7.1",l.adapters=new u;var h=new a,d=new c(h);l.connection=d,l.entities=h,e.exports=window.NAF=l},function(e,t,n){"use strict";n(0),n(12),n(13),n(16)},function(e,t,n){"use strict";e.exports={debug:!1,updateRate:15,useLerp:!0,firstSyncSource:null,syncSource:null}},function(e,t,n){"use strict";e.exports.whenEntityLoaded=function(e,t){e.hasLoaded&&t(),e.addEventListener("loaded",(function(){t()}))},e.exports.createHtmlNodeFromString=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild},e.exports.getCreator=function(e){var t=e.components;return t.networked?t.networked.data.creator:null},e.exports.getNetworkOwner=function(e){var t=e.components;return t.networked?t.networked.data.owner:null},e.exports.getNetworkId=function(e){var t=e.components;return t.networked?t.networked.data.networkId:null},e.exports.now=function(){return Date.now()},e.exports.createNetworkId=function(){return Math.random().toString(36).substring(2,9)},e.exports.getNetworkedEntity=function(e){return new Promise((function(t,n){for(var i=e;i&&i.components&&!i.components.networked;)i=i.parentNode;if(!i||!i.components||!i.components.networked)return n("Entity does not have and is not a child of an entity with the [networked] component ");i.hasLoaded?t(i):i.addEventListener("instantiated",(function(){t(i)}),{once:!0})}))},e.exports.takeOwnership=function(e){for(var t=e;t&&t.components&&!t.components.networked;)t=t.parentNode;if(!t||!t.components||!t.components.networked)throw new Error("Entity does not have and is not a child of an entity with the [networked] component ");return t.components.networked.takeOwnership()},e.exports.isMine=function(e){for(var t=e;t&&t.components&&!t.components.networked;)t=t.parentNode;if(!t||!t.components||!t.components.networked)throw new Error("Entity does not have and is not a child of an entity with the [networked] component ");return t.components.networked.data.owner===NAF.clientId},e.exports.almostEqualVec3=function(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n&&Math.abs(e.z-t.z)<n}},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.debug=!1}var t,n,o;return t=e,(n=[{key:"setDebug",value:function(e){this.debug=e}},{key:"write",value:function(){this.debug&&console.log.apply(this,arguments)}},{key:"warn",value:function(){console.warn.apply(this,arguments)}},{key:"error",value:function(){console.error.apply(this,arguments)}}])&&i(t.prototype,n),o&&i(t,o),e}();e.exports=o},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemaDict={},this.templateCache={}}var t,n,o;return t=e,(n=[{key:"createDefaultSchema",value:function(e){return{template:e,components:["position","rotation"]}}},{key:"add",value:function(e){if(this.validateSchema(e)){this.schemaDict[e.template]=e;var t=document.querySelector(e.template);if(!t)return void NAF.log.error("Template el not found for ".concat(e.template,", make sure NAF.schemas.add is called after <a-scene> is defined."));if(!this.validateTemplate(e,t))return;this.templateCache[e.template]=document.importNode(t.content,!0)}else NAF.log.error("Schema not valid: ",e),NAF.log.error("See https://github.com/haydenjameslee/networked-aframe#syncing-custom-components")}},{key:"getCachedTemplate",value:function(e){return this.templateIsCached(e)||(this.templateExistsInScene(e)?this.add(this.createDefaultSchema(e)):NAF.log.error("Template el for ".concat(e," is not in the scene, add the template to <a-assets> and register with NAF.schemas.add."))),this.templateCache[e].firstElementChild.cloneNode(!0)}},{key:"templateIsCached",value:function(e){return!!this.templateCache[e]}},{key:"getComponents",value:function(e){var t=["position","rotation"];return this.hasTemplate(e)&&(t=this.schemaDict[e].components),t}},{key:"hasTemplate",value:function(e){return!!this.schemaDict[e]}},{key:"templateExistsInScene",value:function(e){var t=document.querySelector(e);return t&&this.isTemplateTag(t)}},{key:"validateSchema",value:function(e){return!(!e.template||!e.components)}},{key:"validateTemplate",value:function(e,t){return this.isTemplateTag(t)?!!this.templateHasOneOrZeroChildren(t)||(NAF.log.error("Template for ".concat(e.template," has more than one child. Templates must have one direct child element, no more. Template found:"),t),!1):(NAF.log.error("Template for ".concat(e.template," is not a <template> tag. Instead found: ").concat(t.tagName)),!1)}},{key:"isTemplateTag",value:function(e){return"template"===e.tagName.toLowerCase()}},{key:"templateHasOneOrZeroChildren",value:function(e){return e.content.childElementCount<2}},{key:"remove",value:function(e){delete this.schemaDict[e]}},{key:"clear",value:function(){this.schemaDict={}}}])&&i(t.prototype,n),o&&i(t,o),e}();e.exports=o},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=n(7),s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.entities={},this.childCache=new o,this.onRemoteEntityCreatedEvent=new Event("remoteEntityCreated"),this._persistentFirstSyncs={}}var t,n,s;return t=e,(n=[{key:"registerEntity",value:function(e,t){this.entities[e]=t}},{key:"createRemoteEntity",value:function(e){NAF.log.write("Creating remote entity",e);var t=e.networkId,n=NAF.schemas.getCachedTemplate(e.template);return n.setAttribute("id","naf-"+t),this.initPosition(n,e.components),this.initRotation(n,e.components),this.addNetworkComponent(n,e),this.registerEntity(t,n),n}},{key:"initPosition",value:function(e,t){if(t.position){var n=t.position;e.setAttribute("position",n)}}},{key:"initRotation",value:function(e,t){if(t.rotation){var n=t.rotation;e.setAttribute("rotation",n)}}},{key:"addNetworkComponent",value:function(e,t){var n={template:t.template,creator:t.creator,owner:t.owner,networkId:t.networkId,persistent:t.persistent};e.setAttribute("networked",n),e.firstUpdateData=t}},{key:"updateEntityMulti",value:function(e,t,n,i){if(!NAF.options.syncSource||i===NAF.options.syncSource)for(var o=0,s=n.d.length;o<s;o++)this.updateEntity(e,"u",n.d[o],i)}},{key:"updateEntity",value:function(e,t,n,i){if(!NAF.options.syncSource||i===NAF.options.syncSource){var o=n.networkId;this.hasEntity(o)?this.entities[o].components.networked.networkUpdate(n):n.isFirstSync&&(NAF.options.firstSyncSource&&i!==NAF.options.firstSyncSource?NAF.log.write("Ignoring first sync from disallowed source",i):n.persistent?this._persistentFirstSyncs[o]=n:this.receiveFirstUpdateFromEntity(n))}}},{key:"receiveFirstUpdateFromEntity",value:function(e){var t=e.parent,n=e.networkId;if(t&&!this.hasEntity(t))this.childCache.addChild(t,e);else{var i=this.createRemoteEntity(e);this.createAndAppendChildren(n,i),this.addEntityToPage(i,t)}}},{key:"createAndAppendChildren",value:function(e,t){for(var n=this.childCache.getChildren(e),i=0;i<n.length;i++){var o=n[i],s=o.networkId;if(this.hasEntity(s))NAF.log.warn("Tried to instantiate entity multiple times",s,o,"Existing entity:",this.getEntity(s));else{var r=this.createRemoteEntity(o);this.createAndAppendChildren(s,r),t.appendChild(r)}}}},{key:"addEntityToPage",value:function(e,t){this.hasEntity(t)?this.addEntityToParent(e,t):this.addEntityToSceneRoot(e)}},{key:"addEntityToParent",value:function(e,t){document.getElementById("naf-"+t).appendChild(e)}},{key:"addEntityToSceneRoot",value:function(e){document.querySelector("a-scene").appendChild(e)}},{key:"completeSync",value:function(e,t){for(var n in this.entities)this.entities[n]&&this.entities[n].components.networked.syncAll(e,t)}},{key:"removeRemoteEntity",value:function(e,t,n,i){if(!NAF.options.syncSource||i===NAF.options.syncSource){var o=n.networkId;return this.removeEntity(o)}}},{key:"removeEntitiesOfClient",value:function(e){var t=[];for(var n in this.entities)if(NAF.utils.getCreator(this.entities[n])===e){var i=void 0,o=this.entities[n].getAttribute("networked");if(o&&o.persistent&&(i=NAF.utils.takeOwnership(this.entities[n])),!i){var s=this.removeEntity(n);t.push(s)}}return t}},{key:"removeEntity",value:function(e){if(this.forgetPersistentFirstSync(e),this.hasEntity(e)){var t=this.entities[e];return this.forgetEntity(e),t.parentNode.removeChild(t),t}return NAF.log.error("Tried to remove entity I don't have."),null}},{key:"forgetEntity",value:function(e){delete this.entities[e],this.forgetPersistentFirstSync(e)}},{key:"getPersistentFirstSync",value:function(e){return this._persistentFirstSyncs[e]}},{key:"forgetPersistentFirstSync",value:function(e){delete this._persistentFirstSyncs[e]}},{key:"getEntity",value:function(e){return this.entities[e]?this.entities[e]:null}},{key:"hasEntity",value:function(e){return!!this.entities[e]}},{key:"removeRemoteEntities",value:function(){for(var e in this.childCache=new o,this.entities)this.entities[e].getAttribute("networked").owner!=NAF.clientId&&this.removeEntity(e)}}])&&i(t.prototype,n),s&&i(t,s),e}();e.exports=s},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dict={}}var t,n,o;return t=e,(n=[{key:"addChild",value:function(e,t){this.hasParent(e)||(this.dict[e]=[]),this.dict[e].push(t)}},{key:"getChildren",value:function(e){if(!this.hasParent(e))return[];var t=this.dict[e];return delete this.dict[e],t}},{key:"hasParent",value:function(e){return!!this.dict[e]}}])&&i(t.prototype,n),o&&i(t,o),e}();e.exports=o},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o="u",s="um",r="r",a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.entities=t,this.setupDefaultDataSubscriptions(),this.connectedClients={},this.activeDataChannels={}}var t,n,a;return t=e,(n=[{key:"setNetworkAdapter",value:function(e){this.adapter=e}},{key:"setupDefaultDataSubscriptions",value:function(){this.dataChannelSubs={},this.dataChannelSubs[o]=this.entities.updateEntity.bind(this.entities),this.dataChannelSubs[s]=this.entities.updateEntityMulti.bind(this.entities),this.dataChannelSubs[r]=this.entities.removeRemoteEntity.bind(this.entities)}},{key:"connect",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];NAF.app=t,NAF.room=n,this.adapter.setServerUrl(e),this.adapter.setApp(t),this.adapter.setRoom(n);var o={audio:i,video:!1,datachannel:!0};return this.adapter.setWebRtcOptions(o),this.adapter.setServerConnectListeners(this.connectSuccess.bind(this),this.connectFailure.bind(this)),this.adapter.setDataChannelListeners(this.dataChannelOpen.bind(this),this.dataChannelClosed.bind(this),this.receivedData.bind(this)),this.adapter.setRoomOccupantListener(this.occupantsReceived.bind(this)),this.adapter.connect()}},{key:"onConnect",value:function(e){this.onConnectCallback=e,this.isConnected()?e():document.body.addEventListener("connected",e,!1)}},{key:"connectSuccess",value:function(e){NAF.log.write("Networked-Aframe Client ID:",e),NAF.clientId=e;var t=new CustomEvent("connected",{detail:{clientId:e}});document.body.dispatchEvent(t)}},{key:"connectFailure",value:function(e,t){NAF.log.error(e,"failure to connect")}},{key:"occupantsReceived",value:function(e){var t=Object.assign({},this.connectedClients);this.connectedClients=e,this.checkForDisconnectingClients(t,e),this.checkForConnectingClients(e)}},{key:"checkForDisconnectingClients",value:function(e,t){for(var n in e)t[n]||(NAF.log.write("Closing stream to ",n),this.adapter.closeStreamConnection(n))}},{key:"checkForConnectingClients",value:function(e){for(var t in e)this.isNewClient(t)&&this.adapter.shouldStartConnectionTo(e[t])&&(NAF.log.write("Opening datachannel to ",t),this.adapter.startStreamConnection(t))}},{key:"getConnectedClients",value:function(){return this.connectedClients}},{key:"isConnected",value:function(){return!!NAF.clientId}},{key:"isMineAndConnected",value:function(e){return this.isConnected()&&NAF.clientId===e}},{key:"isNewClient",value:function(e){return!this.isConnectedTo(e)}},{key:"isConnectedTo",value:function(e){return this.adapter.getConnectStatus(e)===NAF.adapters.IS_CONNECTED}},{key:"dataChannelOpen",value:function(e){NAF.log.write("Opened data channel from "+e),this.activeDataChannels[e]=!0,this.entities.completeSync(e,!0);var t=new CustomEvent("clientConnected",{detail:{clientId:e}});document.body.dispatchEvent(t)}},{key:"dataChannelClosed",value:function(e){NAF.log.write("Closed data channel from "+e),this.activeDataChannels[e]=!1,this.entities.removeEntitiesOfClient(e);var t=new CustomEvent("clientDisconnected",{detail:{clientId:e}});document.body.dispatchEvent(t)}},{key:"hasActiveDataChannel",value:function(e){return!(!this.activeDataChannels[e]||!this.activeDataChannels[e])}},{key:"broadcastData",value:function(e,t){this.adapter.broadcastData(e,t)}},{key:"broadcastDataGuaranteed",value:function(e,t){this.adapter.broadcastDataGuaranteed(e,t)}},{key:"sendData",value:function(e,t,n,i){this.hasActiveDataChannel(e)&&(i?this.adapter.sendDataGuaranteed(e,t,n):this.adapter.sendData(e,t,n))}},{key:"sendDataGuaranteed",value:function(e,t,n){this.sendData(e,t,n,!0)}},{key:"subscribeToDataChannel",value:function(e,t){this.isReservedDataType(e)?NAF.log.error("NetworkConnection@subscribeToDataChannel: "+e+" is a reserved dataType. Choose another"):this.dataChannelSubs[e]=t}},{key:"unsubscribeToDataChannel",value:function(e){this.isReservedDataType(e)?NAF.log.error("NetworkConnection@unsubscribeToDataChannel: "+e+" is a reserved dataType. Choose another"):delete this.dataChannelSubs[e]}},{key:"isReservedDataType",value:function(e){return e==o||e==r}},{key:"receivedData",value:function(e,t,n,i){this.dataChannelSubs[t]?this.dataChannelSubs[t](e,t,n,i):NAF.log.write("NetworkConnection@receivedData: "+t+" has not been subscribed to yet. Call subscribeToDataChannel()")}},{key:"getServerTime",value:function(){return this.adapter.getServerTime()}},{key:"disconnect",value:function(){this.entities.removeRemoteEntities(),this.adapter.disconnect(),NAF.app="",NAF.room="",NAF.clientId="",this.connectedClients={},this.activeDataChannels={},this.adapter=null,this.setupDefaultDataSubscriptions(),document.body.removeEventListener("connected",this.onConnectCallback)}}])&&i(t.prototype,n),a&&i(t,a),e}();e.exports=a},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=n(10),s=n(11),r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adapters={socketio:s,webrtc:o},this.IS_CONNECTED=e.IS_CONNECTED,this.CONNECTING=e.CONNECTING,this.NOT_CONNECTED=e.NOT_CONNECTED}var t,n,r;return t=e,(n=[{key:"register",value:function(e,t){this.adapters[e]=t}},{key:"make",value:function(e){var t=e.toLowerCase();if(this.adapters[t])return new(0,this.adapters[t]);throw"easyrtc"===t||"wseasyrtc"==t?new Error("Adapter: "+e+" not registered. EasyRTC support was removed in Networked-Aframe 0.7.0. To use the deprecated EasyRTC adapter see https://github.com/networked-aframe/naf-easyrtc-adapter"):new Error("Adapter: "+e+" not registered. Please use NAF.adapters.register() to register this adapter.")}}])&&i(t.prototype,n),r&&i(t,r),e}();r.IS_CONNECTED="IS_CONNECTED",r.CONNECTING="CONNECTING",r.NOT_CONNECTED="NOT_CONNECTED",e.exports=r},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}var r=function(){function e(t,n,o){i(this,e),this.localId=t,this.remoteId=n,this.sendSignalFunc=o,this.open=!1,this.channelLabel="networked-aframe-channel",this.pc=this.createPeerConnection(),this.channel=null}return s(e,[{key:"setDatachannelListeners",value:function(e,t,n,i){this.openListener=e,this.closedListener=t,this.messageListener=n,this.trackListener=i}},{key:"offer",value:function(e){var t=this;this.setupChannel(this.pc.createDataChannel(this.channelLabel,{reliable:!1})),e.sendAudio&&e.localAudioStream.getTracks().forEach((function(n){return t.pc.addTrack(n,e.localAudioStream)})),this.pc.createOffer((function(e){t.handleSessionDescription(e)}),(function(e){NAF.log.error("WebRtcPeer.offer: "+e)}),{offerToReceiveAudio:!0,offerToReceiveVideo:!1})}},{key:"handleSignal",value:function(e){if(this.localId===e.to&&this.remoteId===e.from)switch(e.type){case"offer":this.handleOffer(e);break;case"answer":this.handleAnswer(e);break;case"candidate":this.handleCandidate(e);break;default:NAF.log.error("WebRtcPeer.handleSignal: Unknown signal type "+e.type)}}},{key:"send",value:function(e,t){null!==this.channel&&"open"===this.channel.readyState&&this.channel.send(JSON.stringify({type:e,data:t}))}},{key:"getStatus",value:function(){if(null===this.channel)return e.NOT_CONNECTED;switch(this.channel.readyState){case"open":return e.IS_CONNECTED;case"connecting":return e.CONNECTING;case"closing":case"closed":default:return e.NOT_CONNECTED}}},{key:"createPeerConnection",value:function(){var t=this,n=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection;if(void 0===n)throw new Error("WebRtcPeer.createPeerConnection: This browser does not seem to support WebRTC.");var i=new n({iceServers:e.ICE_SERVERS});return i.onicecandidate=function(e){e.candidate&&t.sendSignalFunc({from:t.localId,to:t.remoteId,type:"candidate",sdpMLineIndex:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate})},i.oniceconnectionstatechange=function(){t.open&&"disconnected"===i.iceConnectionState&&(t.open=!1,t.closedListener(t.remoteId))},i.ontrack=function(e){t.trackListener(t.remoteId,e.streams[0])},i}},{key:"setupChannel",value:function(e){var t=this;this.channel=e,this.channel.onmessage=function(e){var n=JSON.parse(e.data);t.messageListener(t.remoteId,n.type,n.data)},this.channel.onopen=function(e){t.open=!0,t.openListener(t.remoteId)},this.channel.onclose=function(e){t.open&&(t.open=!1,t.closedListener(t.remoteId))},this.channel.onerror=function(e){NAF.log.error("WebRtcPeer.channel.onerror: "+e)}}},{key:"handleOffer",value:function(e){var t=this;this.pc.ondatachannel=function(e){t.setupChannel(e.channel)},this.setRemoteDescription(e),this.pc.createAnswer((function(e){t.handleSessionDescription(e)}),(function(e){NAF.log.error("WebRtcPeer.handleOffer: "+e)}))}},{key:"handleAnswer",value:function(e){this.setRemoteDescription(e)}},{key:"handleCandidate",value:function(e){var t=window.RTCIceCandidate||window.webkitRTCIceCandidate||window.mozRTCIceCandidate;this.pc.addIceCandidate(new t(e),(function(){}),(function(e){NAF.log.error("WebRtcPeer.handleCandidate: "+e)}))}},{key:"handleSessionDescription",value:function(e){this.pc.setLocalDescription(e,(function(){}),(function(e){NAF.log.error("WebRtcPeer.handleSessionDescription: "+e)})),this.sendSignalFunc({from:this.localId,to:this.remoteId,type:e.type,sdp:e.sdp})}},{key:"setRemoteDescription",value:function(e){var t=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription||window.msRTCSessionDescription;this.pc.setRemoteDescription(new t(e),(function(){}),(function(e){NAF.log.error("WebRtcPeer.setRemoteDescription: "+e)}))}},{key:"close",value:function(){this.pc&&this.pc.close()}}]),e}();r.IS_CONNECTED="IS_CONNECTED",r.CONNECTING="CONNECTING",r.NOT_CONNECTED="NOT_CONNECTED",r.ICE_SERVERS=[{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}];var a=function(){function e(){i(this,e),void 0===io&&console.warn("It looks like socket.io has not been loaded before WebrtcAdapter. Please do that."),this.app="default",this.room="default",this.occupantListener=null,this.myRoomJoinTime=null,this.myId=null,this.peers={},this.occupants={},this.audioStreams={},this.pendingAudioRequest={},this.serverTimeRequests=0,this.timeOffsets=[],this.avgTimeOffset=0}return s(e,[{key:"setServerUrl",value:function(e){this.wsUrl=e}},{key:"setApp",value:function(e){this.app=e}},{key:"setRoom",value:function(e){this.room=e}},{key:"setWebRtcOptions",value:function(e){!1===e.datachannel&&NAF.log.error("WebrtcAdapter.setWebRtcOptions: datachannel must be true."),!0===e.audio&&(this.sendAudio=!0),!0===e.video&&NAF.log.warn("WebrtcAdapter does not support video yet.")}},{key:"setServerConnectListeners",value:function(e,t){this.connectSuccess=e,this.connectFailure=t}},{key:"setRoomOccupantListener",value:function(e){this.occupantListener=e}},{key:"setDataChannelListeners",value:function(e,t,n){this.openListener=e,this.closedListener=t,this.messageListener=n}},{key:"connect",value:function(){var e=this;this.updateTimeOffset().then((function(){e.wsUrl&&"/"!==e.wsUrl||("https:"===location.protocol?e.wsUrl="wss://"+location.host:e.wsUrl="ws://"+location.host),NAF.log.write("Attempting to connect to socket.io");var t=e.socket=io(e.wsUrl);function n(t){var n=t.from,i=t.type,o=t.data;"ice-candidate"!==i?e.messageListener(n,i,o):e.peers[n].handleSignal(o)}t.on("connect",(function(){NAF.log.write("User connected",t.id),e.myId=t.id,e.joinRoom()})),t.on("connectSuccess",(function(t){var n=t.joinedTime;if(e.myRoomJoinTime=n,NAF.log.write("Successfully joined room",e.room,"at server time",n),e.sendAudio){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(t){e.storeAudioStream(e.myId,t),e.connectSuccess(e.myId),t.getTracks().forEach((function(n){Object.keys(e.peers).forEach((function(i){e.peers[i].pc.addTrack(n,t)}))}))})).catch((function(t){NAF.log.error(t),console.error("Microphone is disabled due to lack of permissions"),e.sendAudio=!1,e.connectSuccess(e.myId)}))}else e.connectSuccess(e.myId)})),t.on("error",(function(t){console.error("Socket connection failure",t),e.connectFailure()})),t.on("occupantsChanged",(function(t){var n=t.occupants;NAF.log.write("occupants changed",t),e.receivedOccupants(n)})),t.on("send",n),t.on("broadcast",n)}))}},{key:"joinRoom",value:function(){NAF.log.write("Joining room",this.room),this.socket.emit("joinRoom",{room:this.room})}},{key:"receivedOccupants",value:function(e){var t=this;delete e[this.myId],this.occupants=e;var n=this,i=this.myId,o=function(e){var o=e;if(t.peers[o])return"continue";var s=new r(i,o,(function(e){n.socket.emit("send",{from:i,to:o,type:"ice-candidate",data:e,sending:!0})}));s.setDatachannelListeners(n.openListener,n.closedListener,n.messageListener,n.trackListener.bind(n)),n.peers[o]=s};for(var s in e)o(s);this.occupantListener(e)}},{key:"shouldStartConnectionTo",value:function(e){return(this.myRoomJoinTime||0)<=(e||0)}},{key:"startStreamConnection",value:function(e){var t=this;NAF.log.write("starting offer process"),this.sendAudio?this.getMediaStream(this.myId).then((function(n){var i={sendAudio:!0,localAudioStream:n};t.peers[e].offer(i)})):this.peers[e].offer({})}},{key:"closeStreamConnection",value:function(e){NAF.log.write("closeStreamConnection",e,this.peers),this.peers[e].close(),delete this.peers[e],delete this.occupants[e],this.closedListener(e)}},{key:"getConnectStatus",value:function(e){var t=this.peers[e];if(void 0===t)return NAF.adapters.NOT_CONNECTED;switch(t.getStatus()){case r.IS_CONNECTED:return NAF.adapters.IS_CONNECTED;case r.CONNECTING:return NAF.adapters.CONNECTING;case r.NOT_CONNECTED:default:return NAF.adapters.NOT_CONNECTED}}},{key:"sendData",value:function(e,t,n){this.peers[e].send(t,n)}},{key:"sendDataGuaranteed",value:function(e,t,n){var i={from:this.myId,to:e,type:t,data:n,sending:!0};this.socket.emit("send",i)}},{key:"broadcastData",value:function(e,t){for(var n in this.peers)this.sendData(n,e,t)}},{key:"broadcastDataGuaranteed",value:function(e,t){var n={from:this.myId,type:e,data:t,broadcasting:!0};this.socket.emit("broadcast",n)}},{key:"storeAudioStream",value:function(e,t){this.audioStreams[e]=t,this.pendingAudioRequest[e]&&(NAF.log.write("Received pending audio for "+e),this.pendingAudioRequest[e](t),this.pendingAudioRequest[e](t))}},{key:"trackListener",value:function(e,t){this.storeAudioStream(e,t)}},{key:"getMediaStream",value:function(e){var t=this;return this.audioStreams[e]?(NAF.log.write("Already had audio for "+e),Promise.resolve(this.audioStreams[e])):(NAF.log.write("Waiting on audio for "+e),new Promise((function(n){t.pendingAudioRequest[e]=n})))}},{key:"updateTimeOffset",value:function(){var e=this,t=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:"HEAD",cache:"no-cache"}).then((function(n){var i=new Date(n.headers.get("Date")).getTime()+500,o=Date.now(),s=i+(o-t)/2-o;e.serverTimeRequests++,e.serverTimeRequests<=10?e.timeOffsets.push(s):e.timeOffsets[e.serverTimeRequests%10]=s,e.avgTimeOffset=e.timeOffsets.reduce((function(e,t){return e+t}),0)/e.timeOffsets.length,e.serverTimeRequests>10?setTimeout((function(){return e.updateTimeOffset()}),3e5):e.updateTimeOffset()}))}},{key:"getServerTime",value:function(){return(new Date).getTime()+this.avgTimeOffset}}]),e}();e.exports=a},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===io&&console.warn("It looks like socket.io has not been loaded before SocketioAdapter. Please do that."),this.app="default",this.room="default",this.occupantListener=null,this.myRoomJoinTime=null,this.myId=null,this.occupants={},this.connectedClients=[],this.serverTimeRequests=0,this.timeOffsets=[],this.avgTimeOffset=0}var t,n,o;return t=e,(n=[{key:"setServerUrl",value:function(e){this.wsUrl=e}},{key:"setApp",value:function(e){this.app=e}},{key:"setRoom",value:function(e){this.room=e}},{key:"setWebRtcOptions",value:function(e){}},{key:"setServerConnectListeners",value:function(e,t){this.connectSuccess=e,this.connectFailure=t}},{key:"setRoomOccupantListener",value:function(e){this.occupantListener=e}},{key:"setDataChannelListeners",value:function(e,t,n){this.openListener=e,this.closedListener=t,this.messageListener=n}},{key:"connect",value:function(){var e=this;this.updateTimeOffset().then((function(){e.wsUrl&&"/"!==e.wsUrl||("https:"===location.protocol?e.wsUrl="wss://"+location.host:e.wsUrl="ws://"+location.host),NAF.log.write("Attempting to connect to socket.io");var t=e.socket=io(e.wsUrl);function n(t){var n=t.from,i=t.type,o=t.data;e.messageListener(n,i,o)}t.on("connect",(function(){NAF.log.write("User connected",t.id),e.myId=t.id,e.joinRoom()})),t.on("connectSuccess",(function(t){var n=t.joinedTime;e.myRoomJoinTime=n,NAF.log.write("Successfully joined room",e.room,"at server time",n),e.connectSuccess(e.myId)})),t.on("error",(function(t){console.error("Socket connection failure",t),e.connectFailure()})),t.on("occupantsChanged",(function(t){var n=t.occupants;NAF.log.write("occupants changed",t),e.receivedOccupants(n)})),t.on("send",n),t.on("broadcast",n)}))}},{key:"joinRoom",value:function(){NAF.log.write("Joining room",this.room),this.socket.emit("joinRoom",{room:this.room})}},{key:"receivedOccupants",value:function(e){delete e[this.myId],this.occupants=e,this.occupantListener(e)}},{key:"shouldStartConnectionTo",value:function(e){return!0}},{key:"startStreamConnection",value:function(e){this.connectedClients.push(e),this.openListener(e)}},{key:"closeStreamConnection",value:function(e){this.connectedClients=this.connectedClients.filter((function(t){return t!=e})),this.closedListener(e)}},{key:"getConnectStatus",value:function(e){return-1!=this.connectedClients.indexOf(e)?NAF.adapters.IS_CONNECTED:NAF.adapters.NOT_CONNECTED}},{key:"sendData",value:function(e,t,n){this.sendDataGuaranteed(e,t,n)}},{key:"sendDataGuaranteed",value:function(e,t,n){var i={from:this.myId,to:e,type:t,data:n,sending:!0};this.socket?this.socket.emit("send",i):NAF.log.warn("SocketIO socket not created yet")}},{key:"broadcastData",value:function(e,t){this.broadcastDataGuaranteed(e,t)}},{key:"broadcastDataGuaranteed",value:function(e,t){var n={from:this.myId,type:e,data:t,broadcasting:!0};this.socket?this.socket.emit("broadcast",n):NAF.log.warn("SocketIO socket not created yet")}},{key:"getMediaStream",value:function(e){}},{key:"updateTimeOffset",value:function(){var e=this,t=Date.now()+this.avgTimeOffset;return fetch(document.location.href,{method:"HEAD",cache:"no-cache"}).then((function(n){var i=new Date(n.headers.get("Date")).getTime()+500,o=Date.now(),s=i+(o-t)/2-o;e.serverTimeRequests++,e.serverTimeRequests<=10?e.timeOffsets.push(s):e.timeOffsets[e.serverTimeRequests%10]=s,e.avgTimeOffset=e.timeOffsets.reduce((function(e,t){return e+t}),0)/e.timeOffsets.length,e.serverTimeRequests>10?setTimeout((function(){return e.updateTimeOffset()}),3e5):e.updateTimeOffset()}))}},{key:"getServerTime",value:function(){return(new Date).getTime()+this.avgTimeOffset}}])&&i(t.prototype,n),o&&i(t,o),e}();e.exports=o},function(e,t,n){"use strict";AFRAME.registerComponent("networked-scene",{schema:{serverURL:{default:"/"},app:{default:"default"},room:{default:"default"},connectOnLoad:{default:!0},onConnect:{default:"onConnect"},adapter:{default:"socketio"},audio:{default:!1},debug:{default:!1}},init:function(){var e=this.el;this.connect=this.connect.bind(this),e.addEventListener("connect",this.connect),this.data.connectOnLoad&&e.emit("connect",null,!1)},connect:function(){return NAF.log.setDebug(this.data.debug),NAF.log.write("Networked-Aframe Connecting..."),this.checkDeprecatedProperties(),this.setupNetworkAdapter(),this.hasOnConnectFunction()&&this.callOnConnect(),NAF.connection.connect(this.data.serverURL,this.data.app,this.data.room,this.data.audio)},checkDeprecatedProperties:function(){},setupNetworkAdapter:function(){var e=this.data.adapter,t=NAF.adapters.make(e);NAF.connection.setNetworkAdapter(t),this.el.emit("adapter-ready",t,!1)},hasOnConnectFunction:function(){return""!=this.data.onConnect&&window[this.data.onConnect]},callOnConnect:function(){NAF.connection.onConnect(window[this.data.onConnect])},remove:function(){NAF.log.write("networked-scene disconnected"),this.el.removeEventListener("connect",this.connect),NAF.connection.disconnect()}})},function(e,t,n){"use strict";var i=n(14),o=n(15),s=THREE.Math.DEG2RAD,r=["position","rotation","scale"];AFRAME.registerSystem("networked",{init:function(){this.components=[],this.nextSyncTime=0},register:function(e){this.components.push(e)},deregister:function(e){var t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)},tick:function(){if(NAF.connection.adapter&&!(this.el.clock.elapsedTime<this.nextSyncTime)){for(var e={d:[]},t=0,n=this.components.length;t<n;t++){var i=this.components[t];if(i.isMine()){if(!i.el.parentElement)return void NAF.log.error("entity registered with system despite being removed");var o=this.components[t].syncDirty();o&&e.d.push(o)}}e.d.length>0&&NAF.connection.broadcastData("um",e),this.updateNextSyncTime()}},updateNextSyncTime:function(){this.nextSyncTime=this.el.clock.elapsedTime+1/NAF.options.updateRate}}),AFRAME.registerComponent("networked",{schema:{template:{default:""},attachTemplateToLocal:{default:!0},persistent:{default:!1},networkId:{default:""},owner:{default:""},creator:{default:""}},init:function(){this.OWNERSHIP_GAINED="ownership-gained",this.OWNERSHIP_CHANGED="ownership-changed",this.OWNERSHIP_LOST="ownership-lost",this.onOwnershipGainedEvent={el:this.el},this.onOwnershipChangedEvent={el:this.el},this.onOwnershipLostEvent={el:this.el},this.conversionEuler=new THREE.Euler,this.conversionEuler.order="YXZ",this.bufferInfos=[],this.bufferPosition=new THREE.Vector3,this.bufferQuaternion=new THREE.Quaternion,this.bufferScale=new THREE.Vector3;var e=this.wasCreatedByNetwork();this.onConnected=this.onConnected.bind(this),this.syncData={},this.componentSchemas=NAF.schemas.getComponents(this.data.template),this.cachedElements=new Array(this.componentSchemas.length),this.networkUpdatePredicates=this.componentSchemas.map((function(e){return e.requiresNetworkUpdate&&e.requiresNetworkUpdate()||(t=null,function(e){return!(null!==t&&i(t,e)||(t=AFRAME.utils.clone(e),0))});var t})),this.invalidateCachedElements(),this.initNetworkParent(),""===this.data.networkId&&this.el.setAttribute(this.name,{networkId:NAF.utils.createNetworkId()}),e?this.firstUpdate():(this.data.attachTemplateToLocal&&this.attachTemplateToLocal(),this.registerEntity(this.data.networkId)),this.lastOwnerTime=-1,NAF.clientId?this.onConnected():document.body.addEventListener("connected",this.onConnected,!1),document.body.dispatchEvent(this.entityCreatedEvent()),this.el.dispatchEvent(new CustomEvent("instantiated",{detail:{el:this.el}})),this.el.sceneEl.systems.networked.register(this)},attachTemplateToLocal:function(){for(var e=NAF.schemas.getCachedTemplate(this.data.template),t=e.attributes,n=0;n<t.length;n++)this.el.setAttribute(t[n].name,t[n].value);for(;e.firstElementChild;)this.el.appendChild(e.firstElementChild)},takeOwnership:function(){var e=this.data.owner,t=this.lastOwnerTime,n=NAF.connection.getServerTime();return!!(e&&!this.isMine()&&t<n)&&(this.lastOwnerTime=n,this.removeLerp(),this.el.setAttribute("networked",{owner:NAF.clientId}),this.syncAll(),this.onOwnershipGainedEvent.oldOwner=e,this.el.emit(this.OWNERSHIP_GAINED,this.onOwnershipGainedEvent),this.onOwnershipChangedEvent.oldOwner=e,this.onOwnershipChangedEvent.newOwner=NAF.clientId,this.el.emit(this.OWNERSHIP_CHANGED,this.onOwnershipChangedEvent),!0)},wasCreatedByNetwork:function(){return!!this.el.firstUpdateData},initNetworkParent:function(){var e=this.el.parentElement;e.components&&e.components.networked?this.parent=e:this.parent=null},registerEntity:function(e){NAF.entities.registerEntity(e,this.el)},applyPersistentFirstSync:function(){var e=this.data.networkId,t=NAF.entities.getPersistentFirstSync(e);t&&(this.networkUpdate(t),NAF.entities.forgetPersistentFirstSync(e))},firstUpdate:function(){var e=this.el.firstUpdateData;this.networkUpdate(e)},onConnected:function(){var e=this;""===this.data.owner&&(this.lastOwnerTime=NAF.connection.getServerTime(),this.el.setAttribute(this.name,{owner:NAF.clientId,creator:NAF.clientId}),setTimeout((function(){e.el.parentNode?e.syncAll(void 0,!0):NAF.log.warn("Networked element was removed before ever getting the chance to syncAll")}),0)),document.body.removeEventListener("connected",this.onConnected,!1)},isMine:function(){return this.data.owner===NAF.clientId},createdByMe:function(){return this.data.creator===NAF.clientId},tick:function(e,t){if(!this.isMine()&&NAF.options.useLerp)for(var n=0;n<this.bufferInfos.length;n++){var i=this.bufferInfos[n],o=i.buffer,s=i.object3D,r=i.componentNames;o.update(t),r.includes("position")&&s.position.copy(o.getPosition()),r.includes("rotation")&&s.quaternion.copy(o.getQuaternion()),r.includes("scale")&&s.scale.copy(o.getScale())}},syncAll:function(e,t){if(this.canSync()){var n=this.gatherComponentsData(!0),i=this.createSyncData(n,t);e?NAF.connection.sendDataGuaranteed(e,"u",i):NAF.connection.broadcastDataGuaranteed("u",i)}},syncDirty:function(){if(this.canSync()){var e=this.gatherComponentsData(!1);if(null!==e)return this.createSyncData(e)}},getCachedElement:function(e){var t=this.cachedElements[e];if(t)return t;var n=this.componentSchemas[e];return n.selector?this.cachedElements[e]=this.el.querySelector(n.selector):this.cachedElements[e]=this.el},invalidateCachedElements:function(){for(var e=0;e<this.cachedElements.length;e++)this.cachedElements[e]=null},gatherComponentsData:function(e){for(var t=null,n=0;n<this.componentSchemas.length;n++){var i=this.componentSchemas[n],o=this.getCachedElement(n);if(o){var s=i.component?i.component:i,r=o.getAttribute(s);if(null!==r){var a=i.property?r[i.property]:r;(this.networkUpdatePredicates[n](a)||e)&&((t=t||{})[n]=a)}else e&&((t=t||{})[n]=null)}else e&&((t=t||{})[n]=null)}return t},createSyncData:function(e,t){var n=this.syncData,i=this.data;return n.networkId=i.networkId,n.owner=i.owner,n.creator=i.creator,n.lastOwnerTime=this.lastOwnerTime,n.template=i.template,n.persistent=i.persistent,n.parent=this.getParentId(),n.components=e,n.isFirstSync=!!t,n},canSync:function(){if(this.data.owner&&this.isMine())return!0;if(!this.createdByMe())return!1;var e=NAF.connection.getConnectedClients();for(var t in e)if(t===this.data.owner)return!1;return!0},getParentId:function(){return this.initNetworkParent(),this.parent?this.parent.getAttribute("networked").networkId:null},networkUpdate:function(e){if(!(e.lastOwnerTime<this.lastOwnerTime||this.lastOwnerTime===e.lastOwnerTime&&this.data.owner>e.owner)&&void 0!==this.data){if(this.data.owner!==e.owner){var t=this.isMine();this.lastOwnerTime=e.lastOwnerTime;var n=this.data.owner,i=e.owner;this.el.setAttribute("networked",{owner:e.owner}),t&&(this.onOwnershipLostEvent.newOwner=i,this.el.emit(this.OWNERSHIP_LOST,this.onOwnershipLostEvent)),this.onOwnershipChangedEvent.oldOwner=n,this.onOwnershipChangedEvent.newOwner=i,this.el.emit(this.OWNERSHIP_CHANGED,this.onOwnershipChangedEvent)}this.data.persistent!==e.persistent&&this.el.setAttribute("networked",{persistent:e.persistent}),this.updateNetworkedComponents(e.components)}},updateNetworkedComponents:function(e){for(var t=0,n=this.componentSchemas.length;t<n;t++){var i=e[t],o=this.componentSchemas[t],s=this.getCachedElement(t);null!==s&&null!=i&&(o.component?o.property?this.updateNetworkedComponent(s,o.component,o.property,i):this.updateNetworkedComponent(s,o.component,i):this.updateNetworkedComponent(s,o,i))}},updateNetworkedComponent:function(e,t,n,i){if(NAF.options.useLerp&&r.includes(t)){for(var a,c=0,u=this.bufferInfos.length;c<u;c++){var l=this.bufferInfos[c];if(l.object3D===e.object3D){a=l;break}}if(a){var h=a.componentNames;h.includes(t)||h.push(t)}else a={buffer:new o(o.MODE_LERP,.1),object3D:e.object3D,componentNames:[t]},this.bufferInfos.push(a);var d=a.buffer;switch(t){case"position":return void d.setPosition(this.bufferPosition.set(n.x,n.y,n.z));case"rotation":return this.conversionEuler.set(s*n.x,s*n.y,s*n.z),void d.setQuaternion(this.bufferQuaternion.setFromEuler(this.conversionEuler));case"scale":return void d.setScale(this.bufferScale.set(n.x,n.y,n.z))}NAF.log.error("Could not set value in interpolation buffer.",e,t,n,a)}else void 0===i?e.setAttribute(t,n):e.setAttribute(t,n,i)},removeLerp:function(){this.bufferInfos=[]},remove:function(){if(this.isMine()&&NAF.connection.isConnected()){var e={networkId:this.data.networkId};NAF.entities.hasEntity(this.data.networkId)?NAF.connection.broadcastDataGuaranteed("r",e):NAF.log.error("Removing networked entity that is not in entities array.")}NAF.entities.forgetEntity(this.data.networkId),document.body.dispatchEvent(this.entityRemovedEvent(this.data.networkId)),this.el.sceneEl.systems.networked.deregister(this)},entityCreatedEvent:function(){return new CustomEvent("entityCreated",{detail:{el:this.el}})},entityRemovedEvent:function(e){return new CustomEvent("entityRemoved",{detail:{networkId:e}})}})},function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=Array.isArray,s=Object.keys,r=Object.prototype.hasOwnProperty;e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==i(t)&&"object"==i(n)){var a,c,u,l=o(t),h=o(n);if(l&&h){if((c=t.length)!=n.length)return!1;for(a=c;0!=a--;)if(!e(t[a],n[a]))return!1;return!0}if(l!=h)return!1;var d=t instanceof Date,f=n instanceof Date;if(d!=f)return!1;if(d&&f)return t.getTime()==n.getTime();var p=t instanceof RegExp,m=n instanceof RegExp;if(p!=m)return!1;if(p&&m)return t.toString()==n.toString();var v=s(t);if((c=v.length)!==s(n).length)return!1;for(a=c;0!=a--;)if(!r.call(n,v[a]))return!1;for(a=c;0!=a--;)if(!e(t[u=v[a]],n[u]))return!1;return!0}return t!=t&&n!=n}},function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=[],r=function(){var e=s.pop();return e||(e={position:new THREE.Vector3,velocity:new THREE.Vector3,scale:new THREE.Vector3,quaternion:new THREE.Quaternion,time:0}),e},a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;o(this,e),this.state=0,this.buffer=[],this.bufferTime=1e3*n,this.time=0,this.mode=t,this.originFrame=r(),this.position=new THREE.Vector3,this.quaternion=new THREE.Quaternion,this.scale=new THREE.Vector3(1,1,1)}return i(e,[{key:"hermite",value:function(e,t,n,i,o,s){var r=t*t,a=t*t*t,c=2*a-3*r+1,u=-2*a+3*r,l=a-2*r+t,h=a-r;e.copy(n.multiplyScalar(c)),e.add(i.multiplyScalar(u)),e.add(o.multiplyScalar(l)),e.add(s.multiplyScalar(h))}},{key:"lerp",value:function(e,t,n,i){e.lerpVectors(t,n,i)}},{key:"slerp",value:function(e,t,n,i){THREE.Quaternion.slerp(t,n,e,i)}},{key:"updateOriginFrameToBufferTail",value:function(){var e;e=this.originFrame,s.push(e),this.originFrame=this.buffer.shift()}},{key:"appendBuffer",value:function(e,t,n,i){var o=this.buffer.length>0?this.buffer[this.buffer.length-1]:null;if(o&&o.time===this.time)e&&o.position.copy(e),t&&o.velocity.copy(t),n&&o.quaternion.copy(n),i&&o.scale.copy(i);else{var s=o||this.originFrame,a=r();a.position.copy(e||s.position),a.velocity.copy(t||s.velocity),a.quaternion.copy(n||s.quaternion),a.scale.copy(i||s.scale),a.time=this.time,this.buffer.push(a)}}},{key:"setTarget",value:function(e,t,n,i){this.appendBuffer(e,t,n,i)}},{key:"setPosition",value:function(e,t){this.appendBuffer(e,t,null,null)}},{key:"setQuaternion",value:function(e){this.appendBuffer(null,null,e,null)}},{key:"setScale",value:function(e){this.appendBuffer(null,null,null,e)}},{key:"update",value:function(e){if(0===this.state&&this.buffer.length>0&&(this.updateOriginFrameToBufferTail(),this.position.copy(this.originFrame.position),this.quaternion.copy(this.originFrame.quaternion),this.scale.copy(this.originFrame.scale),this.state=1),1===this.state&&this.buffer.length>0&&this.time>this.bufferTime&&(this.state=2),2===this.state){for(var t=this.time-this.bufferTime;this.buffer.length>0&&t>this.buffer[0].time;)this.buffer.length>1?this.updateOriginFrameToBufferTail():(this.originFrame.position.copy(this.buffer[0].position),this.originFrame.velocity.copy(this.buffer[0].velocity),this.originFrame.quaternion.copy(this.buffer[0].quaternion),this.originFrame.scale.copy(this.buffer[0].scale),this.originFrame.time=this.buffer[0].time,this.buffer[0].time=this.time+e);if(this.buffer.length>0&&this.buffer[0].time>0){var n=this.buffer[0],i=n.time-this.originFrame.time,o=(t-this.originFrame.time)/i;0===this.mode?this.lerp(this.position,this.originFrame.position,n.position,o):1===this.mode&&this.hermite(this.position,o,this.originFrame.position,n.position,this.originFrame.velocity.multiplyScalar(i),n.velocity.multiplyScalar(i)),this.slerp(this.quaternion,this.originFrame.quaternion,n.quaternion,o),this.lerp(this.scale,this.originFrame.scale,n.scale,o)}}0!==this.state&&(this.time+=e)}},{key:"getPosition",value:function(){return this.position}},{key:"getQuaternion",value:function(){return this.quaternion}},{key:"getScale",value:function(){return this.scale}}]),e}();e.exports=a},function(e,t,n){"use strict";var i=n(0);AFRAME.registerComponent("networked-audio-source",{schema:{positional:{default:!0},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},maxDistance:{default:1e4},refDistance:{default:1},rolloffFactor:{default:1}},init:function(){var e=this;this.listener=null,this.stream=null,this._setMediaStream=this._setMediaStream.bind(this),NAF.utils.getNetworkedEntity(this.el).then((function(t){var n=t.components.networked.data.owner;n&&NAF.connection.adapter.getMediaStream(n).then(e._setMediaStream).catch((function(e){return i.log.error("Error getting media stream for ".concat(n),e)}))}))},update:function(){this._setPannerProperties()},_setMediaStream:function(e){if(this.sound||this.setupSound(),e!=this.stream){if(this.stream&&this.sound.disconnect(),e){/chrome/i.test(navigator.userAgent)&&(this.audioEl=new Audio,this.audioEl.setAttribute("autoplay","autoplay"),this.audioEl.setAttribute("playsinline","playsinline"),this.audioEl.srcObject=e,this.audioEl.volume=0);var t=this.sound.context.createMediaStreamSource(e);this.sound.setNodeSource(t),this.el.emit("sound-source-set",{soundSource:t})}this.stream=e}},_setPannerProperties:function(){this.sound&&this.data.positional&&(this.sound.setDistanceModel(this.data.distanceModel),this.sound.setMaxDistance(this.data.maxDistance),this.sound.setRefDistance(this.data.refDistance),this.sound.setRolloffFactor(this.data.rolloffFactor))},remove:function(){this.sound&&(this.el.removeObject3D(this.attrName),this.stream&&this.sound.disconnect())},setupSound:function(){var e=this.el,t=e.sceneEl;this.sound&&e.removeObject3D(this.attrName),t.audioListener||(t.audioListener=new THREE.AudioListener,t.camera&&t.camera.add(t.audioListener),t.addEventListener("camera-set-active",(function(e){e.detail.cameraEl.getObject3D("camera").add(t.audioListener)}))),this.listener=t.audioListener,this.sound=this.data.positional?new THREE.PositionalAudio(this.listener):new THREE.Audio(this.listener),e.setObject3D(this.attrName,this.sound),this._setPannerProperties()}})}]);
>>>>>>> sean-factory-floor-config
